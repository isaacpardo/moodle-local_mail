import{n as U,i as Hs,a as vn,l as kn,c as wn,d as yn,s as Mt,S as me,b as de,e as ce,f as Mn,g as T,h as v,t as B,j as m,k as C,m as _,o as O,p as Me,q as $e,r as Pe,u as F,v as $n,w as Cn,x as Dn,y as S,z as Le,A as Re,B as j,C as D,D as ve,E as Qe,F as rt,G as Ce,H as be,I as re,J as ae,K as W,L as X,M as Q,N as _e,O as G,P as fe,Q as we,R as Se,T as De,U as He,V as ue,W as Sn,X as Us,Y as Be,Z as Xe,_ as at,$ as Fe,a0 as Gs,a1 as Vs,a2 as Ie,a3 as Ne,a4 as Ye,a5 as Tn,a6 as Ks,a7 as We,a8 as it,a9 as Ve,aa as Ke,ab as Ln,ac as Ys,ad as zn,ae as jn,af as Js,ag as Nn,ah as st,ai as An}from"./global-61298ce6.js";const Ze=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Ws(s,e,t,l){if(!e)return U;const n=s.getBoundingClientRect();if(e.left===n.left&&e.right===n.right&&e.top===n.top&&e.bottom===n.bottom)return U;const{delay:i=0,duration:r=300,easing:a=Hs,start:o=vn()+i,end:f=o+r,tick:c=U,css:u}=t(s,{from:e,to:n},l);let d=!0,g=!1,h;function p(){u&&(h=wn(s,0,1,r,i,a,u)),i||(g=!0)}function k(){u&&yn(s,h),d=!1}return kn(M=>{if(!g&&M>=o&&(g=!0),g&&M>=f&&(c(1,0),k()),!d)return!1;if(g){const w=M-o,y=0+1*a(w/r);c(y,1-y)}return!0}),p(),c(0,1),k}function Xs(s){const e=getComputedStyle(s);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:t,height:l}=e,n=s.getBoundingClientRect();s.style.position="absolute",s.style.width=t,s.style.height=l,ot(s,n)}}function ot(s,e){const t=s.getBoundingClientRect();if(e.left!==t.left||e.top!==t.top){const l=getComputedStyle(s),n=l.transform==="none"?"":l.transform;s.style.transform=`${n} translate(${e.left-t.left}px, ${e.top-t.top}px)`}}var Oe=(s=>(s[s.NotDeleted=0]="NotDeleted",s[s.Deleted=1]="Deleted",s[s.DeletedForever=2]="DeletedForever",s))(Oe||{}),et=(s=>(s[s.No=0]="No",s[s.Separate=1]="Separate",s[s.Visible=2]="Visible",s))(et||{}),ze=(s=>(s.TO="to",s.CC="cc",s.BCC="bcc",s))(ze||{}),ge=(s=>(s[s.SM=576]="SM",s[s.MD=768]="MD",s[s.LG=992]="LG",s[s.XL=1200]="XL",s))(ge||{});function Qs(s){const e=s-1;return e*e*e+1}function qe(s,{delay:e=0,duration:t=400,easing:l=Hs}={}){const n=+getComputedStyle(s).opacity;return{delay:e,duration:t,easing:l,css:i=>`opacity: ${i*n}`}}function tt(s,{delay:e=0,duration:t=400,easing:l=Qs,x:n=0,y:i=0,opacity:r=0}={}){const a=getComputedStyle(s),o=+a.opacity,f=a.transform==="none"?"":a.transform,c=o*(1-r),[u,d]=Mt(n),[g,h]=Mt(i);return{delay:e,duration:t,easing:l,css:(p,k)=>`
			transform: ${f} translate(${(1-p)*u}${d}, ${(1-p)*g}${h});
			opacity: ${o-c*k}`}}const{document:Bn}=Ze;function $t(s){let e,t,l=s[1]&&Ct(s),n=s[2]&&s[4]&&Dt(s);return{c(){e=v("div"),l&&l.c(),t=T(),n&&n.c(),m(e,"class","modal-footer")},m(i,r){C(i,e,r),l&&l.m(e,null),_(e,t),n&&n.m(e,null)},p(i,r){i[1]?l?l.p(i,r):(l=Ct(i),l.c(),l.m(e,t)):l&&(l.d(1),l=null),i[2]&&i[4]?n?n.p(i,r):(n=Dt(i),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(i){i&&D(e),l&&l.d(),n&&n.d()}}}function Ct(s){let e,t,l,n;return{c(){e=v("button"),t=B(s[1]),m(e,"type","button"),m(e,"class","btn btn-secondary")},m(i,r){C(i,e,r),_(e,t),l||(n=O(e,"click",function(){Me(s[3])&&s[3].apply(this,arguments)}),l=!0)},p(i,r){s=i,r&2&&F(t,s[1])},d(i){i&&D(e),l=!1,n()}}}function Dt(s){let e,t,l,n,i;return{c(){e=v("button"),t=B(s[2]),m(e,"type","button"),m(e,"class",l="btn "+s[5]),e.disabled=s[6]},m(r,a){C(r,e,a),_(e,t),n||(i=O(e,"click",function(){Me(s[4])&&s[4].apply(this,arguments)}),n=!0)},p(r,a){s=r,a&4&&F(t,s[2]),a&32&&l!==(l="btn "+s[5])&&m(e,"class",l),a&64&&(e.disabled=s[6])},d(r){r&&D(e),n=!1,i()}}}function qn(s){let e,t,l,n,i,r,a,o,f,c,u,d,g,h,p,k,M,w,y,b,$;const z=s[10].default,N=Mn(z,s,s[9],null);let L=(s[1]||s[2]&&s[4])&&$t(s);return{c(){e=T(),t=v("div"),l=v("div"),n=v("div"),i=v("div"),r=v("h5"),a=B(s[0]),o=T(),f=v("button"),c=v("span"),c.textContent="×",u=T(),d=v("div"),N&&N.c(),g=T(),L&&L.c(),k=T(),M=v("div"),m(r,"class","modal-title"),m(c,"aria-hidden","true"),m(f,"type","button"),m(f,"class","close"),m(f,"aria-label",s[1]),m(i,"class","modal-header"),m(d,"class","modal-body"),m(n,"class","modal-content"),m(l,"class","modal-dialog"),m(t,"class","modal show"),m(t,"tabindex","-1"),m(t,"role","dialog"),m(t,"aria-label",s[0]),m(t,"aria-modal","true"),m(M,"class","modal-backdrop show")},m(q,H){C(q,e,H),C(q,t,H),_(t,l),_(l,n),_(n,i),_(i,r),_(r,a),_(i,o),_(i,f),_(f,c),_(n,u),_(n,d),N&&N.m(d,null),_(n,g),L&&L.m(n,null),s[11](t),C(q,k,H),C(q,M,H),y=!0,b||($=[O(Bn.body,"keyup",s[8]),O(f,"click",function(){Me(s[3])&&s[3].apply(this,arguments)}),$e(h=Pe.call(null,t,s[3]))],b=!0)},p(q,[H]){s=q,(!y||H&1)&&F(a,s[0]),(!y||H&2)&&m(f,"aria-label",s[1]),N&&N.p&&(!y||H&512)&&$n(N,z,s,s[9],y?Dn(z,s[9],H,null):Cn(s[9]),null),s[1]||s[2]&&s[4]?L?L.p(s,H):(L=$t(s),L.c(),L.m(n,null)):L&&(L.d(1),L=null),(!y||H&1)&&m(t,"aria-label",s[0]),h&&Me(h.update)&&H&8&&h.update.call(null,s[3])},i(q){y||(S(N,q),Le(()=>{y&&(p||(p=Re(t,tt,{y:-100},!0)),p.run(1))}),Le(()=>{y&&(w||(w=Re(M,qe,{},!0)),w.run(1))}),y=!0)},o(q){j(N,q),p||(p=Re(t,tt,{y:-100},!1)),p.run(0),w||(w=Re(M,qe,{},!1)),w.run(0),y=!1},d(q){q&&(D(e),D(t),D(k),D(M)),N&&N.d(q),L&&L.d(),s[11](null),q&&p&&p.end(),q&&w&&w.end(),b=!1,ve($)}}}function In(s,e,t){let{$$slots:l={},$$scope:n}=e,{title:i}=e,{cancelText:r=""}=e,{confirmText:a=""}=e,{onCancel:o}=e,{onConfirm:f=void 0}=e,{confirmClass:c="btn-primary"}=e,{confirmDisabled:u=!1}=e,d;Qe(()=>{document.body.classList.add("modal-open"),d.focus()}),rt(()=>{document.body.classList.remove("modal-open")});const g=p=>{p.key=="Escape"&&o()};function h(p){Ce[p?"unshift":"push"](()=>{d=p,t(7,d)})}return s.$$set=p=>{"title"in p&&t(0,i=p.title),"cancelText"in p&&t(1,r=p.cancelText),"confirmText"in p&&t(2,a=p.confirmText),"onCancel"in p&&t(3,o=p.onCancel),"onConfirm"in p&&t(4,f=p.onConfirm),"confirmClass"in p&&t(5,c=p.confirmClass),"confirmDisabled"in p&&t(6,u=p.confirmDisabled),"$$scope"in p&&t(9,n=p.$$scope)},[i,r,a,o,f,c,u,d,g,n,l,h]}class Ue extends me{constructor(e){super(),de(this,e,In,qn,ce,{title:0,cancelText:1,confirmText:2,onCancel:3,onConfirm:4,confirmClass:5,confirmDisabled:6})}}function St(s){let e,t;return e=new Ue({props:{title:s[1].strings.error,onCancel:s[2],$$slots:{default:[En]},$$scope:{ctx:s}}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&2&&(i.title=l[1].strings.error),n&1&&(i.onCancel=l[2]),n&10&&(i.$$scope={dirty:n,ctx:l}),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function Tt(s){var n;let e,t=((n=s[1].error)==null?void 0:n.debuginfo)+"",l;return{c(){e=v("p"),l=B(t)},m(i,r){C(i,e,r),_(e,l)},p(i,r){var a;r&2&&t!==(t=((a=i[1].error)==null?void 0:a.debuginfo)+"")&&F(l,t)},d(i){i&&D(e)}}}function Lt(s){var n;let e,t=((n=s[1].error)==null?void 0:n.stacktrace)+"",l;return{c(){e=v("pre"),l=B(t)},m(i,r){C(i,e,r),_(e,l)},p(i,r){var a;r&2&&t!==(t=((a=i[1].error)==null?void 0:a.stacktrace)+"")&&F(l,t)},d(i){i&&D(e)}}}function En(s){var f,c,u;let e,t=((f=s[1].error)==null?void 0:f.message)+"",l,n,i,r,a=((c=s[1].error)==null?void 0:c.debuginfo)&&Tt(s),o=((u=s[1].error)==null?void 0:u.stacktrace)&&Lt(s);return{c(){e=v("p"),l=B(t),n=T(),a&&a.c(),i=T(),o&&o.c(),r=be()},m(d,g){C(d,e,g),_(e,l),C(d,n,g),a&&a.m(d,g),C(d,i,g),o&&o.m(d,g),C(d,r,g)},p(d,g){var h,p,k;g&2&&t!==(t=((h=d[1].error)==null?void 0:h.message)+"")&&F(l,t),(p=d[1].error)!=null&&p.debuginfo?a?a.p(d,g):(a=Tt(d),a.c(),a.m(i.parentNode,i)):a&&(a.d(1),a=null),(k=d[1].error)!=null&&k.stacktrace?o?o.p(d,g):(o=Lt(d),o.c(),o.m(r.parentNode,r)):o&&(o.d(1),o=null)},d(d){d&&(D(e),D(n),D(i),D(r)),a&&a.d(d),o&&o.d(d)}}}function Rn(s){let e,t,l=s[1].error&&St(s);return{c(){l&&l.c(),e=be()},m(n,i){l&&l.m(n,i),C(n,e,i),t=!0},p(n,[i]){n[1].error?l?(l.p(n,i),i&2&&S(l,1)):(l=St(n),l.c(),S(l,1),l.m(e.parentNode,e)):l&&(re(),j(l,1,1,()=>{l=null}),ae())},i(n){t||(S(l),t=!0)},o(n){j(l),t=!1},d(n){n&&D(e),l&&l.d(n)}}}function Fn(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,o=>t(1,l=o)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=()=>r.setError();return s.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,l,a]}class Pn extends me{constructor(e){super(),de(this,e,Fn,Rn,ce,{store:0})}}function On(s){let e,t,l,n,i,r;return{c(){e=v("button"),t=v("i"),m(t,"class","fa fa-fw fa-trash"),m(e,"type","button"),m(e,"class","local-mail-action-delete btn"),e.disabled=l=!s[2].selectedMessages.size,m(e,"title",n=s[2].strings.delete),G(e,"btn-secondary",!s[1]),G(e,"disabled",!s[2].selectedMessages.size)},m(a,o){C(a,e,o),_(e,t),i||(r=O(e,"click",s[3]),i=!0)},p(a,[o]){o&4&&l!==(l=!a[2].selectedMessages.size)&&(e.disabled=l),o&4&&n!==(n=a[2].strings.delete)&&m(e,"title",n),o&2&&G(e,"btn-secondary",!a[1]),o&4&&G(e,"disabled",!a[2].selectedMessages.size)},i:U,o:U,d(a){a&&D(e),i=!1,r()}}}function Hn(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,f=>t(2,l=f)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:a=!1}=e;const o=()=>r.setDeleted(Array.from(l.selectedMessages.keys()),Oe.Deleted,!0);return s.$$set=f=>{"store"in f&&i(t(0,r=f.store)),"transparent"in f&&t(1,a=f.transparent)},[r,a,l,o]}class Zs extends me{constructor(e){super(),de(this,e,Hn,On,ce,{store:0,transparent:1})}}function zt(s){let e,t;return e=new Ue({props:{title:s[2].strings.deleteforever,cancelText:s[2].strings.cancel,confirmText:s[2].strings.deleteforever,confirmClass:"btn-danger",onCancel:s[5],onConfirm:s[3],$$slots:{default:[Un]},$$scope:{ctx:s}}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&4&&(i.title=l[2].strings.deleteforever),n&4&&(i.cancelText=l[2].strings.cancel),n&4&&(i.confirmText=l[2].strings.deleteforever),n&1&&(i.onCancel=l[5]),n&68&&(i.$$scope={dirty:n,ctx:l}),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function Un(s){let e=s[2].strings.messagedeleteconfirm+"",t;return{c(){t=B(e)},m(l,n){C(l,t,n)},p(l,n){n&4&&e!==(e=l[2].strings.messagedeleteconfirm+"")&&F(t,e)},d(l){l&&D(t)}}}function Gn(s){let e,t,l,n,i,r,a,o,f,c=s[2].params.dialog=="deleteforever"&&zt(s);return{c(){e=v("button"),t=v("i"),i=T(),c&&c.c(),r=be(),m(t,"class","fa fa-fw fa-trash"),m(e,"type","button"),m(e,"class","local-mail-action-delete-forever btn"),e.disabled=l=!s[2].selectedMessages.size,m(e,"title",n=s[2].strings.deleteforever),G(e,"btn-secondary",!s[1]),G(e,"disabled",!s[2].selectedMessages.size)},m(u,d){C(u,e,d),_(e,t),C(u,i,d),c&&c.m(u,d),C(u,r,d),a=!0,o||(f=O(e,"click",s[4]),o=!0)},p(u,[d]){(!a||d&4&&l!==(l=!u[2].selectedMessages.size))&&(e.disabled=l),(!a||d&4&&n!==(n=u[2].strings.deleteforever))&&m(e,"title",n),(!a||d&2)&&G(e,"btn-secondary",!u[1]),(!a||d&4)&&G(e,"disabled",!u[2].selectedMessages.size),u[2].params.dialog=="deleteforever"?c?(c.p(u,d),d&4&&S(c,1)):(c=zt(u),c.c(),S(c,1),c.m(r.parentNode,r)):c&&(re(),j(c,1,1,()=>{c=null}),ae())},i(u){a||(S(c),a=!0)},o(u){j(c),a=!1},d(u){u&&(D(e),D(i),D(r)),c&&c.d(u),o=!1,f()}}}function Vn(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,u=>t(2,l=u)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:a=!1}=e;const o=()=>{r.hideDialog(),r.setDeleted(Array.from(l.selectedMessages.keys()),Oe.DeletedForever,!0)},f=()=>r.showDialog("deleteforever"),c=()=>r.hideDialog();return s.$$set=u=>{"store"in u&&i(t(0,r=u.store)),"transparent"in u&&t(1,a=u.transparent)},[r,a,l,o,f,c]}class xs extends me{constructor(e){super(),de(this,e,Vn,Gn,ce,{store:0,transparent:1})}}const lt=["","blue","indigo","purple","pink","red","orange","yellow","green","teal","cyan"];function jt(s){if(s==0)return"";const e=new Date(s*1e3);return[String(e.getFullYear()),String(e.getMonth()+1).padStart(2,"0"),String(e.getDate()).padStart(2,"0")].join("-")}function Nt(s){const e=[{bytes:1099511627776,name:"TB"},{bytes:1073741824,name:"GB"},{bytes:1048576,name:"MB"},{bytes:1024,name:"KB"}];for(const t of e)if(s>=t.bytes)return`${Intl.NumberFormat(void 0,{maximumFractionDigits:1}).format(s/t.bytes)} ${t.name}`;return`${s} B`}function At(s){return s.trim().replaceAll(/\s+/gu," ")}function je(s,e){if(s=s||"",typeof e=="string"||typeof e=="number")s=s.replace("{$a}",e.toString());else for(const t in e)s=s.replace(`{$a->${t}}`,e[t].toString());return s}function Kn(s){return s?Math.floor(new Date(parseInt(s.slice(0,4)),parseInt(s.slice(5,7))-1,parseInt(s.slice(8,10)),23,59,59).getTime()/1e3):0}function Bt(s,e,t){const l=s.slice();return l[16]=e[t],l}function Yn(s){let e;return{c(){e=v("span"),e.textContent="a",m(e,"aria-hidden","true")},m(t,l){C(t,e,l)},d(t){t&&D(e)}}}function Jn(s){let e;return{c(){e=v("i"),m(e,"class","fa fa-check local-mail-label-modal-color-option-check")},m(t,l){C(t,e,l)},d(t){t&&D(e)}}}function qt(s,e){let t,l,n,i,r,a;function o(d,g){return d[16]==d[7]?Jn:Yn}let f=o(e),c=f(e);function u(){return e[15](e[16])}return{key:s,first:null,c(){t=v("button"),c.c(),l=T(),m(t,"role","radio"),m(t,"aria-checked",n=e[16]==e[7]),m(t,"tabindex","0"),m(t,"title",i=e[5].strings[`color${e[16]}`]),m(t,"class","local-mail-label-modal-color-option btn svelte-cky3j8"),m(t,"style",`color: var(--local-mail-color-${e[16]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${e[16]}-bg, var(--local-mail-color-gray-bg))`),this.first=t},m(d,g){C(d,t,g),c.m(t,null),_(t,l),r||(a=O(t,"click",Se(u)),r=!0)},p(d,g){e=d,f!==(f=o(e))&&(c.d(1),c=f(e),c&&(c.c(),c.m(t,l))),g&128&&n!==(n=e[16]==e[7])&&m(t,"aria-checked",n),g&32&&i!==(i=e[5].strings[`color${e[16]}`])&&m(t,"title",i)},d(d){d&&D(t),c.d(),r=!1,a()}}}function Wn(s){let e,t,l,n=s[5].strings.labelname+"",i,r,a,o,f,c,u=s[5].strings[s[4]?"errorrepeatedlabelname":"erroremptylabelname"]+"",d,g,h,p,k,M,w=s[5].strings.labelcolor+"",y,b,$,z,N=[],L=new Map,q,H,Y,V=fe(lt);const ee=I=>I[16];for(let I=0;I<V.length;I+=1){let K=Bt(s,V,I),te=ee(K);L.set(te,N[I]=qt(te,K))}return{c(){e=v("form"),t=v("div"),l=v("label"),i=B(n),r=T(),a=v("input"),f=T(),c=v("div"),d=B(u),g=T(),h=v("div"),h.textContent=" ",p=T(),k=v("div"),M=v("label"),y=B(w),$=T(),z=v("div");for(let I=0;I<N.length;I+=1)N[I].c();m(l,"for","local-mail-label-modal-name"),m(a,"type","text"),a.required=!0,m(a,"class","form-control is-invalid"),m(a,"id",o=s[9]+"-name"),G(a,"is-valid",s[8]),G(a,"is-invalid",!s[8]),m(c,"class","invalid-feedback"),m(h,"class","valid-feedback"),m(t,"class","form-group"),m(M,"for",b=s[9]+"-color"),m(z,"role","radiogroup"),m(z,"class","local-mail-label-modal-color svelte-cky3j8"),m(z,"id",q=s[9]+"-color"),m(k,"class","form-group")},m(I,K){C(I,e,K),_(e,t),_(t,l),_(l,i),_(t,r),_(t,a),s[13](a),we(a,s[3]),_(t,f),_(t,c),_(c,d),_(t,g),_(t,h),_(e,p),_(e,k),_(k,M),_(M,y),_(k,$),_(k,z);for(let te=0;te<N.length;te+=1)N[te]&&N[te].m(z,null);H||(Y=[O(a,"input",s[14]),O(e,"submit",Se(s[10]))],H=!0)},p(I,K){K&32&&n!==(n=I[5].strings.labelname+"")&&F(i,n),K&512&&o!==(o=I[9]+"-name")&&m(a,"id",o),K&8&&a.value!==I[3]&&we(a,I[3]),K&256&&G(a,"is-valid",I[8]),K&256&&G(a,"is-invalid",!I[8]),K&48&&u!==(u=I[5].strings[I[4]?"errorrepeatedlabelname":"erroremptylabelname"]+"")&&F(d,u),K&32&&w!==(w=I[5].strings.labelcolor+"")&&F(y,w),K&512&&b!==(b=I[9]+"-color")&&m(M,"for",b),K&160&&(V=fe(lt),N=De(N,K,ee,1,I,V,L,z,He,qt,null,Bt)),K&512&&q!==(q=I[9]+"-color")&&m(z,"id",q)},d(I){I&&D(e),s[13](null);for(let K=0;K<N.length;K+=1)N[K].d();H=!1,ve(Y)}}}function Xn(s){let e,t;return e=new Ue({props:{title:s[5].strings[s[1]?"editlabel":"newlabel"],cancelText:s[5].strings.cancel,onCancel:s[2],confirmText:s[5].strings[s[1]?"save":"create"],confirmDisabled:!s[8],onConfirm:s[10],$$slots:{default:[Wn]},$$scope:{ctx:s}}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,[n]){const i={};n&34&&(i.title=l[5].strings[l[1]?"editlabel":"newlabel"]),n&32&&(i.cancelText=l[5].strings.cancel),n&4&&(i.onCancel=l[2]),n&34&&(i.confirmText=l[5].strings[l[1]?"save":"create"]),n&256&&(i.confirmDisabled=!l[8]),n&525304&&(i.$$scope={dirty:n,ctx:l}),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function Qn(s,e,t){let l,n,i,r,a,o,f,c=U,u=()=>(c(),c=_e(d,$=>t(5,f=$)),d);s.$$.on_destroy.push(()=>c());let{store:d}=e;u();let{label:g=void 0}=e,{onCancel:h}=e,{onSubmit:p}=e,k;const M=async()=>{p(n,i)};Qe(()=>k.focus());function w($){Ce[$?"unshift":"push"](()=>{k=$,t(6,k)})}function y(){n=this.value,t(3,n),t(1,g)}const b=$=>{t(7,i=$)};return s.$$set=$=>{"store"in $&&u(t(0,d=$.store)),"label"in $&&t(1,g=$.label),"onCancel"in $&&t(2,h=$.onCancel),"onSubmit"in $&&t(11,p=$.onSubmit)},s.$$.update=()=>{s.$$.dirty&2&&t(9,l=`local-mail-label-modal-${(g==null?void 0:g.id)||"new"}`),s.$$.dirty&2&&t(3,n=(g==null?void 0:g.name)||""),s.$$.dirty&2&&t(7,i=(g==null?void 0:g.color)||lt[0]),s.$$.dirty&8&&t(12,r=At(n)==""),s.$$.dirty&42&&t(4,a=f.labels.some($=>$.id!=(g==null?void 0:g.id)&&$.name==At(n))),s.$$.dirty&4112&&t(8,o=!r&&!a)},[d,g,h,n,a,f,k,i,o,l,M,p,r,w,y,b]}class en extends me{constructor(e){super(),de(this,e,Qn,Xn,ce,{store:0,label:1,onCancel:2,onSubmit:11})}}const{Map:Zn}=Ze;function It(s,e,t){const l=s.slice();return l[16]=e[t],l}function Et(s){let e,t=[],l=new Zn,n,i,r=fe(s[3].labels);const a=d=>d[16].id;for(let d=0;d<r.length;d+=1){let g=It(s,r,d),h=a(g);l.set(h,t[d]=Rt(h,g))}let o=s[3].labels.length>0&&Ft();function f(d,g){return d[6]?ei:xn}let c=f(s),u=c(s);return{c(){e=v("div");for(let d=0;d<t.length;d+=1)t[d].c();n=T(),o&&o.c(),i=T(),u.c(),m(e,"class","dropdown-menu show")},m(d,g){C(d,e,g);for(let h=0;h<t.length;h+=1)t[h]&&t[h].m(e,null);_(e,n),o&&o.m(e,null),_(e,i),u.m(e,null)},p(d,g){g&552&&(r=fe(d[3].labels),t=De(t,g,a,1,d,r,l,e,He,Rt,n,It)),d[3].labels.length>0?o||(o=Ft(),o.c(),o.m(e,i)):o&&(o.d(1),o=null),c===(c=f(d))&&u?u.p(d,g):(u.d(1),u=c(d),u&&(u.c(),u.m(e,null)))},d(d){d&&D(e);for(let g=0;g<t.length;g+=1)t[g].d();o&&o.d(),u.d()}}}function Rt(s,e){let t,l,n,i,r=e[16].name+"",a,o,f;function c(){return e[14](e[16])}return{key:s,first:null,c(){t=v("button"),l=v("i"),i=T(),a=B(r),m(l,"class",n="fa fa-fw "+e[5](e[16].id)+" svelte-ufjoxg"),m(t,"type","button"),m(t,"class","dropdown-item local-mail-action-label-button-item"),this.first=t},m(u,d){C(u,t,d),_(t,l),_(t,i),_(t,a),o||(f=O(t,"click",c),o=!0)},p(u,d){e=u,d&40&&n!==(n="fa fa-fw "+e[5](e[16].id)+" svelte-ufjoxg")&&m(l,"class",n),d&8&&r!==(r=e[16].name+"")&&F(a,r)},d(u){u&&D(t),o=!1,f()}}}function Ft(s){let e;return{c(){e=v("div"),m(e,"class","dropdown-divider")},m(t,l){C(t,e,l)},d(t){t&&D(e)}}}function xn(s){let e,t=s[3].strings.newlabel+"",l,n,i;return{c(){e=v("button"),l=B(t),m(e,"type","button"),m(e,"class","dropdown-item local-mail-action-label-button-item")},m(r,a){C(r,e,a),_(e,l),n||(i=O(e,"click",s[11]),n=!0)},p(r,a){a&8&&t!==(t=r[3].strings.newlabel+"")&&F(l,t)},d(r){r&&D(e),n=!1,i()}}}function ei(s){let e,t=s[3].strings.applychanges+"",l,n,i;return{c(){e=v("button"),l=B(t),m(e,"type","button"),m(e,"class","dropdown-item local-mail-action-label-button-item")},m(r,a){C(r,e,a),_(e,l),n||(i=O(e,"click",s[10]),n=!0)},p(r,a){a&8&&t!==(t=r[3].strings.applychanges+"")&&F(l,t)},d(r){r&&D(e),n=!1,i()}}}function Pt(s){let e,t;return e=new en({props:{store:s[0],onCancel:s[15],onSubmit:s[12]}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&1&&(i.store=l[0]),n&1&&(i.onCancel=l[15]),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function ti(s){let e,t,l,n,i,r,a,o,f,c,u=s[4]&&Et(s),d=s[3].params.dialog=="createlabel"&&Pt(s);return{c(){e=v("div"),t=v("button"),l=v("i"),r=T(),u&&u.c(),a=T(),d&&d.c(),m(l,"class","fa fa-fw fa-tag"),m(t,"type","button"),m(t,"class","local-mail-action-label-button btn dropdown-toggle svelte-ufjoxg"),t.disabled=n=!s[3].selectedMessages.size,m(t,"aria-expanded",s[4]),m(t,"title",i=s[3].strings.labels),G(t,"btn-secondary",!s[1]),G(t,"disabled",!s[3].selectedMessages.size),m(e,"class","btn-group"),m(e,"role","group"),G(e,"dropup",s[2])},m(g,h){C(g,e,h),_(e,t),_(t,l),_(e,r),u&&u.m(e,null),_(e,a),d&&d.m(e,null),o=!0,f||(c=[O(t,"click",s[8]),$e(Pe.call(null,e,s[7]))],f=!0)},p(g,[h]){(!o||h&8&&n!==(n=!g[3].selectedMessages.size))&&(t.disabled=n),(!o||h&16)&&m(t,"aria-expanded",g[4]),(!o||h&8&&i!==(i=g[3].strings.labels))&&m(t,"title",i),(!o||h&2)&&G(t,"btn-secondary",!g[1]),(!o||h&8)&&G(t,"disabled",!g[3].selectedMessages.size),g[4]?u?u.p(g,h):(u=Et(g),u.c(),u.m(e,a)):u&&(u.d(1),u=null),g[3].params.dialog=="createlabel"?d?(d.p(g,h),h&8&&S(d,1)):(d=Pt(g),d.c(),S(d,1),d.m(e,null)):d&&(re(),j(d,1,1,()=>{d=null}),ae()),(!o||h&4)&&G(e,"dropup",g[2])},i(g){o||(S(d),o=!0)},o(g){j(d),o=!1},d(g){g&&D(e),u&&u.d(),d&&d.d(),f=!1,ve(c)}}}function li(s,e,t){let l,n,i,r=U,a=()=>(r(),r=_e(o,$=>t(3,i=$)),o);s.$$.on_destroy.push(()=>r());let{store:o}=e;a();let{transparent:f=!1}=e,{dropup:c=!1}=e,u=!1,d=new Map;const g=()=>{t(4,u=!1)},h=()=>{t(4,u=!u)},p=$=>{t(13,d=new Map(Array.from(d.entries()).map(([z,N])=>[z,z==$?N=="true"?"false":"true":N])))},k=()=>{t(4,u=!1),o.setLabels(Array.from(d.keys()).filter($=>d.get($)=="true"),Array.from(d.keys()).filter($=>d.get($)=="false"))},M=()=>{g(),o.showDialog("createlabel")},w=async($,z)=>{o.hideDialog();const N=await o.createLabel($,z);N&&o.setLabels([N],[])},y=$=>p($.id),b=()=>o.hideDialog();return s.$$set=$=>{"store"in $&&a(t(0,o=$.store)),"transparent"in $&&t(1,f=$.transparent),"dropup"in $&&t(2,c=$.dropup)},s.$$.update=()=>{s.$$.dirty&8&&t(13,d=new Map(i.labels.map($=>{const z=Array.from(i.selectedMessages.values()).filter(N=>N.labels.some(L=>L.id==$.id));return[$.id,z.length==0?"false":z.length<i.selectedMessages.size?"mixed":"true"]}))),s.$$.dirty&8200&&t(6,l=Array.from(d.entries()).some(([$,z])=>Array.from(i.selectedMessages.values()).some(N=>z=="true"&&N.labels.every(L=>L.id!=$)||z=="false"&&N.labels.some(L=>L.id==$)))),s.$$.dirty&8192&&t(5,n=$=>d.get($)=="false"?"fa-square-o":d.get($)=="mixed"?"fa-minus-square-o":"fa-check-square-o")},[o,f,c,i,u,n,l,g,h,p,k,M,w,d,y,b]}class tn extends me{constructor(e){super(),de(this,e,li,ti,ce,{store:0,transparent:1,dropup:2})}}function Ot(s){let e;function t(i,r){return i[8].params.tray=="trash"?ni:si}let l=t(s),n=l(s);return{c(){e=v("div"),n.c(),m(e,"class","dropdown-menu show")},m(i,r){C(i,e,r),n.m(e,null)},p(i,r){l===(l=t(i))&&n?n.p(i,r):(n.d(1),n=l(i),n&&(n.c(),n.m(e,null)))},d(i){i&&D(e),n.d()}}}function si(s){let e,t,l,n,i,r=s[6]&&Ht(s),a=s[7]&&Ut(s),o=s[4]&&Gt(s),f=s[5]&&Vt(s),c=s[3]&&Kt(s);return{c(){r&&r.c(),e=T(),a&&a.c(),t=T(),o&&o.c(),l=T(),f&&f.c(),n=T(),c&&c.c(),i=be()},m(u,d){r&&r.m(u,d),C(u,e,d),a&&a.m(u,d),C(u,t,d),o&&o.m(u,d),C(u,l,d),f&&f.m(u,d),C(u,n,d),c&&c.m(u,d),C(u,i,d)},p(u,d){u[6]?r?r.p(u,d):(r=Ht(u),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),u[7]?a?a.p(u,d):(a=Ut(u),a.c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null),u[4]?o?o.p(u,d):(o=Gt(u),o.c(),o.m(l.parentNode,l)):o&&(o.d(1),o=null),u[5]?f?f.p(u,d):(f=Vt(u),f.c(),f.m(n.parentNode,n)):f&&(f.d(1),f=null),u[3]?c?c.p(u,d):(c=Kt(u),c.c(),c.m(i.parentNode,i)):c&&(c.d(1),c=null)},d(u){u&&(D(e),D(t),D(l),D(n),D(i)),r&&r.d(u),a&&a.d(u),o&&o.d(u),f&&f.d(u),c&&c.d(u)}}}function ni(s){let e,t=s[8].strings.emptytrash+"",l,n,i;return{c(){e=v("button"),l=B(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,a){C(r,e,a),_(e,l),n||(i=O(e,"click",s[19]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.emptytrash+"")&&F(l,t)},d(r){r&&D(e),n=!1,i()}}}function Ht(s){let e,t=s[8].strings.markasread+"",l,n,i;return{c(){e=v("button"),l=B(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,a){C(r,e,a),_(e,l),n||(i=O(e,"click",s[22]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.markasread+"")&&F(l,t)},d(r){r&&D(e),n=!1,i()}}}function Ut(s){let e,t=s[8].strings.markasunread+"",l,n,i;return{c(){e=v("button"),l=B(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,a){C(r,e,a),_(e,l),n||(i=O(e,"click",s[23]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.markasunread+"")&&F(l,t)},d(r){r&&D(e),n=!1,i()}}}function Gt(s){let e,t=s[8].strings.markasstarred+"",l,n,i;return{c(){e=v("button"),l=B(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,a){C(r,e,a),_(e,l),n||(i=O(e,"click",s[24]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.markasstarred+"")&&F(l,t)},d(r){r&&D(e),n=!1,i()}}}function Vt(s){let e,t=s[8].strings.markasunstarred+"",l,n,i;return{c(){e=v("button"),l=B(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,a){C(r,e,a),_(e,l),n||(i=O(e,"click",s[25]),n=!0)},p(r,a){a&256&&t!==(t=r[8].strings.markasunstarred+"")&&F(l,t)},d(r){r&&D(e),n=!1,i()}}}function Kt(s){let e,t,l=s[8].strings.editlabel+"",n,i,r,a=s[8].strings.deletelabel+"",o,f,c,u=(s[6]||s[7]||s[4]||s[5])&&Yt();return{c(){u&&u.c(),e=T(),t=v("button"),n=B(l),i=T(),r=v("button"),o=B(a),m(t,"type","button"),m(t,"class","dropdown-item"),m(r,"type","button"),m(r,"class","dropdown-item")},m(d,g){u&&u.m(d,g),C(d,e,g),C(d,t,g),_(t,n),C(d,i,g),C(d,r,g),_(r,o),f||(c=[O(t,"click",s[15]),O(r,"click",s[17])],f=!0)},p(d,g){d[6]||d[7]||d[4]||d[5]?u||(u=Yt(),u.c(),u.m(e.parentNode,e)):u&&(u.d(1),u=null),g&256&&l!==(l=d[8].strings.editlabel+"")&&F(n,l),g&256&&a!==(a=d[8].strings.deletelabel+"")&&F(o,a)},d(d){d&&(D(e),D(t),D(i),D(r)),u&&u.d(d),f=!1,ve(c)}}}function Yt(s){let e;return{c(){e=v("div"),m(e,"class","dropdown-divider")},m(t,l){C(t,e,l)},d(t){t&&D(e)}}}function ii(s){let e,t,l,n;const i=[oi,ai],r=[];function a(o,f){return o[8].params.dialog=="editlabel"?0:o[8].params.dialog=="deletelabel"?1:-1}return~(e=a(s))&&(t=r[e]=i[e](s)),{c(){t&&t.c(),l=be()},m(o,f){~e&&r[e].m(o,f),C(o,l,f),n=!0},p(o,f){let c=e;e=a(o),e===c?~e&&r[e].p(o,f):(t&&(re(),j(r[c],1,1,()=>{r[c]=null}),ae()),~e?(t=r[e],t?t.p(o,f):(t=r[e]=i[e](o),t.c()),S(t,1),t.m(l.parentNode,l)):t=null)},i(o){n||(S(t),n=!0)},o(o){j(t),n=!1},d(o){o&&D(l),~e&&r[e].d(o)}}}function ri(s){let e,t,l=s[8].params.dialog=="emptytrash"&&Jt(s);return{c(){l&&l.c(),e=be()},m(n,i){l&&l.m(n,i),C(n,e,i),t=!0},p(n,i){n[8].params.dialog=="emptytrash"?l?(l.p(n,i),i&256&&S(l,1)):(l=Jt(n),l.c(),S(l,1),l.m(e.parentNode,e)):l&&(re(),j(l,1,1,()=>{l=null}),ae())},i(n){t||(S(l),t=!0)},o(n){j(l),t=!1},d(n){n&&D(e),l&&l.d(n)}}}function ai(s){let e,t;return e=new Ue({props:{title:s[8].strings.deletelabel,cancelText:s[8].strings.cancel,confirmText:s[8].strings.deletelabel,confirmClass:"btn-danger",onCancel:s[28],onConfirm:s[18],$$slots:{default:[fi]},$$scope:{ctx:s}}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&256&&(i.title=l[8].strings.deletelabel),n&256&&(i.cancelText=l[8].strings.cancel),n&256&&(i.confirmText=l[8].strings.deletelabel),n&1&&(i.onCancel=l[28]),n&536871176&&(i.$$scope={dirty:n,ctx:l}),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function oi(s){let e,t;return e=new en({props:{store:s[0],label:s[3],onCancel:s[27],onSubmit:s[16]}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&1&&(i.store=l[0]),n&8&&(i.label=l[3]),n&1&&(i.onCancel=l[27]),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function fi(s){let e=je(s[8].strings.labeldeleteconfirm,s[3].name)+"",t;return{c(){t=B(e)},m(l,n){C(l,t,n)},p(l,n){n&264&&e!==(e=je(l[8].strings.labeldeleteconfirm,l[3].name)+"")&&F(t,e)},d(l){l&&D(t)}}}function Jt(s){let e,t;return e=new Ue({props:{title:s[8].strings.emptytrash,cancelText:s[8].strings.cancel,confirmText:s[8].strings.emptytrash,confirmClass:"btn-danger",onCancel:s[26],onConfirm:s[20],$$slots:{default:[ui]},$$scope:{ctx:s}}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&256&&(i.title=l[8].strings.emptytrash),n&256&&(i.cancelText=l[8].strings.cancel),n&256&&(i.confirmText=l[8].strings.emptytrash),n&1&&(i.onCancel=l[26]),n&536871168&&(i.$$scope={dirty:n,ctx:l}),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function ui(s){let e=s[8].strings.emptytrashconfirm+"",t;return{c(){t=B(e)},m(l,n){C(l,t,n)},p(l,n){n&256&&e!==(e=l[8].strings.emptytrashconfirm+"")&&F(t,e)},d(l){l&&D(t)}}}function ci(s){let e,t,l,n,i,r,a,o,f,c,u,d,g=s[9]&&Ot(s);const h=[ri,ii],p=[];function k(M,w){return M[8].params.tray=="trash"?0:M[3]?1:-1}return~(a=k(s))&&(o=p[a]=h[a](s)),{c(){e=v("div"),t=v("button"),l=v("i"),i=T(),g&&g.c(),r=T(),o&&o.c(),f=be(),m(l,"class","fa fa-fw fa-ellipsis-v"),m(t,"type","button"),m(t,"class","local-mail-action-more-button btn dropdown-toggle svelte-kx0nzt"),t.disabled=s[10],m(t,"aria-expanded",s[9]),m(t,"title",n=s[8].strings.moreactions),G(t,"btn-secondary",!s[1]),G(t,"disabled",s[10]),m(e,"class","btn-group"),G(e,"dropup",s[2])},m(M,w){C(M,e,w),_(e,t),_(t,l),_(e,i),g&&g.m(e,null),C(M,r,w),~a&&p[a].m(M,w),C(M,f,w),c=!0,u||(d=[O(t,"click",s[12]),$e(Pe.call(null,e,s[11]))],u=!0)},p(M,[w]){(!c||w&1024)&&(t.disabled=M[10]),(!c||w&512)&&m(t,"aria-expanded",M[9]),(!c||w&256&&n!==(n=M[8].strings.moreactions))&&m(t,"title",n),(!c||w&2)&&G(t,"btn-secondary",!M[1]),(!c||w&1024)&&G(t,"disabled",M[10]),M[9]?g?g.p(M,w):(g=Ot(M),g.c(),g.m(e,null)):g&&(g.d(1),g=null),(!c||w&4)&&G(e,"dropup",M[2]);let y=a;a=k(M),a===y?~a&&p[a].p(M,w):(o&&(re(),j(p[y],1,1,()=>{p[y]=null}),ae()),~a?(o=p[a],o?o.p(M,w):(o=p[a]=h[a](M),o.c()),S(o,1),o.m(f.parentNode,f)):o=null)},i(M){c||(S(o),c=!0)},o(M){j(o),c=!1},d(M){M&&(D(e),D(r),D(f)),g&&g.d(),~a&&p[a].d(M),u=!1,ve(d)}}}function mi(s,e,t){let l,n,i,r,a,o,f,c,u=U,d=()=>(u(),u=_e(g,E=>t(8,c=E)),g);s.$$.on_destroy.push(()=>u());let{store:g}=e;d();let{transparent:h=!1}=e,{dropup:p=!1}=e,k=!1;const M=()=>{t(9,k=!1)},w=()=>{t(9,k=!k)},y=E=>{M(),g.setUnread(n.filter(J=>!J.draft).map(J=>J.id),E)},b=E=>{M(),g.setStarred(n.map(J=>J.id),E)},$=()=>{M(),g.showDialog("editlabel")},z=(E,J)=>{g.hideDialog(),l&&g.updateLabel(l.id,E,J)},N=()=>{M(),g.showDialog("deletelabel")},L=()=>{g.hideDialog(),g.deleteLabel(c.params.labelid||0)},q=()=>{M(),g.showDialog("emptytrash")},H=()=>{g.hideDialog(),g.emptyTrash()},Y=()=>y(!1),V=()=>y(!0),ee=()=>b(!0),I=()=>b(!1),K=()=>g.hideDialog(),te=()=>g.hideDialog(),oe=()=>g.hideDialog();return s.$$set=E=>{"store"in E&&d(t(0,g=E.store)),"transparent"in E&&t(1,h=E.transparent),"dropup"in E&&t(2,p=E.dropup)},s.$$.update=()=>{s.$$.dirty&256&&t(3,l=c.params.tray=="label"&&c.message==null?c.labels.find(E=>E.id==c.params.labelid):null),s.$$.dirty&256&&t(21,n=Array.from(c.selectedMessages.values())),s.$$.dirty&2097152&&t(7,i=n.some(E=>!E.draft&&!E.unread)),s.$$.dirty&2097152&&t(6,r=n.some(E=>!E.draft&&E.unread)),s.$$.dirty&2097152&&t(5,a=n.some(E=>E.starred)),s.$$.dirty&2097152&&t(4,o=n.some(E=>!E.starred)),s.$$.dirty&504&&t(10,f=c.params.tray=="trash"?!c.totalCount:!l&&!i&&!r&&!a&&!o)},[g,h,p,l,o,a,r,i,c,k,f,M,w,y,b,$,z,N,L,q,H,n,Y,V,ee,I,K,te,oe]}class ln extends me{constructor(e){super(),de(this,e,mi,ci,ce,{store:0,transparent:1,dropup:2})}}function Wt(s){let e,t;return{c(){e=v("div"),t=B(s[4]),m(e,"class","align-self-center text-nowrap")},m(l,n){C(l,e,n),_(e,t)},p(l,n){n&16&&F(t,l[4])},d(l){l&&D(e)}}}function Xt(s){let e,t;return{c(){e=v("div"),t=B(s[4]),m(e,"class","text-truncate align-self-center mx-2")},m(l,n){C(l,e,n),_(e,t)},p(l,n){n&16&&F(t,l[4])},d(l){l&&D(e)}}}function di(s){let e,t,l,n,i,r,a,o,f,c,u,d,g,h,p,k,M,w=!s[2]&&Wt(s),y=s[2]&&Xt(s);return{c(){e=v("div"),w&&w.c(),t=T(),l=v("div"),n=v("button"),i=v("i"),f=T(),y&&y.c(),c=T(),u=v("button"),d=v("i"),m(i,"class","fa fa-w fa-chevron-left"),m(i,"aria-label",r=s[3].strings.previouspage),m(n,"type","button"),m(n,"class","btn btn-secondary"),n.disabled=a=!s[5],m(n,"title",o=s[3].strings[s[3].message?"previousmessage":"previouspage"]),G(n,"btn-secondary",!s[1]),m(d,"class","fa fa-w fa-chevron-right"),m(d,"aria-label",g=s[3].strings.nextpage),m(u,"type","button"),m(u,"class","btn"),u.disabled=h=!s[6],m(u,"title",p=s[3].strings[s[3].message?"nextmessage":"nextpage"]),G(u,"btn-secondary",!s[1]),m(l,"class","btn-group d-flex"),m(l,"role","group"),G(l,"btn-group",!s[2]),m(e,"class","local-mail-paging-buttons d-flex svelte-nbwrye"),G(e,"ml-auto",!s[2])},m(b,$){C(b,e,$),w&&w.m(e,null),_(e,t),_(e,l),_(l,n),_(n,i),_(l,f),y&&y.m(l,null),_(l,c),_(l,u),_(u,d),k||(M=[O(n,"click",Se(s[9])),O(u,"click",Se(s[10]))],k=!0)},p(b,[$]){b[2]?w&&(w.d(1),w=null):w?w.p(b,$):(w=Wt(b),w.c(),w.m(e,t)),$&8&&r!==(r=b[3].strings.previouspage)&&m(i,"aria-label",r),$&32&&a!==(a=!b[5])&&(n.disabled=a),$&8&&o!==(o=b[3].strings[b[3].message?"previousmessage":"previouspage"])&&m(n,"title",o),$&2&&G(n,"btn-secondary",!b[1]),b[2]?y?y.p(b,$):(y=Xt(b),y.c(),y.m(l,c)):y&&(y.d(1),y=null),$&8&&g!==(g=b[3].strings.nextpage)&&m(d,"aria-label",g),$&64&&h!==(h=!b[6])&&(u.disabled=h),$&8&&p!==(p=b[3].strings[b[3].message?"nextmessage":"nextpage"])&&m(u,"title",p),$&2&&G(u,"btn-secondary",!b[1]),$&4&&G(l,"btn-group",!b[2]),$&4&&G(e,"ml-auto",!b[2])},i:U,o:U,d(b){b&&D(e),w&&w.d(),y&&y.d(),k=!1,ve(M)}}}function _i(s,e,t){let l,n,i,r,a,o,f=U,c=()=>(f(),f=_e(u,k=>t(3,o=k)),u);s.$$.on_destroy.push(()=>f());let{store:u}=e;c();let{transparent:d=!1}=e,{compact:g=!1}=e;const h=()=>u.navigate(r),p=()=>u.navigate(i);return s.$$set=k=>{"store"in k&&c(t(0,u=k.store)),"transparent"in k&&t(1,d=k.transparent),"compact"in k&&t(2,g=k.compact)},s.$$.update=()=>{var k;s.$$.dirty&8&&t(8,l=o.nextMessageId||!o.params.search&&(o.params.offset||0)+o.preferences.perpage<o.totalCount),s.$$.dirty&8&&t(7,n=o.prevMessageId||!o.params.search&&(o.params.offset||0)),s.$$.dirty&264&&t(6,i=l?o.message?{...o.params,messageid:o.nextMessageId,offset:(o.params.offset||0)+1}:{...o.params,messageid:void 0,offset:(o.params.offset||0)+o.preferences.perpage,search:o.params.search?{...o.params.search,startid:(k=o.listMessages[o.listMessages.length-1])==null?void 0:k.id,reverse:!1}:void 0}:void 0),s.$$.dirty&136&&t(5,r=n?o.message?{...o.params,messageid:o.prevMessageId,offset:Math.max(0,(o.params.offset||0)-1)}:{...o.params,messageid:void 0,offset:Math.max(0,(o.params.offset||0)-o.preferences.perpage),search:o.params.search?{...o.params.search,startid:o.listMessages[0].id,reverse:!0}:void 0}:void 0),s.$$.dirty&8&&t(4,a=o.message?o.params.search?(o.params.offset||0)+1:je(o.strings.pagingsingle,{index:(o.messageOffset||0)+1,total:o.totalCount}):o.listMessages.length==0?"":o.params.search?je(o.strings.pagingsearch,{first:(o.params.offset||0)+1,last:(o.params.offset||0)+o.listMessages.length}):je(o.strings.pagingmultiple,{first:(o.params.offset||0)+1,last:(o.params.offset||0)+o.listMessages.length,total:o.totalCount}))},[u,d,g,o,a,r,i,n,l,h,p]}class sn extends me{constructor(e){super(),de(this,e,_i,di,ce,{store:0,transparent:1,compact:2})}}function Qt(s){let e,t;return e=new Ue({props:{title:s[2].strings.restore,cancelText:s[2].strings.cancel,confirmText:s[2].strings.restore,onCancel:s[5],onConfirm:s[3],$$slots:{default:[gi]},$$scope:{ctx:s}}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&4&&(i.title=l[2].strings.restore),n&4&&(i.cancelText=l[2].strings.cancel),n&4&&(i.confirmText=l[2].strings.restore),n&1&&(i.onCancel=l[5]),n&68&&(i.$$scope={dirty:n,ctx:l}),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function gi(s){let e=s[2].strings.messagerestoreconfirm+"",t;return{c(){t=B(e)},m(l,n){C(l,t,n)},p(l,n){n&4&&e!==(e=l[2].strings.messagerestoreconfirm+"")&&F(t,e)},d(l){l&&D(t)}}}function pi(s){let e,t,l,n,i,r,a,o,f,c=s[2].params.dialog=="restore"&&Qt(s);return{c(){e=v("button"),t=v("i"),i=T(),c&&c.c(),r=be(),m(t,"class","fa fa-fw fa-undo"),m(e,"type","button"),m(e,"class","local-mail-action-delete btn"),e.disabled=l=!s[2].selectedMessages.size,m(e,"title",n=s[2].strings.restore),G(e,"btn-secondary",!s[1]),G(e,"disabled",!s[2].selectedMessages.size)},m(u,d){C(u,e,d),_(e,t),C(u,i,d),c&&c.m(u,d),C(u,r,d),a=!0,o||(f=O(e,"click",s[4]),o=!0)},p(u,[d]){(!a||d&4&&l!==(l=!u[2].selectedMessages.size))&&(e.disabled=l),(!a||d&4&&n!==(n=u[2].strings.restore))&&m(e,"title",n),(!a||d&2)&&G(e,"btn-secondary",!u[1]),(!a||d&4)&&G(e,"disabled",!u[2].selectedMessages.size),u[2].params.dialog=="restore"?c?(c.p(u,d),d&4&&S(c,1)):(c=Qt(u),c.c(),S(c,1),c.m(r.parentNode,r)):c&&(re(),j(c,1,1,()=>{c=null}),ae())},i(u){a||(S(c),a=!0)},o(u){j(c),a=!1},d(u){u&&(D(e),D(i),D(r)),c&&c.d(u),o=!1,f()}}}function bi(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,u=>t(2,l=u)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{transparent:a=!1}=e;const o=()=>{r.hideDialog(),r.setDeleted(Array.from(l.selectedMessages.keys()),Oe.NotDeleted,!0)},f=()=>r.showDialog("restore"),c=()=>r.hideDialog();return s.$$set=u=>{"store"in u&&i(t(0,r=u.store)),"transparent"in u&&t(1,a=u.transparent)},[r,a,l,o,f,c]}class nn extends me{constructor(e){super(),de(this,e,bi,pi,ce,{store:0,transparent:1})}}function hi(s){let e,t,l,n;return e=new tn({props:{store:s[0],transparent:!0,dropup:!0}}),l=new Zs({props:{store:s[0],transparent:!0}}),{c(){W(e.$$.fragment),t=T(),W(l.$$.fragment)},m(i,r){X(e,i,r),C(i,t,r),X(l,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),l.$set(o)},i(i){n||(S(e.$$.fragment,i),S(l.$$.fragment,i),n=!0)},o(i){j(e.$$.fragment,i),j(l.$$.fragment,i),n=!1},d(i){i&&D(t),Q(e,i),Q(l,i)}}}function vi(s){let e,t,l,n;return e=new nn({props:{store:s[0],transparent:!0}}),l=new xs({props:{store:s[0],transparent:!0}}),{c(){W(e.$$.fragment),t=T(),W(l.$$.fragment)},m(i,r){X(e,i,r),C(i,t,r),X(l,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),l.$set(o)},i(i){n||(S(e.$$.fragment,i),S(l.$$.fragment,i),n=!0)},o(i){j(e.$$.fragment,i),j(l.$$.fragment,i),n=!1},d(i){i&&D(t),Q(e,i),Q(l,i)}}}function ki(s){let e,t,l,n,i,r,a,o,f,c,u;const d=[vi,hi],g=[];function h(p,k){return p[4].params.tray=="trash"?0:1}return n=h(s),i=g[n]=d[n](s),a=new ln({props:{store:s[0],transparent:!0,dropup:!0}}),f=new sn({props:{store:s[0],transparent:!0,compact:!0}}),{c(){e=v("div"),t=v("div"),l=v("div"),i.c(),r=T(),W(a.$$.fragment),o=T(),W(f.$$.fragment),m(l,"class","w-100 d-flex justify-content-around"),m(l,"role","group"),m(t,"role","toolbar"),m(t,"class","local-mail-toolbar d-flex w-100 py-3 border-top"),Le(()=>s[5].call(t)),G(t,"position-fixed",s[3]),G(t,"position-absolute",!s[3]),G(t,"fixed-bottom",s[3]),G(t,"border-bottom",!s[3]),G(t,"bg-white",!s[3]),G(t,"bg-light",s[3]),m(e,"class","row position-relative"),ue(e,"height",s[1]+"px")},m(p,k){C(p,e,k),_(e,t),_(t,l),g[n].m(l,null),_(l,r),X(a,l,null),_(l,o),X(f,l,null),c=Sn(t,s[5].bind(t)),s[6](e),u=!0},p(p,[k]){let M=n;n=h(p),n===M?g[n].p(p,k):(re(),j(g[M],1,1,()=>{g[M]=null}),ae(),i=g[n],i?i.p(p,k):(i=g[n]=d[n](p),i.c()),S(i,1),i.m(l,r));const w={};k&1&&(w.store=p[0]),a.$set(w);const y={};k&1&&(y.store=p[0]),f.$set(y),(!u||k&8)&&G(t,"position-fixed",p[3]),(!u||k&8)&&G(t,"position-absolute",!p[3]),(!u||k&8)&&G(t,"fixed-bottom",p[3]),(!u||k&8)&&G(t,"border-bottom",!p[3]),(!u||k&8)&&G(t,"bg-white",!p[3]),(!u||k&8)&&G(t,"bg-light",p[3]),(!u||k&2)&&ue(e,"height",p[1]+"px")},i(p){u||(S(i),S(a.$$.fragment,p),S(f.$$.fragment,p),u=!0)},o(p){j(i),j(a.$$.fragment,p),j(f.$$.fragment,p),u=!1},d(p){p&&D(e),g[n].d(),Q(a),Q(f),c(),s[6](null)}}}function wi(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,d=>t(4,l=d)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();let a,o,f=!1;Qe(()=>{const d=new IntersectionObserver(g=>{for(const h of g)t(3,f=h.intersectionRatio<1&&h.boundingClientRect.top>=h.boundingClientRect.height)},{threshold:1});return d.observe(o),()=>d.disconnect()});function c(){a=this.offsetHeight,t(1,a)}function u(d){Ce[d?"unshift":"push"](()=>{o=d,t(2,o)})}return s.$$set=d=>{"store"in d&&i(t(0,r=d.store))},[r,a,o,f,l,c,u]}class yi extends me{constructor(e){super(),de(this,e,wi,ki,ce,{store:0})}}function rn(s,{from:e,to:t},l={}){const n=getComputedStyle(s),i=n.transform==="none"?"":n.transform,[r,a]=n.transformOrigin.split(" ").map(parseFloat),o=e.left+e.width*r/t.width-(t.left+r),f=e.top+e.height*a/t.height-(t.top+a),{delay:c=0,duration:u=g=>Math.sqrt(g)*120,easing:d=Qs}=l;return{delay:c,duration:Me(u)?u(Math.sqrt(o*o+f*f)):u,easing:d,css:(g,h)=>{const p=h*o,k=h*f,M=g+h*e.width/t.width,w=g+h*e.height/t.height;return`transform: ${i} translate(${p}px, ${k}px) scale(${M}, ${w});`}}}function Mi(s){let e,t,l,n,i,r,a;return{c(){e=v("button"),t=v("i"),m(t,"class",l="fa align-middle "+s[3]),m(e,"type","button"),m(e,"class","btn px-2"),m(e,"role","checkbox"),m(e,"aria-checked",n=!!s[2].selectedMessages.has(s[1].id)),m(e,"title",i=s[2].strings.select)},m(o,f){C(o,e,f),_(e,t),r||(a=O(e,"click",Us(Se(s[4]))),r=!0)},p(o,[f]){f&8&&l!==(l="fa align-middle "+o[3])&&m(t,"class",l),f&6&&n!==(n=!!o[2].selectedMessages.has(o[1].id))&&m(e,"aria-checked",n),f&4&&i!==(i=o[2].strings.select)&&m(e,"title",i)},i:U,o:U,d(o){o&&D(e),r=!1,a()}}}function $i(s,e,t){let l,n,i=U,r=()=>(i(),i=_e(a,c=>t(2,n=c)),a);s.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;const f=()=>a.toggleSelected(o.id);return s.$$set=c=>{"store"in c&&r(t(0,a=c.store)),"message"in c&&t(1,o=c.message)},s.$$.update=()=>{s.$$.dirty&6&&t(3,l=n.selectedMessages.has(o.id)?"fa-check-square-o":"fa-square-o")},[a,o,n,l,f]}class an extends me{constructor(e){super(),de(this,e,$i,Mi,ce,{store:0,message:1})}}function Ci(s){let e,t,l,n,i,r,a,o;return{c(){e=v("button"),t=v("i"),m(t,"class",l="fa "+s[2]),m(e,"type","button"),m(e,"class","btn px-2"),m(e,"role","checkbox"),m(e,"aria-checked",n=s[1].starred),e.disabled=i=s[1].deleted,m(e,"title",r=s[1].deleted?s[3].strings[s[1].starred?"starred":"unstarred"]:s[3].strings[s[1].starred?"markasunstarred":"markasstarred"])},m(f,c){C(f,e,c),_(e,t),a||(o=O(e,"click",Us(Se(s[4]))),a=!0)},p(f,[c]){c&4&&l!==(l="fa "+f[2])&&m(t,"class",l),c&2&&n!==(n=f[1].starred)&&m(e,"aria-checked",n),c&2&&i!==(i=f[1].deleted)&&(e.disabled=i),c&10&&r!==(r=f[1].deleted?f[3].strings[f[1].starred?"starred":"unstarred"]:f[3].strings[f[1].starred?"markasunstarred":"markasstarred"])&&m(e,"title",r)},i:U,o:U,d(f){f&&D(e),a=!1,o()}}}function Di(s,e,t){let l,n,i=U,r=()=>(i(),i=_e(a,c=>t(3,n=c)),a);s.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;const f=()=>a.setStarred([o.id],!o.starred);return s.$$set=c=>{"store"in c&&r(t(0,a=c.store)),"message"in c&&t(1,o=c.message)},s.$$.update=()=>{s.$$.dirty&2&&t(2,l=o.starred?"fa-star text-warning":"fa-star-o")},[a,o,l,n,f]}class on extends me{constructor(e){super(),de(this,e,Di,Ci,ce,{store:0,message:1})}}function Si(s){let e,t=s[1].join(", ")+"",l,n,i,r;return{c(){e=v("div"),l=B(t)},m(a,o){C(a,e,o),_(e,l),i||(r=$e(n=Be.call(null,e,s[1].join(`
`))),i=!0)},p(a,[o]){o&2&&t!==(t=a[1].join(", ")+"")&&F(l,t),n&&Me(n.update)&&o&2&&n.update.call(null,a[1].join(`
`))},i:U,o:U,d(a){a&&D(e),i=!1,r()}}}function Ti(s,e,t){let l,n,i=U,r=()=>(i(),i=_e(a,f=>t(3,n=f)),a);s.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;return s.$$set=f=>{"store"in f&&r(t(0,a=f.store)),"message"in f&&t(2,o=f.message)},s.$$.update=()=>{s.$$.dirty&12&&t(1,l=n.params.tray=="sent"||n.params.tray=="drafts"?o.recipients.length>0?o.recipients.map(f=>f.fullname):[n.strings.norecipient]:[o.sender.fullname])},[a,l,o,n]}class ft extends me{constructor(e){super(),de(this,e,Ti,Si,ce,{store:0,message:2})}}function Zt(s){let e,t=s[2].strings.draft+"",l;return{c(){e=v("span"),l=B(t),m(e,"class","mr-2 text-danger")},m(n,i){C(n,e,i),_(e,l)},p(n,i){i&4&&t!==(t=n[2].strings.draft+"")&&F(l,t)},d(n){n&&D(e)}}}function Li(s){let e,t,l=(s[1].subject||s[2].strings.nosubject)+"",n,i,r,a,o=s[1].draft&&Zt(s);return{c(){e=v("div"),o&&o.c(),t=T(),n=B(l)},m(f,c){C(f,e,c),o&&o.m(e,null),_(e,t),_(e,n),r||(a=$e(i=Be.call(null,e,s[1].subject||s[2].strings.nosubject)),r=!0)},p(f,[c]){f[1].draft?o?o.p(f,c):(o=Zt(f),o.c(),o.m(e,t)):o&&(o.d(1),o=null),c&6&&l!==(l=(f[1].subject||f[2].strings.nosubject)+"")&&F(n,l),i&&Me(i.update)&&c&6&&i.update.call(null,f[1].subject||f[2].strings.nosubject)},i:U,o:U,d(f){f&&D(e),o&&o.d(),r=!1,a()}}}function zi(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,o=>t(2,l=o)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return s.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,l]}class ut extends me{constructor(e){super(),de(this,e,zi,Li,ce,{store:0,message:1})}}function xt(s){let e,t,l,n,i;return{c(){e=v("span"),t=B(s[2]),m(e,"class","local-mail-course-badge badge px-2 mr-2 mb-2 svelte-zl9zhm"),ue(e,"min-width","3rem"),ue(e,"max-width","calc("+s[1]+"ch + 1.5rem)")},m(r,a){C(r,e,a),_(e,t),n||(i=$e(l=Be.call(null,e,s[2])),n=!0)},p(r,a){a&4&&F(t,r[2]),a&2&&ue(e,"max-width","calc("+r[1]+"ch + 1.5rem)"),l&&Me(l.update)&&a&4&&l.update.call(null,r[2])},d(r){r&&D(e),n=!1,i()}}}function ji(s){let e=["shortname","fullname"].includes(s[0].coursebadges),t,l=e&&xt(s);return{c(){l&&l.c(),t=be()},m(n,i){l&&l.m(n,i),C(n,t,i)},p(n,[i]){i&1&&(e=["shortname","fullname"].includes(n[0].coursebadges)),e?l?l.p(n,i):(l=xt(n),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null)},i:U,o:U,d(n){n&&D(t),l&&l.d(n)}}}function Ni(s,e,t){let l,n,{course:i}=e,{settings:r}=e;return s.$$set=a=>{"course"in a&&t(3,i=a.course),"settings"in a&&t(0,r=a.settings)},s.$$.update=()=>{s.$$.dirty&9&&t(2,l=r.coursebadges=="shortname"?i.shortname:i.fullname),s.$$.dirty&1&&t(1,n=r.coursebadgeslength||20)},[r,n,l,i]}class ct extends me{constructor(e){super(),de(this,e,Ni,ji,ce,{course:3,settings:0})}}function Ai(s){let e,t=s[0].name+"",l,n;return{c(){e=v("span"),l=B(t),m(e,"class","local-mail-label-badge badge flex-shrink-0 px-2 mr-2 mb-2 svelte-1xmrn49"),m(e,"style",n=`color: var(--local-mail-color-${s[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${s[1]}-bg, var(--local-mail-color-gray-bg))`)},m(i,r){C(i,e,r),_(e,l)},p(i,[r]){r&1&&t!==(t=i[0].name+"")&&F(l,t),r&2&&n!==(n=`color: var(--local-mail-color-${i[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${i[1]}-bg, var(--local-mail-color-gray-bg))`)&&m(e,"style",n)},i:U,o:U,d(i){i&&D(e)}}}function Bi(s,e,t){let l,{label:n}=e;return s.$$set=i=>{"label"in i&&t(0,n=i.label)},s.$$.update=()=>{s.$$.dirty&1&&t(1,l=lt.includes(n.color)?n.color:"gray")},[n,l]}class mt extends me{constructor(e){super(),de(this,e,Bi,Ai,ce,{label:0})}}function el(s,e,t){const l=s.slice();return l[3]=e[t],l}function tl(s){let e,t,l=s[2].params.courseid!=s[1].course.id&&ll(s);return{c(){l&&l.c(),e=be()},m(n,i){l&&l.m(n,i),C(n,e,i),t=!0},p(n,i){n[2].params.courseid!=n[1].course.id?l?(l.p(n,i),i&6&&S(l,1)):(l=ll(n),l.c(),S(l,1),l.m(e.parentNode,e)):l&&(re(),j(l,1,1,()=>{l=null}),ae())},i(n){t||(S(l),t=!0)},o(n){j(l),t=!1},d(n){n&&D(e),l&&l.d(n)}}}function ll(s){let e,t;return e=new ct({props:{course:s[1].course,settings:s[2].settings}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&2&&(i.course=l[1].course),n&4&&(i.settings=l[2].settings),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function sl(s){let e,t;return e=new mt({props:{label:s[3]}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&2&&(i.label=l[3]),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function nl(s,e){let t,l,n,i=(e[2].params.tray!="label"||e[2].params.labelid!=e[3].id)&&sl(e);return{key:s,first:null,c(){t=be(),i&&i.c(),l=be(),this.first=t},m(r,a){C(r,t,a),i&&i.m(r,a),C(r,l,a),n=!0},p(r,a){e=r,e[2].params.tray!="label"||e[2].params.labelid!=e[3].id?i?(i.p(e,a),a&6&&S(i,1)):(i=sl(e),i.c(),S(i,1),i.m(l.parentNode,l)):i&&(re(),j(i,1,1,()=>{i=null}),ae())},i(r){n||(S(i),n=!0)},o(r){j(i),n=!1},d(r){r&&(D(t),D(l)),i&&i.d(r)}}}function il(s){let e,t,l=s[2].params.courseid!=s[1].course.id&&rl(s);return{c(){l&&l.c(),e=be()},m(n,i){l&&l.m(n,i),C(n,e,i),t=!0},p(n,i){n[2].params.courseid!=n[1].course.id?l?(l.p(n,i),i&6&&S(l,1)):(l=rl(n),l.c(),S(l,1),l.m(e.parentNode,e)):l&&(re(),j(l,1,1,()=>{l=null}),ae())},i(n){t||(S(l),t=!0)},o(n){j(l),t=!1},d(n){n&&D(e),l&&l.d(n)}}}function rl(s){let e,t;return e=new ct({props:{course:s[1].course,settings:s[2].settings}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&2&&(i.course=l[1].course),n&4&&(i.settings=l[2].settings),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function qi(s){let e,t=[],l=new Map,n,i,r,a=s[2].viewportSize<ge.MD&&tl(s),o=fe(s[1].labels);const f=u=>u[3].id;for(let u=0;u<o.length;u+=1){let d=el(s,o,u),g=f(d);l.set(g,t[u]=nl(g,d))}let c=s[2].viewportSize>=ge.MD&&il(s);return{c(){a&&a.c(),e=T();for(let u=0;u<t.length;u+=1)t[u].c();n=T(),c&&c.c(),i=be()},m(u,d){a&&a.m(u,d),C(u,e,d);for(let g=0;g<t.length;g+=1)t[g]&&t[g].m(u,d);C(u,n,d),c&&c.m(u,d),C(u,i,d),r=!0},p(u,[d]){u[2].viewportSize<ge.MD?a?(a.p(u,d),d&4&&S(a,1)):(a=tl(u),a.c(),S(a,1),a.m(e.parentNode,e)):a&&(re(),j(a,1,1,()=>{a=null}),ae()),d&6&&(o=fe(u[1].labels),re(),t=De(t,d,f,1,u,o,l,n.parentNode,Xe,nl,n,el),ae()),u[2].viewportSize>=ge.MD?c?(c.p(u,d),d&4&&S(c,1)):(c=il(u),c.c(),S(c,1),c.m(i.parentNode,i)):c&&(re(),j(c,1,1,()=>{c=null}),ae())},i(u){if(!r){S(a);for(let d=0;d<o.length;d+=1)S(t[d]);S(c),r=!0}},o(u){j(a);for(let d=0;d<t.length;d+=1)j(t[d]);j(c),r=!1},d(u){u&&(D(e),D(n),D(i)),a&&a.d(u);for(let d=0;d<t.length;d+=1)t[d].d(u);c&&c.d(u)}}}function Ii(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,o=>t(2,l=o)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return s.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,l]}class fn extends me{constructor(e){super(),de(this,e,Ii,qi,ce,{store:0,message:1})}}function al(s){let e,t,l,n,i;return{c(){e=v("span"),t=v("i"),m(t,"class",l="fa fa-fw "+(s[1].numattachments>0?"fa-paperclip":"")),m(t,"aria-hidden",!0),m(e,"class","-shrink-0 mr-2"),m(e,"title",n=s[1].numattachments>0?je(s[2].strings.attachnumber,s[1].numattachments):""),m(e,"aria-hidden",i=s[1].numattachments==0)},m(r,a){C(r,e,a),_(e,t)},p(r,a){a&2&&l!==(l="fa fa-fw "+(r[1].numattachments>0?"fa-paperclip":""))&&m(t,"class",l),a&6&&n!==(n=r[1].numattachments>0?je(r[2].strings.attachnumber,r[1].numattachments):"")&&m(e,"title",n),a&2&&i!==(i=r[1].numattachments==0)&&m(e,"aria-hidden",i)},d(r){r&&D(e)}}}function Ei(s){let e,t=(s[1].numattachments>0||s[2].viewportSize>=ge.MD)&&al(s);return{c(){t&&t.c(),e=be()},m(l,n){t&&t.m(l,n),C(l,e,n)},p(l,[n]){l[1].numattachments>0||l[2].viewportSize>=ge.MD?t?t.p(l,n):(t=al(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(l){l&&D(e),t&&t.d(l)}}}function Ri(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,o=>t(2,l=o)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return s.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,l]}class un extends me{constructor(e){super(),de(this,e,Ri,Ei,ce,{store:0,message:1})}}function Fi(s){let e,t=s[0].shorttime+"",l,n;return{c(){e=v("span"),l=B(t),m(e,"class","local-mail-list-message-time d-shrink-0 text-nowrap text-right svelte-phmq8k"),m(e,"title",n=s[0].fulltime),G(e,"local-mail-list-message-time-md",s[2].viewportSize>=ge.MD)},m(i,r){C(i,e,r),_(e,l)},p(i,[r]){r&1&&t!==(t=i[0].shorttime+"")&&F(l,t),r&1&&n!==(n=i[0].fulltime)&&m(e,"title",n),r&4&&G(e,"local-mail-list-message-time-md",i[2].viewportSize>=ge.MD)},i:U,o:U,d(i){i&&D(e)}}}function Pi(s,e,t){let l,n=U,i=()=>(n(),n=_e(a,o=>t(2,l=o)),a);s.$$.on_destroy.push(()=>n());let{message:r}=e,{store:a}=e;return i(),s.$$set=o=>{"message"in o&&t(0,r=o.message),"store"in o&&i(t(1,a=o.store))},[r,a,l]}class cn extends me{constructor(e){super(),de(this,e,Pi,Fi,ce,{message:0,store:1})}}function ol(s){let e,t,l=s[1].strings.nomessagesfound+"",n,i,r,a=s[1].totalCount>0&&fl(s);return{c(){e=v("div"),t=v("div"),n=B(l),i=T(),a&&a.c(),m(e,"class","alert alert-info")},m(o,f){C(o,e,f),_(e,t),_(t,n),_(e,i),a&&a.m(e,null)},p(o,f){f&2&&l!==(l=o[1].strings.nomessagesfound+"")&&F(n,l),o[1].totalCount>0?a?a.p(o,f):(a=fl(o),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i(o){o&&(r||Le(()=>{r=at(e,qe,{delay:400}),r.start()}))},o:U,d(o){o&&D(e),a&&a.d()}}}function fl(s){let e,t=s[1].strings.showrecentmessages+"",l,n,i,r;return{c(){e=v("a"),l=B(t),m(e,"class","btn btn-info text-white mt-3"),m(e,"href",n=Fe(s[2]))},m(a,o){C(a,e,o),_(e,l),i||(r=O(e,"click",Se(s[3])),i=!0)},p(a,o){o&2&&t!==(t=a[1].strings.showrecentmessages+"")&&F(l,t),o&4&&n!==(n=Fe(a[2]))&&m(e,"href",n)},d(a){a&&D(e),i=!1,r()}}}function Oi(s){let e,t=!s[1].listMessages.length&&ol(s);return{c(){t&&t.c(),e=be()},m(l,n){t&&t.m(l,n),C(l,e,n)},p(l,[n]){l[1].listMessages.length?t&&(t.d(1),t=null):t?(t.p(l,n),n&2&&S(t,1)):(t=ol(l),t.c(),S(t,1),t.m(e.parentNode,e))},i(l){S(t)},o:U,d(l){l&&D(e),t&&t.d(l)}}}function Hi(s,e,t){let l,n,i=U,r=()=>(i(),i=_e(a,f=>t(1,n=f)),a);s.$$.on_destroy.push(()=>i());let{store:a}=e;r();const o=()=>a.navigate(l);return s.$$set=f=>{"store"in f&&r(t(0,a=f.store))},s.$$.update=()=>{s.$$.dirty&2&&t(2,l={tray:n.params.tray,courseid:n.params.courseid,labelid:n.params.labelid})},[a,n,l,o]}class Ui extends me{constructor(e){super(),de(this,e,Hi,Oi,ce,{store:0})}}function ul(s,e,t){const l=s.slice();return l[4]=e[t],l[6]=t,l}function Gi(s){let e,t,l,n,i,r,a,o,f,c,u,d,g,h,p,k,M,w,y,b,$;return t=new an({props:{store:s[0],message:s[4]}}),r=new ft({props:{store:s[0],message:s[4]}}),o=new un({props:{store:s[0],message:s[4]}}),u=new cn({props:{store:s[0],message:s[4]}}),p=new ut({props:{store:s[0],message:s[4]}}),M=new on({props:{store:s[0],message:s[4]}}),b=new fn({props:{store:s[0],message:s[4]}}),{c(){e=v("div"),W(t.$$.fragment),l=T(),n=v("div"),i=v("div"),W(r.$$.fragment),a=T(),W(o.$$.fragment),f=T(),c=v("div"),W(u.$$.fragment),d=T(),g=v("div"),h=v("div"),W(p.$$.fragment),k=T(),W(M.$$.fragment),w=T(),y=v("div"),W(b.$$.fragment),m(c,"class","ml-auto mr-2"),m(i,"class","d-flex mt-2"),m(h,"class","d-flex w-100 my-2 mr-2"),ue(h,"min-width","0"),m(g,"class","d-flex"),m(y,"class","d-flex flex-wrap ml-n2 mr-2"),m(n,"class","w-100 ml-1"),ue(n,"min-width","0"),m(e,"class","d-flex align-items-start pt-1 pb-2 pl-1 pr-2")},m(z,N){C(z,e,N),X(t,e,null),_(e,l),_(e,n),_(n,i),X(r,i,null),_(i,a),X(o,i,null),_(i,f),_(i,c),X(u,c,null),_(n,d),_(n,g),_(g,h),X(p,h,null),_(g,k),X(M,g,null),_(n,w),_(n,y),X(b,y,null),$=!0},p(z,N){const L={};N&1&&(L.store=z[0]),N&2&&(L.message=z[4]),t.$set(L);const q={};N&1&&(q.store=z[0]),N&2&&(q.message=z[4]),r.$set(q);const H={};N&1&&(H.store=z[0]),N&2&&(H.message=z[4]),o.$set(H);const Y={};N&1&&(Y.store=z[0]),N&2&&(Y.message=z[4]),u.$set(Y);const V={};N&1&&(V.store=z[0]),N&2&&(V.message=z[4]),p.$set(V);const ee={};N&1&&(ee.store=z[0]),N&2&&(ee.message=z[4]),M.$set(ee);const I={};N&1&&(I.store=z[0]),N&2&&(I.message=z[4]),b.$set(I)},i(z){$||(S(t.$$.fragment,z),S(r.$$.fragment,z),S(o.$$.fragment,z),S(u.$$.fragment,z),S(p.$$.fragment,z),S(M.$$.fragment,z),S(b.$$.fragment,z),$=!0)},o(z){j(t.$$.fragment,z),j(r.$$.fragment,z),j(o.$$.fragment,z),j(u.$$.fragment,z),j(p.$$.fragment,z),j(M.$$.fragment,z),j(b.$$.fragment,z),$=!1},d(z){z&&D(e),Q(t),Q(r),Q(o),Q(u),Q(p),Q(M),Q(b)}}}function Vi(s){let e,t,l,n,i,r,a,o,f,c,u,d,g,h,p,k,M,w,y;return t=new an({props:{store:s[0],message:s[4]}}),n=new on({props:{store:s[0],message:s[4]}}),o=new ft({props:{store:s[0],message:s[4]}}),u=new ut({props:{store:s[0],message:s[4]}}),h=new fn({props:{store:s[0],message:s[4]}}),k=new un({props:{store:s[0],message:s[4]}}),w=new cn({props:{store:s[0],message:s[4]}}),{c(){e=v("div"),W(t.$$.fragment),l=T(),W(n.$$.fragment),i=T(),r=v("div"),a=v("div"),W(o.$$.fragment),f=T(),c=v("div"),W(u.$$.fragment),d=T(),g=v("div"),W(h.$$.fragment),p=T(),W(k.$$.fragment),M=T(),W(w.$$.fragment),m(a,"class","flex-grow-1 mx-2"),ue(a,"width","25%"),ue(a,"min-width","0"),m(g,"class","d-flex text-truncate flex-shrink-0 justify-content-end mb-n2 ml-auto"),ue(g,"max-width","80%"),m(c,"class","flex-grow-1 d-flex my-2 mx-2"),ue(c,"width","75%"),ue(c,"min-width","0"),m(r,"class","d-flex w-100 flex-grow-1 align-items-center"),ue(r,"min-width","0"),m(e,"class","d-flex align-items-center pl-1 pr-3")},m(b,$){C(b,e,$),X(t,e,null),_(e,l),X(n,e,null),_(e,i),_(e,r),_(r,a),X(o,a,null),_(r,f),_(r,c),X(u,c,null),_(c,d),_(c,g),X(h,g,null),_(e,p),X(k,e,null),_(e,M),X(w,e,null),y=!0},p(b,$){const z={};$&1&&(z.store=b[0]),$&2&&(z.message=b[4]),t.$set(z);const N={};$&1&&(N.store=b[0]),$&2&&(N.message=b[4]),n.$set(N);const L={};$&1&&(L.store=b[0]),$&2&&(L.message=b[4]),o.$set(L);const q={};$&1&&(q.store=b[0]),$&2&&(q.message=b[4]),u.$set(q);const H={};$&1&&(H.store=b[0]),$&2&&(H.message=b[4]),h.$set(H);const Y={};$&1&&(Y.store=b[0]),$&2&&(Y.message=b[4]),k.$set(Y);const V={};$&1&&(V.store=b[0]),$&2&&(V.message=b[4]),w.$set(V)},i(b){y||(S(t.$$.fragment,b),S(n.$$.fragment,b),S(o.$$.fragment,b),S(u.$$.fragment,b),S(h.$$.fragment,b),S(k.$$.fragment,b),S(w.$$.fragment,b),y=!0)},o(b){j(t.$$.fragment,b),j(n.$$.fragment,b),j(o.$$.fragment,b),j(u.$$.fragment,b),j(h.$$.fragment,b),j(k.$$.fragment,b),j(w.$$.fragment,b),y=!1},d(b){b&&D(e),Q(t),Q(n),Q(o),Q(u),Q(h),Q(k),Q(w)}}}function cl(s,e){let t,l,n,i,r,a,o,f=U,c,u,d;const g=[Vi,Gi],h=[];function p(M,w){return M[1].viewportSize>=ge.MD?0:1}l=p(e),n=h[l]=g[l](e);function k(){return e[3](e[4],e[6])}return{key:s,first:null,c(){t=v("a"),n.c(),m(t,"class","local-mail-list-message list-group-item list-group-item-action p-0 svelte-unh3d4"),m(t,"href",i=Fe(e[2](e[4],e[6]))),G(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),G(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),G(t,"font-weight-bold",e[4].unread),this.first=t},m(M,w){C(M,t,w),h[l].m(t,null),c=!0,u||(d=O(t,"click",Se(k)),u=!0)},p(M,w){e=M;let y=l;l=p(e),l===y?h[l].p(e,w):(re(),j(h[y],1,1,()=>{h[y]=null}),ae(),n=h[l],n?n.p(e,w):(n=h[l]=g[l](e),n.c()),S(n,1),n.m(t,null)),(!c||w&2&&i!==(i=Fe(e[2](e[4],e[6]))))&&m(t,"href",i),(!c||w&2)&&G(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),(!c||w&2)&&G(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),(!c||w&2)&&G(t,"font-weight-bold",e[4].unread)},r(){o=t.getBoundingClientRect()},f(){Xs(t),f(),ot(t,o)},a(){f(),f=Ws(t,o,rn,{delay:400,duration:400})},i(M){c||(S(n),M&&Le(()=>{c&&(a&&a.end(1),r=at(t,qe,{delay:400}),r.start())}),c=!0)},o(M){j(n),r&&r.invalidate(),M&&(a=Vs(t,qe,{duration:400})),c=!1},d(M){M&&D(t),h[l].d(),M&&a&&a.end(),u=!1,d()}}}function ml(s){let e,t=[],l=new Map,n,i,r,a=fe(s[1].listMessages);const o=f=>f[4].id;for(let f=0;f<a.length;f+=1){let c=ul(s,a,f),u=o(c);l.set(u,t[f]=cl(u,c))}return i=new Ui({props:{store:s[0]}}),{c(){e=v("div");for(let f=0;f<t.length;f+=1)t[f].c();n=T(),W(i.$$.fragment),m(e,"class","list-group")},m(f,c){C(f,e,c);for(let u=0;u<t.length;u+=1)t[u]&&t[u].m(e,null);_(e,n),X(i,e,null),r=!0},p(f,c){if(c&7){a=fe(f[1].listMessages),re();for(let d=0;d<t.length;d+=1)t[d].r();t=De(t,c,o,1,f,a,l,e,Gs,cl,n,ul);for(let d=0;d<t.length;d+=1)t[d].a();ae()}const u={};c&1&&(u.store=f[0]),i.$set(u)},i(f){if(!r){for(let c=0;c<a.length;c+=1)S(t[c]);S(i.$$.fragment,f),r=!0}},o(f){for(let c=0;c<t.length;c+=1)j(t[c]);j(i.$$.fragment,f),r=!1},d(f){f&&D(e);for(let c=0;c<t.length;c+=1)t[c].d();Q(i)}}}function Ki(s){let e=s[1].navigationId,t,l,n=ml(s);return{c(){n.c(),t=be()},m(i,r){n.m(i,r),C(i,t,r),l=!0},p(i,[r]){r&2&&ce(e,e=i[1].navigationId)?(re(),j(n,1,1,U),ae(),n=ml(i),n.c(),S(n,1),n.m(t.parentNode,t)):n.p(i,r)},i(i){l||(S(n),l=!0)},o(i){j(n),l=!1},d(i){i&&D(t),n.d(i)}}}function Yi(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,f=>t(1,l=f)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=(f,c)=>({...l.params,messageid:f.id,offset:(l.params.offset||0)+c}),o=(f,c)=>r.navigate(a(f,c));return s.$$set=f=>{"store"in f&&i(t(0,r=f.store))},[r,l,a,o]}class Ji extends me{constructor(e){super(),de(this,e,Yi,Ki,ce,{store:0})}}function dl(s){let e,t,l,n,i,r,a,o=s[3]&&_l(s);return{c(){e=v("div"),t=v("button"),l=v("i"),i=T(),o&&o.c(),m(l,"class","fa fa-fw fa-ellipsis-v align-middle"),m(t,"type","button"),m(t,"class","btn"),m(t,"aria-expanded",s[3]),m(t,"title",n=s[5].strings.moreactions),m(e,"class","dropdown")},m(f,c){C(f,e,c),_(e,t),_(t,l),_(e,i),o&&o.m(e,null),r||(a=[O(t,"click",s[6]),$e(Pe.call(null,e,s[7]))],r=!0)},p(f,c){c&8&&m(t,"aria-expanded",f[3]),c&32&&n!==(n=f[5].strings.moreactions)&&m(t,"title",n),f[3]?o?o.p(f,c):(o=_l(f),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(f){f&&D(e),o&&o.d(),r=!1,ve(a)}}}function _l(s){let e,t,l,n,i=s[5].strings.reply+"",r,a,o,f,c,u=s[5].strings.replyall+"",d,g,h,p,k,M,w=s[5].strings.forward+"",y,b,$;return{c(){e=v("div"),t=v("button"),l=v("i"),n=T(),r=B(i),a=T(),o=v("button"),f=v("i"),c=T(),d=B(u),h=T(),p=v("button"),k=v("i"),M=T(),y=B(w),m(l,"class","fa fa-fw fa-reply"),m(l,"aria-hidden","true"),m(t,"type","button"),m(t,"class","dropdown-item"),m(f,"class","fa fa-fw fa-reply-all"),m(f,"aria-hidden","true"),m(o,"type","button"),o.disabled=g=!s[2],m(o,"class","dropdown-item"),G(o,"disabled",!s[2]),m(k,"class","fa fa-fw fa-share"),m(k,"aria-hidden","true"),m(p,"type","button"),m(p,"class","dropdown-item"),m(e,"class","dropdown-menu dropdown-menu-right show")},m(z,N){C(z,e,N),_(e,t),_(t,l),_(t,n),_(t,r),_(e,a),_(e,o),_(o,f),_(o,c),_(o,d),_(e,h),_(e,p),_(p,k),_(p,M),_(p,y),b||($=[O(t,"click",s[9]),O(o,"click",s[10]),O(p,"click",s[11])],b=!0)},p(z,N){N&32&&i!==(i=z[5].strings.reply+"")&&F(r,i),N&32&&u!==(u=z[5].strings.replyall+"")&&F(d,u),N&4&&g!==(g=!z[2])&&(o.disabled=g),N&4&&G(o,"disabled",!z[2]),N&32&&w!==(w=z[5].strings.forward+"")&&F(y,w)},d(z){z&&D(e),b=!1,ve($)}}}function gl(s){let e,t,l,n,i,r,a,o,f,c,u,d,g,h;return{c(){e=v("button"),t=v("i"),n=T(),i=v("button"),r=v("i"),f=T(),c=v("button"),u=v("i"),m(t,"class","fa fa-fw fa-reply"),m(t,"aria-hidden","true"),m(e,"type","button"),m(e,"title",l=s[5].strings.reply),m(e,"class","btn py-2 border-0"),m(r,"class","fa fa-fw fa-reply-all"),m(r,"aria-hidden","true"),m(i,"type","button"),i.disabled=a=!s[2],m(i,"title",o=s[5].strings.replyall),m(i,"class","btn py-2 border-0"),G(i,"disabled",!s[2]),m(u,"class","fa fa-fw fa-share"),m(u,"aria-hidden","true"),m(c,"type","button"),m(c,"title",d=s[5].strings.forward),m(c,"class","btn py-2 border-0")},m(p,k){C(p,e,k),_(e,t),C(p,n,k),C(p,i,k),_(i,r),C(p,f,k),C(p,c,k),_(c,u),g||(h=[O(e,"click",s[12]),O(i,"click",s[13]),O(c,"click",s[14])],g=!0)},p(p,k){k&32&&l!==(l=p[5].strings.reply)&&m(e,"title",l),k&4&&a!==(a=!p[2])&&(i.disabled=a),k&32&&o!==(o=p[5].strings.replyall)&&m(i,"title",o),k&4&&G(i,"disabled",!p[2]),k&32&&d!==(d=p[5].strings.forward)&&m(c,"title",d)},d(p){p&&(D(e),D(n),D(i),D(f),D(c)),g=!1,ve(h)}}}function Wi(s){let e,t,l,n,i,r,a,o,f,c,u,d=s[5].viewportSize<ge.SM&&dl(s),g=s[5].viewportSize>=ge.SM&&gl(s);return{c(){e=v("button"),t=v("i"),a=T(),d&&d.c(),o=T(),g&&g.c(),f=be(),m(t,"class",l="fa "+s[4]),m(e,"type","button"),m(e,"class","btn py-2 border-0"),m(e,"role","checkbox"),m(e,"aria-checked",n=s[1].starred),e.disabled=i=s[1].deleted,m(e,"title",r=s[1].starred?s[5].strings.markasunstarred:s[5].strings.markasstarred)},m(h,p){C(h,e,p),_(e,t),C(h,a,p),d&&d.m(h,p),C(h,o,p),g&&g.m(h,p),C(h,f,p),c||(u=O(e,"click",s[8]),c=!0)},p(h,[p]){p&16&&l!==(l="fa "+h[4])&&m(t,"class",l),p&2&&n!==(n=h[1].starred)&&m(e,"aria-checked",n),p&2&&i!==(i=h[1].deleted)&&(e.disabled=i),p&34&&r!==(r=h[1].starred?h[5].strings.markasunstarred:h[5].strings.markasstarred)&&m(e,"title",r),h[5].viewportSize<ge.SM?d?d.p(h,p):(d=dl(h),d.c(),d.m(o.parentNode,o)):d&&(d.d(1),d=null),h[5].viewportSize>=ge.SM?g?g.p(h,p):(g=gl(h),g.c(),g.m(f.parentNode,f)):g&&(g.d(1),g=null)},i:U,o:U,d(h){h&&(D(e),D(a),D(o),D(f)),d&&d.d(h),g&&g.d(h),c=!1,u()}}}function Xi(s,e,t){let l,n,i=U,r=()=>(i(),i=_e(a,b=>t(5,n=b)),a);s.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e,{canReplyAll:f}=e,c=!1;const u=()=>{t(3,c=!c)},d=()=>{t(3,c=!1)},g=()=>a.setStarred([o.id],!o.starred),h=()=>a.reply(o,!1),p=()=>a.reply(o,!0),k=()=>a.forward(o),M=()=>a.reply(o,!1),w=()=>a.reply(o,!0),y=()=>a.forward(o);return s.$$set=b=>{"store"in b&&r(t(0,a=b.store)),"message"in b&&t(1,o=b.message),"canReplyAll"in b&&t(2,f=b.canReplyAll)},s.$$.update=()=>{s.$$.dirty&2&&t(4,l=o.starred?"fa-star text-warning":"fa-star-o")},[a,o,f,c,l,n,u,d,g,h,p,k,M,w,y]}class Qi extends me{constructor(e){super(),de(this,e,Xi,Wi,ce,{store:0,message:1,canReplyAll:2})}}function pl(s,e,t){const l=s.slice();return l[1]=e[t],l}function bl(s){let e,t,l,n,i,r,a=(s[1].filepath+s[1].filename).replace(/^\//,"")+"",o,f,c,u,d=Nt(s[1].filesize)+"",g,h;return{c(){e=v("div"),t=v("img"),i=T(),r=v("a"),o=B(a),c=T(),u=v("span"),g=B(d),h=T(),m(t,"aria-hidden","true"),m(t,"alt",l=s[1].filename),Ne(t.src,n=s[1].iconurl)||m(t,"src",n),m(t,"width","24"),m(t,"height","24"),m(t,"class","mr-2"),m(r,"href",f=s[1].fileurl),m(r,"class","mr-2"),m(u,"class","text-muted"),m(e,"class","mr-5 mb-3")},m(p,k){C(p,e,k),_(e,t),_(e,i),_(e,r),_(r,o),_(e,c),_(e,u),_(u,g),_(e,h)},p(p,k){k&1&&l!==(l=p[1].filename)&&m(t,"alt",l),k&1&&!Ne(t.src,n=p[1].iconurl)&&m(t,"src",n),k&1&&a!==(a=(p[1].filepath+p[1].filename).replace(/^\//,"")+"")&&F(o,a),k&1&&f!==(f=p[1].fileurl)&&m(r,"href",f),k&1&&d!==(d=Nt(p[1].filesize)+"")&&F(g,d)},d(p){p&&D(e)}}}function Zi(s){let e,t=fe(s[0].attachments),l=[];for(let n=0;n<t.length;n+=1)l[n]=bl(pl(s,t,n));return{c(){e=v("div");for(let n=0;n<l.length;n+=1)l[n].c();m(e,"class","d-sm-flex flex-sm-wrap mr-n5 mt-3 mb-n3")},m(n,i){C(n,e,i);for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(e,null)},p(n,[i]){if(i&1){t=fe(n[0].attachments);let r;for(r=0;r<t.length;r+=1){const a=pl(n,t,r);l[r]?l[r].p(a,i):(l[r]=bl(a),l[r].c(),l[r].m(e,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=t.length}},i:U,o:U,d(n){n&&D(e),Ie(l,n)}}}function xi(s,e,t){let{message:l}=e;return s.$$set=n=>{"message"in n&&t(0,l=n.message)},[l]}class mn extends me{constructor(e){super(),de(this,e,xi,Zi,ce,{message:0})}}function er(s){let e,t,l,n=s[3].strings.reply+"",i,r,a,o,f,c=s[3].strings.replyall+"",u,d,g,h,p,k,M=s[3].strings.forward+"",w,y,b;return{c(){e=v("button"),t=v("i"),l=T(),i=B(n),r=T(),a=v("button"),o=v("i"),f=T(),u=B(c),g=T(),h=v("button"),p=v("i"),k=T(),w=B(M),m(t,"class","fa fa-fw fa-reply mr-2"),m(e,"type","button"),m(e,"class","btn btn-primary mr-3 mb-3"),m(o,"class","fa fa-fw fa-reply-all mr-2"),m(a,"type","button"),a.disabled=d=!s[2],m(a,"class","btn mr-3 mb-3"),G(a,"disabled",!s[2]),G(a,"btn-primary",s[2]),G(a,"btn-secondary",!s[2]),m(p,"class","fa fa-fw fa-share mr-2"),m(h,"type","button"),m(h,"class","btn btn-primary mr-3 mb-3")},m($,z){C($,e,z),_(e,t),_(e,l),_(e,i),C($,r,z),C($,a,z),_(a,o),_(a,f),_(a,u),C($,g,z),C($,h,z),_(h,p),_(h,k),_(h,w),y||(b=[O(e,"click",s[4]),O(a,"click",s[5]),O(h,"click",s[6])],y=!0)},p($,[z]){z&8&&n!==(n=$[3].strings.reply+"")&&F(i,n),z&8&&c!==(c=$[3].strings.replyall+"")&&F(u,c),z&4&&d!==(d=!$[2])&&(a.disabled=d),z&4&&G(a,"disabled",!$[2]),z&4&&G(a,"btn-primary",$[2]),z&4&&G(a,"btn-secondary",!$[2]),z&8&&M!==(M=$[3].strings.forward+"")&&F(w,M)},i:U,o:U,d($){$&&(D(e),D(r),D(a),D(g),D(h)),y=!1,ve(b)}}}function tr(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,d=>t(3,l=d)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e,{canReplyAll:o}=e;const f=()=>r.reply(a,!1),c=()=>r.reply(a,!0),u=()=>r.forward(a);return s.$$set=d=>{"store"in d&&i(t(0,r=d.store)),"message"in d&&t(1,a=d.message),"canReplyAll"in d&&t(2,o=d.canReplyAll)},[r,a,o,l,f,c,u]}class lr extends me{constructor(e){super(),de(this,e,tr,er,ce,{store:0,message:1,canReplyAll:2})}}function hl(s,e,t){const l=s.slice();return l[3]=e[t],l}function vl(s){let e,t;return e=new ct({props:{course:s[1].course,settings:s[2].settings}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&2&&(i.course=l[1].course),n&4&&(i.settings=l[2].settings),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function kl(s,e){let t,l,n;return l=new mt({props:{label:e[3]}}),{key:s,first:null,c(){t=be(),W(l.$$.fragment),this.first=t},m(i,r){C(i,t,r),X(l,i,r),n=!0},p(i,r){e=i;const a={};r&2&&(a.label=e[3]),l.$set(a)},i(i){n||(S(l.$$.fragment,i),n=!0)},o(i){j(l.$$.fragment,i),n=!1},d(i){i&&D(t),Q(l,i)}}}function sr(s){let e,t=[],l=new Map,n,i,r=s[1].course.id!=s[2].params.courseid&&vl(s),a=fe(s[1].labels);const o=f=>f[3].id;for(let f=0;f<a.length;f+=1){let c=hl(s,a,f),u=o(c);l.set(u,t[f]=kl(u,c))}return{c(){r&&r.c(),e=T();for(let f=0;f<t.length;f+=1)t[f].c();n=be()},m(f,c){r&&r.m(f,c),C(f,e,c);for(let u=0;u<t.length;u+=1)t[u]&&t[u].m(f,c);C(f,n,c),i=!0},p(f,[c]){f[1].course.id!=f[2].params.courseid?r?(r.p(f,c),c&6&&S(r,1)):(r=vl(f),r.c(),S(r,1),r.m(e.parentNode,e)):r&&(re(),j(r,1,1,()=>{r=null}),ae()),c&2&&(a=fe(f[1].labels),re(),t=De(t,c,o,1,f,a,l,n.parentNode,Xe,kl,n,hl),ae())},i(f){if(!i){S(r);for(let c=0;c<a.length;c+=1)S(t[c]);i=!0}},o(f){j(r);for(let c=0;c<t.length;c+=1)j(t[c]);i=!1},d(f){f&&(D(e),D(n)),r&&r.d(f);for(let c=0;c<t.length;c+=1)t[c].d(f)}}}function nr(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,o=>t(2,l=o)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return s.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,l]}class ir extends me{constructor(e){super(),de(this,e,nr,sr,ce,{store:0,message:1})}}function wl(s){let e,t,l,n;return l=new mn({props:{message:s[0]}}),{c(){e=v("hr"),t=T(),W(l.$$.fragment)},m(i,r){C(i,e,r),C(i,t,r),X(l,i,r),n=!0},p(i,r){const a={};r&1&&(a.message=i[0]),l.$set(a)},i(i){n||(S(l.$$.fragment,i),n=!0)},o(i){j(l.$$.fragment,i),n=!1},d(i){i&&(D(e),D(t)),Q(l,i)}}}function rr(s){let e,t,l,n=s[0].subject+"",i,r,a,o,f,c,u,d,g,h,p,k=s[0].sender.fullname+"",M,w,y,b,$=s[0].fulltime+"",z,N,L,q,H,Y=s[0].content+"",V,ee,I=s[0].attachments.length>0&&wl(s);return{c(){e=v("div"),t=v("div"),l=v("h5"),i=B(n),r=T(),a=v("div"),o=v("div"),f=v("div"),c=v("img"),g=T(),h=v("div"),p=v("a"),M=B(k),y=T(),b=v("div"),z=B($),N=T(),L=v("hr"),q=T(),H=v("div"),V=T(),I&&I.c(),m(l,"class","h5 card-title mb-3"),m(c,"aria-hidden","true"),m(c,"alt",u=s[0].sender.fullname),Ne(c.src,d=s[0].sender.pictureurl)||m(c,"src",d),m(c,"width","35"),m(c,"height","35"),m(c,"class","rounded-circle"),m(f,"class","mr-3"),m(p,"href",w=s[0].sender.profileurl),m(h,"class","mt-1"),m(o,"class","d-flex mb-3 mb-sm-0"),m(b,"class","mt-1 ml-auto"),m(a,"class","d-sm-flex mb-n1"),m(H,"class","local-mail-message-reference-content svelte-nahnfm"),m(t,"class","card-body p-3 px-xl-4"),m(e,"class","card mb-4")},m(K,te){C(K,e,te),_(e,t),_(t,l),_(l,i),_(t,r),_(t,a),_(a,o),_(o,f),_(f,c),_(o,g),_(o,h),_(h,p),_(p,M),_(a,y),_(a,b),_(b,z),_(t,N),_(t,L),_(t,q),_(t,H),H.innerHTML=Y,_(t,V),I&&I.m(t,null),ee=!0},p(K,[te]){(!ee||te&1)&&n!==(n=K[0].subject+"")&&F(i,n),(!ee||te&1&&u!==(u=K[0].sender.fullname))&&m(c,"alt",u),(!ee||te&1&&!Ne(c.src,d=K[0].sender.pictureurl))&&m(c,"src",d),(!ee||te&1)&&k!==(k=K[0].sender.fullname+"")&&F(M,k),(!ee||te&1&&w!==(w=K[0].sender.profileurl))&&m(p,"href",w),(!ee||te&1)&&$!==($=K[0].fulltime+"")&&F(z,$),(!ee||te&1)&&Y!==(Y=K[0].content+"")&&(H.innerHTML=Y),K[0].attachments.length>0?I?(I.p(K,te),te&1&&S(I,1)):(I=wl(K),I.c(),S(I,1),I.m(t,null)):I&&(re(),j(I,1,1,()=>{I=null}),ae())},i(K){ee||(S(I),ee=!0)},o(K){j(I),ee=!1},d(K){K&&D(e),I&&I.d()}}}function ar(s,e,t){let{reference:l}=e;return s.$$set=n=>{"reference"in n&&t(0,l=n.reference)},[l]}class dn extends me{constructor(e){super(),de(this,e,ar,rr,ce,{reference:0})}}function yl(s,e,t){const l=s.slice();return l[4]=e[t],l}function Ml(s,e,t){const l=s.slice();return l[7]=e[t],l[9]=t,l}function $l(s){let e,t,l=s[3].strings[s[4]]+"",n,i,r,a=[],o=new Map,f,c=fe(s[2](s[4]));const u=d=>d[7].id;for(let d=0;d<c.length;d+=1){let g=Ml(s,c,d),h=u(g);o.set(h,a[d]=Dl(h,g))}return{c(){e=v("div"),t=v("span"),n=B(l),i=B(":"),r=T();for(let d=0;d<a.length;d+=1)a[d].c();f=T(),m(e,"class","mb-2")},m(d,g){C(d,e,g),_(e,t),_(t,n),_(t,i),_(e,r);for(let h=0;h<a.length;h+=1)a[h]&&a[h].m(e,null);_(e,f)},p(d,g){g&8&&l!==(l=d[3].strings[d[4]]+"")&&F(n,l),g&4&&(c=fe(d[2](d[4])),a=De(a,g,u,1,d,c,o,e,He,Dl,f,Ml))},d(d){d&&D(e);for(let g=0;g<a.length;g+=1)a[g].d()}}}function Cl(s){let e;return{c(){e=B(",")},m(t,l){C(t,e,l)},d(t){t&&D(e)}}}function Dl(s,e){let t,l,n,i=e[7].fullname+"",r,a,o=e[9]>0&&Cl();return{key:s,first:null,c(){t=be(),o&&o.c(),l=T(),n=v("a"),r=B(i),m(n,"href",a=e[7].profileurl),this.first=t},m(f,c){C(f,t,c),o&&o.m(f,c),C(f,l,c),C(f,n,c),_(n,r)},p(f,c){e=f,e[9]>0?o||(o=Cl(),o.c(),o.m(l.parentNode,l)):o&&(o.d(1),o=null),c&4&&i!==(i=e[7].fullname+"")&&F(r,i),c&4&&a!==(a=e[7].profileurl)&&m(n,"href",a)},d(f){f&&(D(t),D(l),D(n)),o&&o.d(f)}}}function Sl(s){let e=s[2](s[4]).length>0,t,l=e&&$l(s);return{c(){l&&l.c(),t=be()},m(n,i){l&&l.m(n,i),C(n,t,i)},p(n,i){i&4&&(e=n[2](n[4]).length>0),e?l?l.p(n,i):(l=$l(n),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null)},d(n){n&&D(t),l&&l.d(n)}}}function or(s){let e,t,l,n,i,r,a,o,f,c=s[1].sender.fullname+"",u,d,g,h=fe(Object.values(ze)),p=[];for(let k=0;k<h.length;k+=1)p[k]=Sl(yl(s,h,k));return{c(){e=v("div"),t=v("div"),l=v("img"),r=T(),a=v("div"),o=v("div"),f=v("a"),u=B(c),g=T();for(let k=0;k<p.length;k+=1)p[k].c();m(l,"aria-hidden","true"),m(l,"alt",n=s[1].sender.fullname),Ne(l.src,i=s[1].sender.pictureurl)||m(l,"src",i),m(l,"width","35"),m(l,"height","35"),m(l,"class","rounded-circle"),m(t,"class","mr-3"),m(f,"href",d=s[1].sender.profileurl),m(o,"class","mt-1 mb-2"),m(a,"class","d-flex flex-column"),m(e,"class","local-mail-message-users d-flex mb-n2")},m(k,M){C(k,e,M),_(e,t),_(t,l),_(e,r),_(e,a),_(a,o),_(o,f),_(f,u),_(a,g);for(let w=0;w<p.length;w+=1)p[w]&&p[w].m(a,null)},p(k,[M]){if(M&2&&n!==(n=k[1].sender.fullname)&&m(l,"alt",n),M&2&&!Ne(l.src,i=k[1].sender.pictureurl)&&m(l,"src",i),M&2&&c!==(c=k[1].sender.fullname+"")&&F(u,c),M&2&&d!==(d=k[1].sender.profileurl)&&m(f,"href",d),M&12){h=fe(Object.values(ze));let w;for(w=0;w<h.length;w+=1){const y=yl(k,h,w);p[w]?p[w].p(y,M):(p[w]=Sl(y),p[w].c(),p[w].m(a,null))}for(;w<p.length;w+=1)p[w].d(1);p.length=h.length}},i:U,o:U,d(k){k&&D(e),Ie(p,k)}}}function fr(s,e,t){let l,n,i=U,r=()=>(i(),i=_e(a,f=>t(3,n=f)),a);s.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;return s.$$set=f=>{"store"in f&&r(t(0,a=f.store)),"message"in f&&t(1,o=f.message)},s.$$.update=()=>{s.$$.dirty&2&&t(2,l=f=>o.recipients.filter(c=>c.type==f))},[a,o,l,n]}class ur extends me{constructor(e){super(),de(this,e,fr,or,ce,{store:0,message:1})}}function Tl(s,e,t){const l=s.slice();return l[4]=e[t],l}function Ll(s){let e,t,l,n;return l=new mn({props:{message:s[1]}}),{c(){e=v("hr"),t=T(),W(l.$$.fragment)},m(i,r){C(i,e,r),C(i,t,r),X(l,i,r),n=!0},p(i,r){const a={};r&2&&(a.message=i[1]),l.$set(a)},i(i){n||(S(l.$$.fragment,i),n=!0)},o(i){j(l.$$.fragment,i),n=!1},d(i){i&&(D(e),D(t)),Q(l,i)}}}function zl(s){let e,t=s[2].strings.references+"",l,n,i=[],r=new Map,a,o,f=fe(s[1].references);const c=u=>u[4].id;for(let u=0;u<f.length;u+=1){let d=Tl(s,f,u),g=c(d);r.set(g,i[u]=jl(g,d))}return{c(){e=v("div"),l=B(t),n=T();for(let u=0;u<i.length;u+=1)i[u].c();a=be(),m(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(u,d){C(u,e,d),_(e,l),C(u,n,d);for(let g=0;g<i.length;g+=1)i[g]&&i[g].m(u,d);C(u,a,d),o=!0},p(u,d){(!o||d&4)&&t!==(t=u[2].strings.references+"")&&F(l,t),d&2&&(f=fe(u[1].references),re(),i=De(i,d,c,1,u,f,r,a.parentNode,Xe,jl,a,Tl),ae())},i(u){if(!o){for(let d=0;d<f.length;d+=1)S(i[d]);o=!0}},o(u){for(let d=0;d<i.length;d+=1)j(i[d]);o=!1},d(u){u&&(D(e),D(n),D(a));for(let d=0;d<i.length;d+=1)i[d].d(u)}}}function jl(s,e){let t,l,n;return l=new dn({props:{reference:e[4]}}),{key:s,first:null,c(){t=be(),W(l.$$.fragment),this.first=t},m(i,r){C(i,t,r),X(l,i,r),n=!0},p(i,r){e=i;const a={};r&2&&(a.reference=e[4]),l.$set(a)},i(i){n||(S(l.$$.fragment,i),n=!0)},o(i){j(l.$$.fragment,i),n=!1},d(i){i&&D(t),Q(l,i)}}}function cr(s){let e,t,l,n=s[1].subject+"",i,r,a,o,f,c,u,d,g=s[1].fulltime+"",h,p,k,M,w,y,b,$,z,N,L=s[1].content+"",q,H,Y,V,ee,I,K,te,oe;f=new ir({props:{store:s[0],message:s[1]}}),M=new Qi({props:{store:s[0],message:s[1],canReplyAll:s[3]}}),y=new ur({props:{store:s[0],message:s[1]}});let E=s[1].attachments.length>0&&Ll(s);I=new lr({props:{store:s[0],message:s[1],canReplyAll:s[3]}});let J=s[1].references.length>0&&zl(s);return{c(){e=v("div"),t=v("div"),l=v("h3"),i=B(n),r=T(),a=v("div"),o=v("div"),W(f.$$.fragment),c=T(),u=v("div"),d=v("div"),h=B(g),p=T(),k=v("div"),W(M.$$.fragment),w=T(),W(y.$$.fragment),b=T(),$=v("hr"),z=T(),N=v("div"),q=T(),E&&E.c(),H=T(),Y=v("hr"),V=T(),ee=v("div"),W(I.$$.fragment),K=T(),J&&J.c(),te=be(),m(l,"class","h4 card-title mb-3 mb-md-2"),m(o,"class","d-flex flex-wrap mx-n2 mt-2"),ue(o,"min-width","0"),m(d,"class","my-2 text-truncate"),m(k,"class","d-flex flex-shrink-0 ml-3 mr-n2"),m(u,"class","d-flex justify-content-between flex-shrink-0 ml-auto"),m(a,"class","d-md-flex align-items-start mb-2"),m(N,"class","local-mail-message-content svelte-18ecame"),m(ee,"class","mt-3 d-flex mr-n3 mb-n3 flex-column flex-sm-row justify-content-end"),m(t,"class","card-body p-3 px-xl-4"),m(e,"class","card")},m(le,A){C(le,e,A),_(e,t),_(t,l),_(l,i),_(t,r),_(t,a),_(a,o),X(f,o,null),_(a,c),_(a,u),_(u,d),_(d,h),_(u,p),_(u,k),X(M,k,null),_(t,w),X(y,t,null),_(t,b),_(t,$),_(t,z),_(t,N),N.innerHTML=L,_(t,q),E&&E.m(t,null),_(t,H),_(t,Y),_(t,V),_(t,ee),X(I,ee,null),C(le,K,A),J&&J.m(le,A),C(le,te,A),oe=!0},p(le,[A]){(!oe||A&2)&&n!==(n=le[1].subject+"")&&F(i,n);const P={};A&1&&(P.store=le[0]),A&2&&(P.message=le[1]),f.$set(P),(!oe||A&2)&&g!==(g=le[1].fulltime+"")&&F(h,g);const ie={};A&1&&(ie.store=le[0]),A&2&&(ie.message=le[1]),A&8&&(ie.canReplyAll=le[3]),M.$set(ie);const R={};A&1&&(R.store=le[0]),A&2&&(R.message=le[1]),y.$set(R),(!oe||A&2)&&L!==(L=le[1].content+"")&&(N.innerHTML=L),le[1].attachments.length>0?E?(E.p(le,A),A&2&&S(E,1)):(E=Ll(le),E.c(),S(E,1),E.m(t,H)):E&&(re(),j(E,1,1,()=>{E=null}),ae());const se={};A&1&&(se.store=le[0]),A&2&&(se.message=le[1]),A&8&&(se.canReplyAll=le[3]),I.$set(se),le[1].references.length>0?J?(J.p(le,A),A&2&&S(J,1)):(J=zl(le),J.c(),S(J,1),J.m(te.parentNode,te)):J&&(re(),j(J,1,1,()=>{J=null}),ae())},i(le){oe||(S(f.$$.fragment,le),S(M.$$.fragment,le),S(y.$$.fragment,le),S(E),S(I.$$.fragment,le),S(J),oe=!0)},o(le){j(f.$$.fragment,le),j(M.$$.fragment,le),j(y.$$.fragment,le),j(E),j(I.$$.fragment,le),j(J),oe=!1},d(le){le&&(D(e),D(K),D(te)),Q(f),Q(M),Q(y),E&&E.d(),Q(I),J&&J.d(le)}}}function mr(s,e,t){let l,n,i=U,r=()=>(i(),i=_e(a,f=>t(2,n=f)),a);s.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;return s.$$set=f=>{"store"in f&&r(t(0,a=f.store)),"message"in f&&t(1,o=f.message)},s.$$.update=()=>{s.$$.dirty&6&&t(3,l=o.sender.id==n.userid?o.recipients.filter(f=>f.type=="cc").length>0:o.recipients.filter(f=>["to","cc"].includes(f.type)&&f.id!=n.userid).length>0)},[a,o,n,l]}class dr extends me{constructor(e){super(),de(this,e,mr,cr,ce,{store:0,message:1})}}function Nl(s,e,t){const l=s.slice();return l[29]=e[t],l}function _r(s){var a;let e,t=((a=s[11])==null?void 0:a[s[8]])+"",l,n,i,r;return{c(){e=v("button"),l=B(t),m(e,"type","button"),m(e,"class","form-control px-5 text-left"),G(e,"alert-primary",s[4])},m(o,f){var c;C(o,e,f),_(e,l),i||(r=[$e(n=Be.call(null,e,((c=s[11])==null?void 0:c[s[8]])||"")),O(e,"click",s[17])],i=!0)},p(o,f){var c,u;f[0]&2304&&t!==(t=((c=o[11])==null?void 0:c[o[8]])+"")&&F(l,t),n&&Me(n.update)&&f[0]&2304&&n.update.call(null,((u=o[11])==null?void 0:u[o[8]])||""),f[0]&16&&G(e,"alert-primary",o[4])},d(o){o&&D(e),i=!1,ve(r)}}}function gr(s){let e,t,l;return{c(){e=v("input"),m(e,"type","text"),m(e,"class","form-control px-5 text-truncate"),m(e,"placeholder",s[1]),m(e,"aria-label",s[1])},m(n,i){C(n,e,i),we(e,s[6]),s[25](e),t||(l=[O(e,"input",s[24]),O(e,"focus",s[15]),O(e,"keyup",s[20])],t=!0)},p(n,i){i[0]&2&&m(e,"placeholder",n[1]),i[0]&2&&m(e,"aria-label",n[1]),i[0]&64&&e.value!==n[6]&&we(e,n[6])},d(n){n&&D(e),s[25](null),t=!1,ve(l)}}}function pr(s){var a;let e,t=((a=s[11])==null?void 0:a[s[8]])+"",l,n,i,r;return{c(){e=v("div"),l=B(t),m(e,"class","alert-secondary form-control pl-5 pr-2 text-left")},m(o,f){var c;C(o,e,f),_(e,l),i||(r=$e(n=Be.call(null,e,((c=s[11])==null?void 0:c[s[8]])||"")),i=!0)},p(o,f){var c,u;f[0]&2304&&t!==(t=((c=o[11])==null?void 0:c[o[8]])+"")&&F(l,t),n&&Me(n.update)&&f[0]&2304&&n.update.call(null,((u=o[11])==null?void 0:u[o[8]])||"")},d(o){o&&D(e),i=!1,r()}}}function Al(s){let e,t,l,n,i,r=s[9].strings.togglefilterresults+"",a,o,f,c;return{c(){e=v("button"),t=v("i"),n=T(),i=v("span"),a=B(r),o=B("n"),m(t,"class",l="fa fa-fw "+s[13]+" svelte-ept5ag"),m(t,"aria-hidden","true"),m(i,"class","sr-only"),m(e,"type","button"),m(e,"aria-expanded",s[7]),m(e,"class","btn position-absolute h-100 d-flex align-items-center px-2"),ue(e,"top","0"),ue(e,"right","0")},m(u,d){C(u,e,d),_(e,t),_(e,n),_(e,i),_(i,a),_(i,o),f||(c=O(e,"click",s[17]),f=!0)},p(u,d){d[0]&8192&&l!==(l="fa fa-fw "+u[13]+" svelte-ept5ag")&&m(t,"class",l),d[0]&512&&r!==(r=u[9].strings.togglefilterresults+"")&&F(a,r),d[0]&128&&m(e,"aria-expanded",u[7])},d(u){u&&D(e),f=!1,c()}}}function Bl(s){let e,t,l=[],n=new Map,i,r=!s[2]&&ql(s),a=fe(s[14]);const o=c=>c[29].id;for(let c=0;c<a.length;c+=1){let u=Nl(s,a,c),d=o(u);n.set(d,l[c]=El(d,u))}let f=null;return a.length||(f=Il(s)),{c(){e=v("div"),r&&r.c(),t=T();for(let c=0;c<l.length;c+=1)l[c].c();f&&f.c(),m(e,"class",i="dropdown-menu dropdown-menu-"+s[5]+" show svelte-ept5ag")},m(c,u){C(c,e,u),r&&r.m(e,null),_(e,t);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(e,null);f&&f.m(e,null)},p(c,u){c[2]?r&&(r.d(1),r=null):r?r.p(c,u):(r=ql(c),r.c(),r.m(e,t)),u[0]&545280&&(a=fe(c[14]),l=De(l,u,o,1,c,a,n,e,He,El,null,Nl),!a.length&&f?f.p(c,u):a.length?f&&(f.d(1),f=null):(f=Il(c),f.c(),f.m(e,null))),u[0]&32&&i!==(i="dropdown-menu dropdown-menu-"+c[5]+" show svelte-ept5ag")&&m(e,"class",i)},d(c){c&&D(e),r&&r.d();for(let u=0;u<l.length;u+=1)l[u].d();f&&f.d()}}}function ql(s){let e,t=s[9].strings.allcourses+"",l,n,i,r,a;return{c(){e=v("button"),l=B(t),n=T(),i=v("div"),m(e,"type","button"),m(e,"class","dropdown-item text-truncate svelte-ept5ag"),m(i,"class","dropdown-divider")},m(o,f){C(o,e,f),_(e,l),C(o,n,f),C(o,i,f),r||(a=O(e,"click",s[26]),r=!0)},p(o,f){f[0]&512&&t!==(t=o[9].strings.allcourses+"")&&F(l,t)},d(o){o&&(D(e),D(n),D(i)),r=!1,a()}}}function Il(s){let e,t=s[9].strings.emptycoursefilterresults+"",l,n;return{c(){e=v("div"),l=B(t),n=T(),m(e,"class","px-4 text-danger")},m(i,r){C(i,e,r),_(e,l),_(e,n)},p(i,r){r[0]&512&&t!==(t=i[9].strings.emptycoursefilterresults+"")&&F(l,t)},d(i){i&&D(e)}}}function El(s,e){let t,l,n=e[12](e[29])+"",i,r,a;function o(){return e[27](e[29])}return{key:s,first:null,c(){t=v("button"),l=new Tn(!1),i=T(),l.a=i,m(t,"type","button"),m(t,"class","dropdown-item text-truncate svelte-ept5ag"),this.first=t},m(f,c){C(f,t,c),l.m(n,t),_(t,i),r||(a=O(t,"click",o),r=!0)},p(f,c){e=f,c[0]&20480&&n!==(n=e[12](e[29])+"")&&l.p(n)},d(f){f&&D(t),r=!1,a()}}}function br(s){let e,t,l,n,i,r,a;function o(g,h){return g[3]?pr:g[7]||!g[11]?gr:_r}let f=o(s),c=f(s),u=!s[3]&&Al(s),d=s[7]&&Bl(s);return{c(){e=v("div"),t=v("div"),t.innerHTML='<i class="fa fa-fw fa-filter" aria-hidden="true"></i>',l=T(),c.c(),n=T(),u&&u.c(),i=T(),d&&d.c(),m(t,"class","position-absolute h-100 d-flex align-items-center px-2"),ue(t,"top","0"),ue(t,"left","0"),m(e,"class","local-mail-course-select position-relative d-flex svelte-ept5ag")},m(g,h){C(g,e,h),_(e,t),_(e,l),c.m(e,null),_(e,n),u&&u.m(e,null),_(e,i),d&&d.m(e,null),r||(a=$e(Pe.call(null,e,s[16])),r=!0)},p(g,h){f===(f=o(g))&&c?c.p(g,h):(c.d(1),c=f(g),c&&(c.c(),c.m(e,n))),g[3]?u&&(u.d(1),u=null):u?u.p(g,h):(u=Al(g),u.c(),u.m(e,i)),g[7]?d?d.p(g,h):(d=Bl(g),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},i:U,o:U,d(g){g&&D(e),c.d(),u&&u.d(),d&&d.d(),r=!1,a()}}}function hr(s,e,t){let l,n,i,r,a,o=U,f=()=>(o(),o=_e(c,E=>t(9,a=E)),c);s.$$.on_destroy.push(()=>o());let{store:c}=e;f();let{label:u}=e,{selected:d}=e,{required:g=!1}=e,{readonly:h=!1}=e,{primary:p=!1}=e,{align:k="left"}=e,{onChange:M}=e,w,y="",b=!1,$,z;const N=E=>E.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&"),L=async()=>{t(7,b=!0),t(6,y=""),await Ye(),w.focus()},q=()=>{t(7,b=!1),t(6,y="")},H=async()=>{b?q():L()},Y=async()=>{await M(),t(21,d=void 0),t(7,b=!1),t(6,y="")},V=async E=>{await M(E.id),t(21,d=E.id),t(7,b=!1),t(6,y="")},ee=E=>{E.key=="Escape"&&(t(7,b=!1),t(6,y=""),w.blur())};function I(){y=this.value,t(6,y)}function K(E){Ce[E?"unshift":"push"](()=>{w=E,t(10,w)})}const te=()=>Y(),oe=E=>V(E);return s.$$set=E=>{"store"in E&&f(t(0,c=E.store)),"label"in E&&t(1,u=E.label),"selected"in E&&t(21,d=E.selected),"required"in E&&t(2,g=E.required),"readonly"in E&&t(3,h=E.readonly),"primary"in E&&t(4,p=E.primary),"align"in E&&t(5,k=E.align),"onChange"in E&&t(22,M=E.onChange)},s.$$.update=()=>{s.$$.dirty[0]&512&&t(8,z=a.settings.filterbycourse=="shortname"?"shortname":"fullname"),s.$$.dirty[0]&2097664&&t(11,$=a.courses.find(E=>E.id==d)),s.$$.dirty[0]&64&&t(23,l=new RegExp(N(y.trim()).replaceAll(/\s+/gu,"\\s+"),"giu")),s.$$.dirty[0]&8389376&&t(14,n=a.courses.filter(E=>E[z].match(l))),s.$$.dirty[0]&192&&t(13,i=b?y?"fa-times":"fa-caret-up":"fa-caret-down"),s.$$.dirty[0]&8388864&&t(12,r=E=>E[z].replaceAll(l,J=>J.trim()?"<mark>"+J+"</mark>":J))},[c,u,g,h,p,k,y,b,z,a,w,$,r,i,n,L,q,H,Y,V,ee,d,M,l,I,K,te,oe]}class _n extends me{constructor(e){super(),de(this,e,hr,br,ce,{store:0,label:1,selected:21,required:2,readonly:3,primary:4,align:5,onChange:22},null,[-1,-1])}}function Rl(s,e,t){const l=s.slice();l[6]=e[t];const n=Array.from(l[1].values()).filter(function(...r){return s[5](l[6],...r)});return l[7]=n,l}function Fl(s,e,t){const l=s.slice();return l[10]=e[t],l}function Pl(s){let e,t,l=s[3].strings[s[6]]+"",n,i,r,a,o=[],f=new Map,c,u,d,g=fe(s[7]);const h=p=>p[10].id;for(let p=0;p<g.length;p+=1){let k=Fl(s,g,p),M=h(k);f.set(M,o[p]=Ol(M,k))}return{c(){e=v("div"),t=v("div"),n=B(l),i=B(":"),r=T(),a=v("div");for(let p=0;p<o.length;p+=1)o[p].c();c=T(),m(t,"class","local-mail-message-form-recipients-type flex-shrink-0 py-2 mr-2 svelte-1uaipzj"),m(a,"class","d-flex flex-wrap"),ue(a,"min-width","0"),m(e,"class","d-flex mb-2")},m(p,k){C(p,e,k),_(e,t),_(t,n),_(t,i),_(e,r),_(e,a);for(let M=0;M<o.length;M+=1)o[M]&&o[M].m(a,null);_(e,c),d=!0},p(p,k){(!d||k&8)&&l!==(l=p[3].strings[p[6]]+"")&&F(n,l),k&14&&(g=fe(p[7]),re(),o=De(o,k,h,1,p,g,f,a,Xe,Ol,null,Fl),ae())},i(p){if(!d){for(let k=0;k<g.length;k+=1)S(o[k]);p&&Le(()=>{d&&(u||(u=Re(e,qe,{},!0)),u.run(1))}),d=!0}},o(p){for(let k=0;k<o.length;k+=1)j(o[k]);p&&(u||(u=Re(e,qe,{},!1)),u.run(0)),d=!1},d(p){p&&D(e);for(let k=0;k<o.length;k+=1)o[k].d();p&&u&&u.end()}}}function vr(s){let e,t,l;return{c(){e=v("div"),t=v("i"),m(t,"class","fa fa-exclamation-circle"),m(e,"class","m-0 d-flex justify-content-center align-items-center"),ue(e,"width","35px"),ue(e,"height","35px"),m(e,"title",l=s[3].strings.cannotsendmailtouser)},m(n,i){C(n,e,i),_(e,t)},p(n,i){i&8&&l!==(l=n[3].strings.cannotsendmailtouser)&&m(e,"title",l)},d(n){n&&D(e)}}}function kr(s){let e,t,l;return{c(){e=v("img"),m(e,"aria-hidden","true"),m(e,"alt",t=s[10].fullname),Ne(e.src,l=s[10].pictureurl)||m(e,"src",l),m(e,"width","35"),m(e,"height","35"),m(e,"class","rounded-circle")},m(n,i){C(n,e,i)},p(n,i){i&2&&t!==(t=n[10].fullname)&&m(e,"alt",t),i&2&&!Ne(e.src,l=n[10].pictureurl)&&m(e,"src",l)},d(n){n&&D(e)}}}function Ol(s,e){let t,l,n,i,r=e[10].fullname+"",a,o,f,c,u,d,g,h,p,k,M,w;function y(N,L){return N[10].isvalid?kr:vr}let b=y(e),$=b(e);function z(){return e[4](e[10])}return{key:s,first:null,c(){t=v("div"),l=v("div"),$.c(),n=T(),i=v("div"),a=B(r),f=T(),c=v("button"),u=v("i"),g=T(),m(l,"class","d-flex m-1 mr-2"),m(i,"class","py-2"),m(u,"class","fa fa-fw fa-times"),m(c,"type","button"),m(c,"class","btn align-self-middle p-2 align-bottom svelte-1uaipzj"),m(c,"title",d=e[3].strings.delete),m(t,"class","local-mail-message-form-recipients-user d-flex flex-shrink align-items-center mr-2 mb-2 svelte-1uaipzj"),G(t,"alert-danger",!e[10].isvalid),this.first=t},m(N,L){C(N,t,L),_(t,l),$.m(l,null),_(t,n),_(t,i),_(i,a),_(t,f),_(t,c),_(c,u),_(t,g),k=!0,M||(w=[$e(o=Be.call(null,i,e[10].fullname)),O(c,"click",z),$e(h=Be.call(null,t,e[10].fullname))],M=!0)},p(N,L){e=N,b===(b=y(e))&&$?$.p(e,L):($.d(1),$=b(e),$&&($.c(),$.m(l,null))),(!k||L&2)&&r!==(r=e[10].fullname+"")&&F(a,r),o&&Me(o.update)&&L&2&&o.update.call(null,e[10].fullname),(!k||L&8&&d!==(d=e[3].strings.delete))&&m(c,"title",d),h&&Me(h.update)&&L&2&&h.update.call(null,e[10].fullname),(!k||L&2)&&G(t,"alert-danger",!e[10].isvalid)},i(N){k||(N&&Le(()=>{k&&(p||(p=Re(t,qe,{},!0)),p.run(1))}),k=!0)},o(N){N&&(p||(p=Re(t,qe,{},!1)),p.run(0)),k=!1},d(N){N&&D(t),$.d(),N&&p&&p.end(),M=!1,ve(w)}}}function Hl(s){let e,t,l=s[7].length&&Pl(s);return{c(){l&&l.c(),e=be()},m(n,i){l&&l.m(n,i),C(n,e,i),t=!0},p(n,i){n[7].length?l?(l.p(n,i),i&2&&S(l,1)):(l=Pl(n),l.c(),S(l,1),l.m(e.parentNode,e)):l&&(re(),j(l,1,1,()=>{l=null}),ae())},i(n){t||(S(l),t=!0)},o(n){j(l),t=!1},d(n){n&&D(e),l&&l.d(n)}}}function wr(s){let e,t,l=fe(Object.values(ze)),n=[];for(let r=0;r<l.length;r+=1)n[r]=Hl(Rl(s,l,r));const i=r=>j(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=be()},m(r,a){for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(r,a);C(r,e,a),t=!0},p(r,[a]){if(a&14){l=fe(Object.values(ze));let o;for(o=0;o<l.length;o+=1){const f=Rl(r,l,o);n[o]?(n[o].p(f,a),S(n[o],1)):(n[o]=Hl(f),n[o].c(),S(n[o],1),n[o].m(e.parentNode,e))}for(re(),o=l.length;o<n.length;o+=1)i(o);ae()}},i(r){if(!t){for(let a=0;a<l.length;a+=1)S(n[a]);t=!0}},o(r){n=n.filter(Boolean);for(let a=0;a<n.length;a+=1)j(n[a]);t=!1},d(r){r&&D(e),Ie(n,r)}}}function yr(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,u=>t(3,l=u)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{recipients:a}=e,{onDelete:o}=e;const f=u=>o(u),c=(u,d)=>d.type==u;return s.$$set=u=>{"store"in u&&i(t(0,r=u.store)),"recipients"in u&&t(1,a=u.recipients),"onDelete"in u&&t(2,o=u.onDelete)},[r,a,o,l,f,c]}class Mr extends me{constructor(e){super(),de(this,e,yr,wr,ce,{store:0,recipients:1,onDelete:2})}}function Ul(s,e,t){const l=s.slice();return l[4]=e[t],l}function $r(s){let e,t,l=s[1].shorttime+"",n;return{c(){e=v("i"),t=T(),n=B(l),m(e,"class","fa fa-clock-o mr-1"),m(e,"aria-hidden","true")},m(i,r){C(i,e,r),C(i,t,r),C(i,n,r)},p(i,r){r&2&&l!==(l=i[1].shorttime+"")&&F(n,l)},d(i){i&&(D(e),D(t),D(n))}}}function Cr(s){let e,t,l=s[2].strings.draftsaved+"",n;return{c(){e=v("i"),t=T(),n=B(l),m(e,"class","fa fa-check mr-1"),m(e,"aria-hidden","true")},m(i,r){C(i,e,r),C(i,t,r),C(i,n,r)},p(i,r){r&4&&l!==(l=i[2].strings.draftsaved+"")&&F(n,l)},d(i){i&&(D(e),D(t),D(n))}}}function Gl(s){let e,t=[],l=new Map,n,i=fe(s[1].labels);const r=a=>a[4].id;for(let a=0;a<i.length;a+=1){let o=Ul(s,i,a),f=r(o);l.set(f,t[a]=Vl(f,o))}return{c(){e=v("div");for(let a=0;a<t.length;a+=1)t[a].c();m(e,"class","d-flex flex-wrap mt-2 mr-2"),ue(e,"min-width","0")},m(a,o){C(a,e,o);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(a,o){o&2&&(i=fe(a[1].labels),re(),t=De(t,o,r,1,a,i,l,e,Xe,Vl,null,Ul),ae())},i(a){if(!n){for(let o=0;o<i.length;o+=1)S(t[o]);n=!0}},o(a){for(let o=0;o<t.length;o+=1)j(t[o]);n=!1},d(a){a&&D(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function Vl(s,e){let t,l,n;return l=new mt({props:{label:e[4]}}),{key:s,first:null,c(){t=be(),W(l.$$.fragment),this.first=t},m(i,r){C(i,t,r),X(l,i,r),n=!0},p(i,r){e=i;const a={};r&2&&(a.label=e[4]),l.$set(a)},i(i){n||(S(l.$$.fragment,i),n=!0)},o(i){j(l.$$.fragment,i),n=!1},d(i){i&&D(t),Q(l,i)}}}function Dr(s){let e,t,l,n,i,r,a,o,f,c,u,d,g,h,p;function k(b,$){return b[2].draftSaved?Cr:$r}let M=k(s),w=M(s),y=s[1].labels&&Gl(s);return{c(){e=v("div"),t=v("div"),l=v("div"),w.c(),i=T(),r=v("button"),a=v("i"),d=T(),y&&y.c(),m(l,"class","align-self-center alert-info px-2 text-truncate"),m(l,"title",n=s[1].fulltime),m(a,"class",o="fa "+(s[1].starred?"fa-star text-warning":"fa-star-o")),m(r,"type","button"),m(r,"class","btn border-0 py-2 ml-auto mr-3 mr-sm-2"),m(r,"role","checkbox"),m(r,"aria-checked",f=s[1].starred),r.disabled=c=s[1].deleted,m(r,"title",u=s[1].starred?s[2].strings.markasunstarred:s[2].strings.markasstarred),m(t,"class","d-flex flex-grow-1"),m(e,"class","d-sm-flex justify-content-between mb-2 mr-n3")},m(b,$){C(b,e,$),_(e,t),_(t,l),w.m(l,null),_(t,i),_(t,r),_(r,a),_(e,d),y&&y.m(e,null),g=!0,h||(p=O(r,"click",s[3]),h=!0)},p(b,[$]){M===(M=k(b))&&w?w.p(b,$):(w.d(1),w=M(b),w&&(w.c(),w.m(l,null))),(!g||$&2&&n!==(n=b[1].fulltime))&&m(l,"title",n),(!g||$&2&&o!==(o="fa "+(b[1].starred?"fa-star text-warning":"fa-star-o")))&&m(a,"class",o),(!g||$&2&&f!==(f=b[1].starred))&&m(r,"aria-checked",f),(!g||$&2&&c!==(c=b[1].deleted))&&(r.disabled=c),(!g||$&6&&u!==(u=b[1].starred?b[2].strings.markasunstarred:b[2].strings.markasstarred))&&m(r,"title",u),b[1].labels?y?(y.p(b,$),$&2&&S(y,1)):(y=Gl(b),y.c(),S(y,1),y.m(e,null)):y&&(re(),j(y,1,1,()=>{y=null}),ae())},i(b){g||(S(y),g=!0)},o(b){j(y),g=!1},d(b){b&&D(e),w.d(),y&&y.d(),h=!1,p()}}}function Sr(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,f=>t(2,l=f)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;const o=()=>r.setStarred([a.id],!a.starred);return s.$$set=f=>{"store"in f&&i(t(0,r=f.store)),"message"in f&&t(1,a=f.message)},[r,a,l,o]}class Tr extends me{constructor(e){super(),de(this,e,Sr,Dr,ce,{store:0,message:1})}}async function Je(s){const e=await Ks("core/ajax");return await Promise.all(e.call(Array.from(s).map(({methodname:l,...n})=>({methodname:`local_mail_${l}`,args:n}))))}function Kl(s,e,t){var i;const l=s.slice();l[30]=e[t];const n=(i=l[2].get(l[30].id))==null?void 0:i.type;return l[31]=n,l}function Yl(s,e,t){const l=s.slice();return l[34]=e[t],l}function Jl(s,e,t){const l=s.slice();l[34]=e[t];const n=l[10].every(function(...r){return s[27](l[34],...r)});return l[37]=n,l}function Wl(s,e,t){const l=s.slice();return l[40]=e[t],l}function Xl(s,e,t){const l=s.slice();return l[43]=e[t],l}function Ql(s){let e,t,l,n,i,r=s[14].strings.allroles+"",a,o=[],f=new Map,c,u,d,g,h=fe(s[8]);const p=b=>b[43].id;for(let b=0;b<h.length;b+=1){let $=Xl(s,h,b),z=p($);f.set(z,o[b]=Zl(z,$))}let k=s[9].length>0&&xl(s);function M(b,$){return b[10].length?b[11]?zr:Lr:jr}let w=M(s),y=w(s);return{c(){e=v("div"),t=v("div"),l=v("div"),n=v("select"),i=v("option"),a=B(r);for(let b=0;b<o.length;b+=1)o[b].c();c=T(),k&&k.c(),u=T(),y.c(),i.__value=0,we(i,i.__value),m(n,"class","form-control text-truncate"),s[12]===void 0&&Le(()=>s[22].call(n)),m(l,"class","flex-grow-1 mx-2 mb-2 mb-sm-0"),m(t,"class","list-group-item d-sm-flex px-2 py-2"),m(e,"class","local-mail-message-form-search-users-dropdown dropdown-menu dropdown-menu-left list-group show p-0 w-100 svelte-vi3u1k"),ue(e,"min-width","18rem")},m(b,$){C(b,e,$),_(e,t),_(t,l),_(l,n),_(n,i),_(i,a);for(let z=0;z<o.length;z+=1)o[z]&&o[z].m(n,null);We(n,s[12],!0),_(t,c),k&&k.m(t,null),_(e,u),y.m(e,null),d||(g=[O(n,"change",s[22]),O(n,"change",s[23])],d=!0)},p(b,$){$[0]&16384&&r!==(r=b[14].strings.allroles+"")&&F(a,r),$[0]&256&&(h=fe(b[8]),o=De(o,$,p,1,b,h,f,n,He,Zl,null,Xl)),$[0]&4352&&We(n,b[12]),b[9].length>0?k?k.p(b,$):(k=xl(b),k.c(),k.m(t,null)):k&&(k.d(1),k=null),w===(w=M(b))&&y?y.p(b,$):(y.d(1),y=w(b),y&&(y.c(),y.m(e,null)))},d(b){b&&D(e);for(let $=0;$<o.length;$+=1)o[$].d();k&&k.d(),y.d(),d=!1,ve(g)}}}function Zl(s,e){let t,l=e[43].name+"",n,i,r;return{key:s,first:null,c(){t=v("option"),n=B(l),i=T(),t.__value=r=e[43].id,we(t,t.__value),this.first=t},m(a,o){C(a,t,o),_(t,n),_(t,i)},p(a,o){e=a,o[0]&256&&l!==(l=e[43].name+"")&&F(n,l),o[0]&256&&r!==(r=e[43].id)&&(t.__value=r,we(t,t.__value))},d(a){a&&D(t)}}}function xl(s){let e,t,l,n=[],i=new Map,r,a,o=s[1].groupmode!=et.Separate&&es(s),f=fe(s[9]);const c=u=>u[40].id;for(let u=0;u<f.length;u+=1){let d=Wl(s,f,u),g=c(d);i.set(g,n[u]=ts(g,d))}return{c(){e=v("div"),t=v("select"),o&&o.c(),l=be();for(let u=0;u<n.length;u+=1)n[u].c();m(t,"class","form-control text-truncate"),ue(t,"min-width","0"),s[13]===void 0&&Le(()=>s[24].call(t)),m(e,"class","flex-grow-1 mx-2")},m(u,d){C(u,e,d),_(e,t),o&&o.m(t,null),_(t,l);for(let g=0;g<n.length;g+=1)n[g]&&n[g].m(t,null);We(t,s[13],!0),r||(a=[O(t,"change",s[24]),O(t,"change",s[25])],r=!0)},p(u,d){u[1].groupmode!=et.Separate?o?o.p(u,d):(o=es(u),o.c(),o.m(t,l)):o&&(o.d(1),o=null),d[0]&512&&(f=fe(u[9]),n=De(n,d,c,1,u,f,i,t,He,ts,null,Wl)),d[0]&8704&&We(t,u[13])},d(u){u&&D(e),o&&o.d();for(let d=0;d<n.length;d+=1)n[d].d();r=!1,ve(a)}}}function es(s){let e,t=s[14].strings.allgroups+"",l;return{c(){e=v("option"),l=B(t),e.__value=0,we(e,e.__value)},m(n,i){C(n,e,i),_(e,l)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.allgroups+"")&&F(l,t)},d(n){n&&D(e)}}}function ts(s,e){let t,l=e[40].name+"",n,i,r;return{key:s,first:null,c(){t=v("option"),n=B(l),i=T(),t.__value=r=e[40].id,we(t,t.__value),m(t,"class","text-truncate"),this.first=t},m(a,o){C(a,t,o),_(t,n),_(t,i)},p(a,o){e=a,o[0]&512&&l!==(l=e[40].name+"")&&F(n,l),o[0]&512&&r!==(r=e[40].id)&&(t.__value=r,we(t,t.__value))},d(a){a&&D(t)}}}function Lr(s){let e,t,l=s[14].strings.allusers+"",n,i,r,a,o,f=[],c=new Map,u,d,g,h=fe(Object.values(ze)),p=[];for(let w=0;w<h.length;w+=1)p[w]=ls(Jl(s,h,w));let k=fe(s[10]);const M=w=>w[30].id;for(let w=0;w<k.length;w+=1){let y=Kl(s,k,w),b=M(y);c.set(b,f[w]=ns(b,y))}return{c(){e=v("div"),t=v("div"),n=B(l),r=T(),a=v("div");for(let w=0;w<p.length;w+=1)p[w].c();o=T();for(let w=0;w<f.length;w+=1)f[w].c();u=be(),m(a,"class","d-flex ml-auto"),m(e,"class","list-group-item d-flex align-items-center px-3 py-2")},m(w,y){C(w,e,y),_(e,t),_(t,n),_(e,r),_(e,a);for(let b=0;b<p.length;b+=1)p[b]&&p[b].m(a,null);C(w,o,y);for(let b=0;b<f.length;b+=1)f[b]&&f[b].m(w,y);C(w,u,y),d||(g=$e(i=Be.call(null,t,s[14].strings.allusers)),d=!0)},p(w,y){if(y[0]&16384&&l!==(l=w[14].strings.allusers+"")&&F(n,l),i&&Me(i.update)&&y[0]&16384&&i.update.call(null,w[14].strings.allusers),y[0]&17420){h=fe(Object.values(ze));let b;for(b=0;b<h.length;b+=1){const $=Jl(w,h,b);p[b]?p[b].p($,y):(p[b]=ls($),p[b].c(),p[b].m(a,null))}for(;b<p.length;b+=1)p[b].d(1);p.length=h.length}y[0]&17420&&(k=fe(w[10]),f=De(f,y,M,1,w,k,c,u.parentNode,He,ns,u,Kl))},d(w){w&&(D(e),D(o),D(u)),Ie(p,w);for(let y=0;y<f.length;y+=1)f[y].d(w);d=!1,g()}}}function zr(s){let e,t=s[14].strings.toomanyusersfound+"",l;return{c(){e=v("div"),l=B(t),m(e,"class","list-group-item text-danger")},m(n,i){C(n,e,i),_(e,l)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.toomanyusersfound+"")&&F(l,t)},d(n){n&&D(e)}}}function jr(s){let e,t=s[14].strings.nousersfound+"",l;return{c(){e=v("div"),l=B(t),m(e,"class","list-group-item text-danger")},m(n,i){C(n,e,i),_(e,l)},p(n,i){i[0]&16384&&t!==(t=n[14].strings.nousersfound+"")&&F(l,t)},d(n){n&&D(e)}}}function ls(s){let e,t=s[14].strings[s[34]]+"",l,n,i,r,a;function o(){return s[26](s[37],s[34])}return{c(){e=v("button"),l=B(t),n=T(),m(e,"type","button"),m(e,"class","btn text-nowrap ml-2"),m(e,"aria-pressed",i=s[37]),G(e,"btn-primary",s[37]),G(e,"btn-secondary",!s[37])},m(f,c){C(f,e,c),_(e,l),_(e,n),r||(a=O(e,"click",o),r=!0)},p(f,c){s=f,c[0]&16384&&t!==(t=s[14].strings[s[34]]+"")&&F(l,t),c[0]&1028&&i!==(i=s[37])&&m(e,"aria-pressed",i),c[0]&1028&&G(e,"btn-primary",s[37]),c[0]&1028&&G(e,"btn-secondary",!s[37])},d(f){f&&D(e),r=!1,a()}}}function ss(s){let e,t=s[14].strings[s[34]]+"",l,n,i,r,a;function o(){return s[28](s[30],s[31],s[34])}return{c(){e=v("button"),l=B(t),n=T(),m(e,"type","button"),m(e,"class","btn text-nowrap mr-2 mb-2 mt-sm-2"),m(e,"aria-pressed",i=s[31]==s[34]),G(e,"btn-primary",s[31]==s[34]),G(e,"btn-secondary",s[31]!=s[34])},m(f,c){C(f,e,c),_(e,l),_(e,n),r||(a=O(e,"click",o),r=!0)},p(f,c){s=f,c[0]&16384&&t!==(t=s[14].strings[s[34]]+"")&&F(l,t),c[0]&1028&&i!==(i=s[31]==s[34])&&m(e,"aria-pressed",i),c[0]&1028&&G(e,"btn-primary",s[31]==s[34]),c[0]&1028&&G(e,"btn-secondary",s[31]!=s[34])},d(f){f&&D(e),r=!1,a()}}}function ns(s,e){let t,l,n,i,r,a,o,f=e[30].fullname+"",c,u,d,g,h,p,k,M=fe(Object.values(ze)),w=[];for(let y=0;y<M.length;y+=1)w[y]=ss(Yl(e,M,y));return{key:s,first:null,c(){t=v("div"),l=v("img"),r=T(),a=v("div"),o=v("div"),c=B(f),d=T(),g=v("div");for(let y=0;y<w.length;y+=1)w[y].c();h=T(),m(l,"aria-hidden","true"),m(l,"alt",n=e[30].fullname),Ne(l.src,i=e[30].pictureurl)||m(l,"src",i),m(l,"width","35"),m(l,"height","35"),m(l,"class","rounded-circle mx-3 my-2"),m(o,"class","py-2 mr-3"),m(g,"class","d-flex ml-auto mr-2"),m(a,"class","d-sm-flex align-items-center flex-grow-1"),m(t,"class","list-group-item d-flex align-items-sm-center p-0"),this.first=t},m(y,b){C(y,t,b),_(t,l),_(t,r),_(t,a),_(a,o),_(o,c),_(a,d),_(a,g);for(let $=0;$<w.length;$+=1)w[$]&&w[$].m(g,null);_(t,h),p||(k=$e(u=Be.call(null,o,e[30].fullname)),p=!0)},p(y,b){if(e=y,b[0]&1024&&n!==(n=e[30].fullname)&&m(l,"alt",n),b[0]&1024&&!Ne(l.src,i=e[30].pictureurl)&&m(l,"src",i),b[0]&1024&&f!==(f=e[30].fullname+"")&&F(c,f),u&&Me(u.update)&&b[0]&1024&&u.update.call(null,e[30].fullname),b[0]&17420){M=fe(Object.values(ze));let $;for($=0;$<M.length;$+=1){const z=Yl(e,M,$);w[$]?w[$].p(z,b):(w[$]=ss(z),w[$].c(),w[$].m(g,null))}for(;$<w.length;$+=1)w[$].d(1);w.length=M.length}},d(y){y&&D(t),Ie(w,y),p=!1,k()}}}function Nr(s){let e,t,l,n,i,r,a,o,f,c,u,d,g,h,p,k,M,w=s[4]&&Ql(s);return{c(){e=v("div"),t=v("div"),l=v("i"),i=T(),r=v("input"),f=T(),c=v("div"),u=v("button"),d=v("i"),p=T(),w&&w.c(),m(l,"class",n="fa fa-fw "+(s[7]?"fa-spinner fa-pulse":"fa-user")),m(l,"aria-hidden","true"),m(t,"class","position-absolute h-100 d-flex justify-content-center align-items-center px-2"),ue(t,"top","0"),ue(t,"left","0"),m(r,"type","text"),m(r,"class","form-control px-5 svelte-vi3u1k"),m(r,"placeholder",a=s[14].strings.addrecipients),m(r,"aria-label",o=s[14].strings.addrecipients),m(r,"autocomplete","off"),G(r,"is-invalid",!s[2].size),m(d,"class",g="fa fa-fw "+(s[5]?"fa-times":s[4]?"fa-caret-up":"fa-caret-down")),m(d,"aria-hidden","true"),m(u,"type","button"),m(u,"aria-expanded",s[4]),m(u,"class","btn px-2"),m(u,"title",h=s[14].strings.cancel),m(c,"class","position-absolute h-100 d-flex align-items-center"),ue(c,"top","0"),ue(c,"right","0"),m(e,"class","local-mail-message-form-search-users-input form-group position-relative svelte-vi3u1k")},m(y,b){C(y,e,b),_(e,t),_(t,l),_(e,i),_(e,r),we(r,s[5]),s[20](r),_(e,f),_(e,c),_(c,u),_(u,d),_(e,p),w&&w.m(e,null),k||(M=[O(r,"input",s[19]),O(r,"input",s[21]),O(r,"focus",s[18]),O(u,"click",Se(s[15])),$e(Pe.call(null,e,s[17]))],k=!0)},p(y,b){b[0]&128&&n!==(n="fa fa-fw "+(y[7]?"fa-spinner fa-pulse":"fa-user"))&&m(l,"class",n),b[0]&16384&&a!==(a=y[14].strings.addrecipients)&&m(r,"placeholder",a),b[0]&16384&&o!==(o=y[14].strings.addrecipients)&&m(r,"aria-label",o),b[0]&32&&r.value!==y[5]&&we(r,y[5]),b[0]&4&&G(r,"is-invalid",!y[2].size),b[0]&48&&g!==(g="fa fa-fw "+(y[5]?"fa-times":y[4]?"fa-caret-up":"fa-caret-down"))&&m(d,"class",g),b[0]&16&&m(u,"aria-expanded",y[4]),b[0]&16384&&h!==(h=y[14].strings.cancel)&&m(u,"title",h),y[4]?w?w.p(y,b):(w=Ql(y),w.c(),w.m(e,null)):w&&(w.d(1),w=null)},i:U,o:U,d(y){y&&D(e),s[20](null),w&&w.d(),k=!1,ve(M)}}}const Ar=500;function Br(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,J=>t(14,l=J)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{course:a}=e,{recipients:o}=e,{onChange:f}=e,c=!1,u="",d,g=!1,h,p=[],k=[],M=[],w=!1,y=0,b=0;const $=async()=>{c?(t(5,u=""),t(4,c=!1),window.clearTimeout(h)):(z(!1),d.focus())},z=async J=>{const le=l.settings.usersearchlimit;t(7,g=!0),window.clearTimeout(h),h=window.setTimeout(async()=>{var ie;const A=[{methodname:"get_roles",courseid:a.id},{methodname:"get_groups",courseid:a.id},{methodname:"search_users",query:{courseid:a.id,fullname:u,roleid:y,groupid:b},limit:le+1}];let P;try{P=await Je(A)}catch(R){r.setError(R),t(7,g=!1),t(4,c=!1),t(11,w=!1),t(10,M=[]);return}t(10,M=P.pop()),t(11,w=M.length>le),t(10,M=M.slice(0,le)),t(9,k=P.pop()),t(13,b=k.find(R=>R.id==b)?b:a.groupmode==et.Separate&&((ie=k[0])==null?void 0:ie.id)||0),t(8,p=P.pop()),t(12,y=p.find(R=>R.id==y)?y:0),t(7,g=!1),t(4,c=!0)},J?Ar:0)},N=()=>{t(5,u=""),t(4,c=!1)},L=()=>{c||z(!1)};function q(){u=this.value,t(5,u)}function H(J){Ce[J?"unshift":"push"](()=>{d=J,t(6,d)})}const Y=()=>z(!0);function V(){y=it(this),t(12,y),t(8,p)}const ee=()=>z(!1);function I(){b=it(this),t(13,b),t(9,k)}const K=()=>z(!1),te=(J,le)=>f(M,J?null:le),oe=(J,le)=>{var A;return((A=o.get(le.id))==null?void 0:A.type)==J},E=(J,le,A)=>f([J],le==A?null:A);return s.$$set=J=>{"store"in J&&i(t(0,r=J.store)),"course"in J&&t(1,a=J.course),"recipients"in J&&t(2,o=J.recipients),"onChange"in J&&t(3,f=J.onChange)},[r,a,o,f,c,u,d,g,p,k,M,w,y,b,l,$,z,N,L,q,H,Y,V,ee,I,K,te,oe,E]}class qr extends me{constructor(e){super(),de(this,e,Br,Nr,ce,{store:0,course:1,recipients:2,onChange:3},null,[-1,-1])}}function Ir(s){let e,t,l,n=s[1].strings.send+"",i,r,a,o;return{c(){e=v("button"),t=v("i"),l=T(),i=B(n),m(t,"class","fa fa-send mr-2"),m(e,"type","button"),m(e,"class","local-mail-action-send btn btn-primary flex-shrink-0 text-nowrap px-3 text-truncate ml-auto"),m(e,"title",r=s[1].strings.send)},m(f,c){C(f,e,c),_(e,t),_(e,l),_(e,i),a||(o=O(e,"click",s[2]),a=!0)},p(f,[c]){c&2&&n!==(n=f[1].strings.send+"")&&F(i,n),c&2&&r!==(r=f[1].strings.send)&&m(e,"title",r)},i:U,o:U,d(f){f&&D(e),a=!1,o()}}}function Er(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,o=>t(1,l=o)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=()=>r.sendMessage();return s.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,l,a]}class gn extends me{constructor(e){super(),de(this,e,Er,Ir,ce,{store:0})}}const{Map:Rr}=Ze;function is(s,e,t){const l=s.slice();return l[19]=e[t],l}function rs(s){let e,t,l,n=s[7].strings.errorinvalidrecipients+"",i;return{c(){e=v("div"),t=v("i"),l=T(),i=B(n),m(t,"class","fa fa-exclamation-circle mr-2"),m(e,"class","alert alert-danger")},m(r,a){C(r,e,a),_(e,t),_(e,l),_(e,i)},p(r,a){a&128&&n!==(n=r[7].strings.errorinvalidrecipients+"")&&F(i,n)},d(r){r&&D(e)}}}function Fr(s){let e,t,l,n=je(s[7].strings.errortoomanyrecipients,s[7].settings.maxrecipients)+"",i;return{c(){e=v("div"),t=v("i"),l=T(),i=B(n),m(t,"class","fa fa-exclamation-circle mr-2"),m(e,"class","alert alert-danger")},m(r,a){C(r,e,a),_(e,t),_(e,l),_(e,i)},p(r,a){a&128&&n!==(n=je(r[7].strings.errortoomanyrecipients,r[7].settings.maxrecipients)+"")&&F(i,n)},d(r){r&&D(e)}}}function Pr(s){let e,t,l,n=s[7].strings.erroremptyrecipients+"",i;return{c(){e=v("div"),t=v("i"),l=T(),i=B(n),m(t,"class","fa fa-exclamation-circle mr-2"),m(e,"class","alert alert-danger")},m(r,a){C(r,e,a),_(e,t),_(e,l),_(e,i)},p(r,a){a&128&&n!==(n=r[7].strings.erroremptyrecipients+"")&&F(i,n)},d(r){r&&D(e)}}}function as(s){let e,t,l,n=s[7].strings.erroremptysubject+"",i;return{c(){e=v("div"),t=v("i"),l=T(),i=B(n),m(t,"class","fa fa-exclamation-circle mr-2"),m(e,"class","alert alert-danger")},m(r,a){C(r,e,a),_(e,t),_(e,l),_(e,i)},p(r,a){a&128&&n!==(n=r[7].strings.erroremptysubject+"")&&F(i,n)},d(r){r&&D(e)}}}function os(s){let e,t=s[7].strings.references+"",l,n,i=[],r=new Rr,a,o,f=fe(s[1].references);const c=u=>u[19].id;for(let u=0;u<f.length;u+=1){let d=is(s,f,u),g=c(d);r.set(g,i[u]=fs(g,d))}return{c(){e=v("div"),l=B(t),n=T();for(let u=0;u<i.length;u+=1)i[u].c();a=be(),m(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(u,d){C(u,e,d),_(e,l),C(u,n,d);for(let g=0;g<i.length;g+=1)i[g]&&i[g].m(u,d);C(u,a,d),o=!0},p(u,d){(!o||d&128)&&t!==(t=u[7].strings.references+"")&&F(l,t),d&2&&(f=fe(u[1].references),re(),i=De(i,d,c,1,u,f,r,a.parentNode,Xe,fs,a,is),ae())},i(u){if(!o){for(let d=0;d<f.length;d+=1)S(i[d]);o=!0}},o(u){for(let d=0;d<i.length;d+=1)j(i[d]);o=!1},d(u){u&&(D(e),D(n),D(a));for(let d=0;d<i.length;d+=1)i[d].d(u)}}}function fs(s,e){let t,l,n;return l=new dn({props:{reference:e[19]}}),{key:s,first:null,c(){t=be(),W(l.$$.fragment),this.first=t},m(i,r){C(i,t,r),X(l,i,r),n=!0},p(i,r){e=i;const a={};r&2&&(a.reference=e[19]),l.$set(a)},i(i){n||(S(l.$$.fragment,i),n=!0)},o(i){j(l.$$.fragment,i),n=!1},d(i){i&&D(t),Q(l,i)}}}function Or(s){let e,t,l,n,i,r,a,o,f,c,u,d,g,h,p,k,M,w,y,b,$=s[2].editorhtml+"",z,N,L=s[2].filemanagerhtml+"",q,H=Array.from(s[5].values()).some(us),Y,V,ee=!s[4].trim(),I,K,te,oe,E,J,le,A;n=new Tr({props:{store:s[0],message:s[1]}}),o=new _n({props:{store:s[0],label:s[7].strings.course,selected:s[6].id,required:!0,readonly:s[1].references.length>0,onChange:s[8]}}),u=new qr({props:{store:s[0],course:s[6],recipients:s[5],onChange:s[9]}}),g=new Mr({props:{store:s[0],recipients:s[5],onDelete:s[10]}});let P=H&&rs(s);function ie(Z,ne){if(Z[5].size==0)return Pr;if(Z[5].size>Z[7].settings.maxrecipients)return Fr}let R=ie(s),se=R&&R(s),pe=ee&&as(s);te=new gn({props:{store:s[0]}});let x=s[1].references.length>0&&os(s);return{c(){e=v("hr"),t=T(),l=v("form"),W(n.$$.fragment),i=T(),r=v("div"),a=v("div"),W(o.$$.fragment),f=T(),c=v("div"),W(u.$$.fragment),d=T(),W(g.$$.fragment),h=T(),p=v("div"),k=v("input"),y=T(),b=v("div"),z=T(),N=v("div"),q=T(),P&&P.c(),Y=T(),se&&se.c(),V=T(),pe&&pe.c(),I=T(),K=v("div"),W(te.$$.fragment),oe=T(),x&&x.c(),E=be(),m(e,"class","d-lg-none mt-0 mb-3 mb-sm-2"),m(a,"class","form-group col-12 col-xl-5"),m(c,"class","col-12 col-xl-7"),m(r,"class","row"),m(k,"type","text"),m(k,"id","local-mail-message-form-subject"),m(k,"class","form-control"),m(k,"placeholder",M=s[7].strings.subject),m(k,"aria-label",w=s[7].strings.subject),m(k,"autocomplete","off"),m(k,"maxlength","100"),G(k,"is-invalid",!s[4].trim()),m(p,"class","form-group"),m(b,"class","form-group"),m(N,"class","form-group"),m(K,"class","d-flex justify-content-end align-items-center"),m(l,"class","pt-lg-2 pb-3 px-lg-4"),G(l,"card",s[7].viewportSize>=ge.LG)},m(Z,ne){C(Z,e,ne),C(Z,t,ne),C(Z,l,ne),X(n,l,null),_(l,i),_(l,r),_(r,a),X(o,a,null),_(r,f),_(r,c),X(u,c,null),_(l,d),X(g,l,null),_(l,h),_(l,p),_(p,k),we(k,s[4]),_(l,y),_(l,b),b.innerHTML=$,_(l,z),_(l,N),N.innerHTML=L,_(l,q),P&&P.m(l,null),_(l,Y),se&&se.m(l,null),_(l,V),pe&&pe.m(l,null),_(l,I),_(l,K),X(te,K,null),s[15](l),C(Z,oe,ne),x&&x.m(Z,ne),C(Z,E,ne),J=!0,le||(A=[O(k,"input",s[12]),O(k,"input",s[13]),O(b,"change",s[14]),O(l,"submit",Se(s[16]))],le=!0)},p(Z,[ne]){const he={};ne&1&&(he.store=Z[0]),ne&2&&(he.message=Z[1]),n.$set(he);const ke={};ne&1&&(ke.store=Z[0]),ne&128&&(ke.label=Z[7].strings.course),ne&64&&(ke.selected=Z[6].id),ne&2&&(ke.readonly=Z[1].references.length>0),o.$set(ke);const Ae={};ne&1&&(Ae.store=Z[0]),ne&64&&(Ae.course=Z[6]),ne&32&&(Ae.recipients=Z[5]),u.$set(Ae);const Ee={};ne&1&&(Ee.store=Z[0]),ne&32&&(Ee.recipients=Z[5]),g.$set(Ee),(!J||ne&128&&M!==(M=Z[7].strings.subject))&&m(k,"placeholder",M),(!J||ne&128&&w!==(w=Z[7].strings.subject))&&m(k,"aria-label",w),ne&16&&k.value!==Z[4]&&we(k,Z[4]),(!J||ne&16)&&G(k,"is-invalid",!Z[4].trim()),(!J||ne&4)&&$!==($=Z[2].editorhtml+"")&&(b.innerHTML=$),(!J||ne&4)&&L!==(L=Z[2].filemanagerhtml+"")&&(N.innerHTML=L),ne&32&&(H=Array.from(Z[5].values()).some(us)),H?P?P.p(Z,ne):(P=rs(Z),P.c(),P.m(l,Y)):P&&(P.d(1),P=null),R===(R=ie(Z))&&se?se.p(Z,ne):(se&&se.d(1),se=R&&R(Z),se&&(se.c(),se.m(l,V))),ne&16&&(ee=!Z[4].trim()),ee?pe?pe.p(Z,ne):(pe=as(Z),pe.c(),pe.m(l,I)):pe&&(pe.d(1),pe=null);const Te={};ne&1&&(Te.store=Z[0]),te.$set(Te),(!J||ne&128)&&G(l,"card",Z[7].viewportSize>=ge.LG),Z[1].references.length>0?x?(x.p(Z,ne),ne&2&&S(x,1)):(x=os(Z),x.c(),S(x,1),x.m(E.parentNode,E)):x&&(re(),j(x,1,1,()=>{x=null}),ae())},i(Z){J||(S(n.$$.fragment,Z),S(o.$$.fragment,Z),S(u.$$.fragment,Z),S(g.$$.fragment,Z),S(te.$$.fragment,Z),S(x),J=!0)},o(Z){j(n.$$.fragment,Z),j(o.$$.fragment,Z),j(u.$$.fragment,Z),j(g.$$.fragment,Z),j(te.$$.fragment,Z),j(x),J=!1},d(Z){Z&&(D(e),D(t),D(l),D(oe),D(E)),Q(n),Q(o),Q(u),Q(g),P&&P.d(),se&&se.d(),pe&&pe.d(),Q(te),s[15](null),x&&x.d(Z),le=!1,ve(A)}}}const us=s=>!s.isvalid;function Hr(s,e,t){let l,n,i,r,a=U,o=()=>(a(),a=_e(f,L=>t(7,r=L)),f);s.$$.on_destroy.push(()=>a());let{store:f}=e;o();let{message:c}=e,{form:u}=e,d,g;Qe(()=>{g==null||g.addEventListener("core_form/uploadChanged",()=>w(!1))}),rt(()=>{d==null||d.remove()});const h=async L=>{const q=await Ks("core/fragment");d==null||d.remove(),await Ye(),d=document.createElement("script"),d.setAttribute("type","text/javascript"),d.innerHTML=q.processCollectedJavascript(L),document.head.append(d)},p=L=>{t(6,l=r.courses.find(q=>q.id==L)||r.courses[0]),w(!0)},k=(L,q)=>{const H=new Map(i);for(const V of L)q?H.set(V.id,{...V,type:q,isvalid:!0}):H.delete(V.id);const Y=Array.from(H.values());Y.sort((V,ee)=>V.sortorder.localeCompare(ee.sortorder)),t(5,i=new Map(Y.map(V=>[V.id,V]))),w(!1)},M=L=>{k([L],null)},w=async L=>{var Y,V,ee;if(!g)return;const q=new FormData(g),H={courseid:l.id,to:Array.from(i.values()).filter(I=>I.type=="to").map(I=>I.id),cc:Array.from(i.values()).filter(I=>I.type=="cc").map(I=>I.id),bcc:Array.from(i.values()).filter(I=>I.type=="bcc").map(I=>I.id),subject:n,content:((Y=q.get("content[text]"))==null?void 0:Y.toString())||"",format:parseInt(((V=q.get("content[format]"))==null?void 0:V.toString())||"")||1,draftitemid:parseInt(((ee=q.get("content[itemid]"))==null?void 0:ee.toString())||"")||0};await f.updateDraft(H,L)};function y(){n=this.value,t(4,n),t(1,c)}const b=()=>w(!1),$=()=>w(!1);function z(L){Ce[L?"unshift":"push"](()=>{g=L,t(3,g)})}const N=()=>w(!0);return s.$$set=L=>{"store"in L&&o(t(0,f=L.store)),"message"in L&&t(1,c=L.message),"form"in L&&t(2,u=L.form)},s.$$.update=()=>{s.$$.dirty&2&&t(6,l=c.course),s.$$.dirty&2&&t(4,n=c.subject),s.$$.dirty&2&&t(5,i=new Map(c.recipients.map(L=>[L.id,L]))),s.$$.dirty&4&&h(u.javascript)},[f,c,u,g,n,i,l,r,p,k,M,w,y,b,$,z,N]}class Ur extends me{constructor(e){super(),de(this,e,Hr,Or,ce,{store:0,message:1,form:2})}}function cs(s,e,t){const l=s.slice();return l[7]=e[t],l}function ms(s){let e,t=s[7]+"",l,n;return{c(){e=v("option"),l=B(t),e.__value=n=s[7],we(e,e.__value)},m(i,r){C(i,e,r),_(e,l)},p(i,r){r&8&&t!==(t=i[7]+"")&&F(l,t),r&8&&n!==(n=i[7])&&(e.__value=n,we(e,e.__value))},d(i){i&&D(e)}}}function Gr(s){let e,t,l,n=s[1].strings.messagesperpage+"",i,r,a,o,f,c,u=fe(s[3]),d=[];for(let g=0;g<u.length;g+=1)d[g]=ms(cs(s,u,g));return{c(){e=v("div"),t=v("div"),l=v("label"),i=B(n),r=B(":"),a=T(),o=v("select");for(let g=0;g<d.length;g+=1)d[g].c();m(l,"for","local-mail-perpage-select"),m(o,"id","local-mail-perpage-select"),m(o,"class","custom-select"),s[2]===void 0&&Le(()=>s[4].call(o)),m(t,"class","form-group"),m(e,"class","form-inline justify-content-end mt-3")},m(g,h){C(g,e,h),_(e,t),_(t,l),_(l,i),_(l,r),_(t,a),_(t,o);for(let p=0;p<d.length;p+=1)d[p]&&d[p].m(o,null);We(o,s[2],!0),f||(c=[O(o,"change",s[4]),O(o,"change",s[5])],f=!0)},p(g,[h]){if(h&2&&n!==(n=g[1].strings.messagesperpage+"")&&F(i,n),h&8){u=fe(g[3]);let p;for(p=0;p<u.length;p+=1){const k=cs(g,u,p);d[p]?d[p].p(k,h):(d[p]=ms(k),d[p].c(),d[p].m(o,null))}for(;p<d.length;p+=1)d[p].d(1);d.length=u.length}h&12&&We(o,g[2])},i:U,o:U,d(g){g&&D(e),Ie(d,g),f=!1,ve(c)}}}function Vr(s,e,t){let l,n,i=U,r=()=>(i(),i=_e(a,d=>t(1,n=d)),a);s.$$.on_destroy.push(()=>i());let{store:a}=e;r();const o=[5,10,20,50,100];let f=n.preferences.perpage;function c(){f=it(this),t(2,f),t(3,l),t(1,n)}const u=()=>a.savePreferences({perpage:f});return s.$$set=d=>{"store"in d&&r(t(0,a=d.store))},s.$$.update=()=>{s.$$.dirty&2&&t(3,l=o.includes(n.preferences.perpage)?o:o.concat([n.preferences.perpage]).sort((d,g)=>d-g))},[a,n,f,l,c,u]}class Kr extends me{constructor(e){super(),de(this,e,Vr,Gr,ce,{store:0})}}function ds(s,e,t){const l=s.slice();return l[9]=e[t],l}function _s(s){let e,t,l=s[4].strings.locked+"",n,i;return{c(){e=v("span"),t=B("("),n=B(l),i=B(")"),m(e,"class","ml-1")},m(r,a){C(r,e,a),_(e,t),_(e,n),_(e,i)},p(r,a){a&16&&l!==(l=r[4].strings.locked+"")&&F(n,l)},d(r){r&&D(e)}}}function gs(s){let e,t,l,n,i,r,a,o=s[9].displayname+"",f,c,u,d,g;function h(){return s[8](s[9])}let p=s[9].locked&&_s(s);return{c(){e=v("div"),t=v("input"),r=T(),a=v("label"),f=B(o),c=T(),p&&p.c(),m(t,"id",l="local-mail-preferences-messageprocessor-"+s[9].name),m(t,"class","custom-control-input"),m(t,"type","checkbox"),t.checked=n=s[9].locked?s[9].enabled:s[3].includes(s[9].name),t.disabled=i=s[9].locked,m(a,"for",u="local-mail-preferences-messageprocessor-"+s[9].name),m(a,"class","custom-control-label pl-1"),m(e,"class","custom-control custom-switch my-2")},m(k,M){C(k,e,M),_(e,t),_(e,r),_(e,a),_(a,f),_(a,c),p&&p.m(a,null),d||(g=O(t,"click",h),d=!0)},p(k,M){s=k,M&16&&l!==(l="local-mail-preferences-messageprocessor-"+s[9].name)&&m(t,"id",l),M&24&&n!==(n=s[9].locked?s[9].enabled:s[3].includes(s[9].name))&&(t.checked=n),M&16&&i!==(i=s[9].locked)&&(t.disabled=i),M&16&&o!==(o=s[9].displayname+"")&&F(f,o),s[9].locked?p?p.p(s,M):(p=_s(s),p.c(),p.m(a,null)):p&&(p.d(1),p=null),M&16&&u!==(u="local-mail-preferences-messageprocessor-"+s[9].name)&&m(a,"for",u)},d(k){k&&D(e),p&&p.d(),d=!1,g()}}}function Yr(s){let e,t=s[4].strings.notifications+"",l,n,i,r,a,o,f,c,u,d=s[4].strings.markmessageasread+"",g,h,p,k=fe(s[4].settings.messageprocessors),M=[];for(let w=0;w<k.length;w+=1)M[w]=gs(ds(s,k,w));return{c(){e=v("h6"),l=B(t),n=T();for(let w=0;w<M.length;w+=1)M[w].c();i=T(),r=v("div"),a=v("input"),c=T(),u=v("label"),g=B(d),m(e,"class","mb-3"),m(a,"id","local-mail-preferences-markasread"),m(a,"class","custom-control-input"),m(a,"type","checkbox"),a.checked=o=s[2]&&s[3].length>0,a.disabled=f=s[3].length==0,m(u,"for","local-mail-preferences-markasread"),m(u,"class","custom-control-label pl-1"),m(r,"class","custom-control custom-switch my-2 mt-3")},m(w,y){C(w,e,y),_(e,l),C(w,n,y);for(let b=0;b<M.length;b+=1)M[b]&&M[b].m(w,y);C(w,i,y),C(w,r,y),_(r,a),_(r,c),_(r,u),_(u,g),h||(p=O(a,"click",s[6]),h=!0)},p(w,y){if(y&16&&t!==(t=w[4].strings.notifications+"")&&F(l,t),y&152){k=fe(w[4].settings.messageprocessors);let b;for(b=0;b<k.length;b+=1){const $=ds(w,k,b);M[b]?M[b].p($,y):(M[b]=gs($),M[b].c(),M[b].m(i.parentNode,i))}for(;b<M.length;b+=1)M[b].d(1);M.length=k.length}y&12&&o!==(o=w[2]&&w[3].length>0)&&(a.checked=o),y&8&&f!==(f=w[3].length==0)&&(a.disabled=f),y&16&&d!==(d=w[4].strings.markmessageasread+"")&&F(g,d)},d(w){w&&(D(e),D(n),D(i),D(r)),Ie(M,w),h=!1,p()}}}function Jr(s){let e,t;return e=new Ue({props:{title:s[4].strings.preferences,confirmText:s[4].strings.save,cancelText:s[4].strings.cancel,onConfirm:s[5],onCancel:s[1],$$slots:{default:[Yr]},$$scope:{ctx:s}}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,[n]){const i={};n&16&&(i.title=l[4].strings.preferences),n&16&&(i.confirmText=l[4].strings.save),n&16&&(i.cancelText=l[4].strings.cancel),n&2&&(i.onCancel=l[1]),n&4124&&(i.$$scope={dirty:n,ctx:l}),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function Wr(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,h=>t(4,l=h)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{onCancel:a}=e,o=l.preferences.markasread,f=l.settings.messageprocessors.map(h=>h.name).filter(h=>l.preferences.notifications.includes(h));const c=()=>{a(),r.savePreferences({markasread:o,notifications:f})},u=()=>{t(2,o=!o)},d=h=>{t(3,f=f.includes(h)?f.filter(p=>p!=h):[...f,h])},g=h=>d(h.name);return s.$$set=h=>{"store"in h&&i(t(0,r=h.store)),"onCancel"in h&&t(1,a=h.onCancel)},[r,a,o,f,l,c,u,d,g]}class Xr extends me{constructor(e){super(),de(this,e,Wr,Jr,ce,{store:0,onCancel:1})}}function Qr(s){let e,t,l,n=s[9].strings.from+"",i,r,a,o,f,c,u,d=s[9].strings.to+"",g,h,p,k,M,w,y,b=s[9].strings.filterbydate+"",$,z,N,L,q,H,Y,V,ee,I,K=s[9].strings.searchbyunread+"",te,oe,E,J,le,A,P=s[9].strings.searchbyattach+"",ie,R,se,pe,x,Z,ne;return{c(){e=v("div"),t=v("div"),l=v("label"),i=B(n),r=T(),a=v("div"),o=v("input"),f=T(),c=v("div"),u=v("label"),g=B(d),h=T(),p=v("div"),k=v("input"),M=T(),w=v("div"),y=v("label"),$=B(b),z=T(),N=v("div"),L=v("input"),q=T(),H=v("div"),Y=v("div"),V=v("input"),ee=T(),I=v("label"),te=B(K),oe=T(),E=v("div"),J=v("input"),le=T(),A=v("label"),ie=B(P),R=T(),se=v("input"),m(l,"for","local-mail-search-input-sendername"),m(l,"class","col-3 col-form-label"),m(o,"type","text"),m(o,"class","form-control"),m(o,"id","local-mail-search-input-sendername"),m(a,"class","col-9"),m(t,"class","form-group row"),m(u,"for","local-mail-search-input-recipientname"),m(u,"class","col-3 col-form-label"),m(k,"type","text"),m(k,"class","form-control"),m(k,"id","local-mail-search-input-recipientname"),m(p,"class","col-9"),m(c,"class","form-group row"),m(y,"for","local-mail-search-input-maxdate"),m(y,"class","col-3 col-form-label"),m(L,"type","date"),m(L,"class","form-control"),m(L,"id","local-mail-search-input-maxdate"),m(L,"max",s[10]),L.value=s[8],m(N,"class","col-9"),m(w,"class","form-group row"),m(V,"class","form-check-input"),m(V,"type","checkbox"),m(V,"id","local-mail-search-input-unread"),m(I,"class","form-check-label"),m(I,"for","local-mail-search-input-unread"),m(Y,"class","form-check"),m(J,"class","form-check-input"),m(J,"type","checkbox"),m(J,"id","local-mail-search-input-withfilesonly"),m(A,"class","form-check-label"),m(A,"for","local-mail-search-input-withfilesonly"),m(E,"class","form-check"),m(se,"type","submit"),se.disabled=pe=!s[6],m(se,"class","btn btn-primary px-3 ml-auto"),se.value=x=s[9].strings.search,m(H,"class","d-flex flex-wrap align-items-center"),ue(H,"column-gap","2rem"),ue(H,"row-gap","1rem"),m(e,"class","dropdown-menu dropdown-menu-left show p-3 w-100"),ue(e,"min-width","18rem")},m(he,ke){C(he,e,ke),_(e,t),_(t,l),_(l,i),_(t,r),_(t,a),_(a,o),we(o,s[0]),s[15](o),_(e,f),_(e,c),_(c,u),_(u,g),_(c,h),_(c,p),_(p,k),we(k,s[1]),_(e,M),_(e,w),_(w,y),_(y,$),_(w,z),_(w,N),_(N,L),_(e,q),_(e,H),_(H,Y),_(Y,V),V.checked=s[2],_(Y,ee),_(Y,I),_(I,te),_(H,oe),_(H,E),_(E,J),J.checked=s[3],_(E,le),_(E,A),_(A,ie),_(H,R),_(H,se),Z||(ne=[O(o,"input",s[14]),O(k,"input",s[16]),O(L,"input",s[11]),O(V,"change",s[17]),O(J,"change",s[18]),O(se,"click",Se(function(){Me(s[5])&&s[5].apply(this,arguments)}))],Z=!0)},p(he,[ke]){s=he,ke&512&&n!==(n=s[9].strings.from+"")&&F(i,n),ke&1&&o.value!==s[0]&&we(o,s[0]),ke&512&&d!==(d=s[9].strings.to+"")&&F(g,d),ke&2&&k.value!==s[1]&&we(k,s[1]),ke&512&&b!==(b=s[9].strings.filterbydate+"")&&F($,b),ke&256&&(L.value=s[8]),ke&4&&(V.checked=s[2]),ke&512&&K!==(K=s[9].strings.searchbyunread+"")&&F(te,K),ke&8&&(J.checked=s[3]),ke&512&&P!==(P=s[9].strings.searchbyattach+"")&&F(ie,P),ke&64&&pe!==(pe=!s[6])&&(se.disabled=pe),ke&512&&x!==(x=s[9].strings.search)&&(se.value=x)},i:U,o:U,d(he){he&&D(e),s[15](null),Z=!1,ve(ne)}}}function Zr(s,e,t){let l,n,i=U,r=()=>(i(),i=_e(a,L=>t(9,n=L)),a);s.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{sendername:o=""}=e,{recipientname:f=""}=e,{unread:c=!1}=e,{withfilesonly:u=!1}=e,{maxtime:d=0}=e,{submit:g}=e,{submitEnabled:h}=e;function p(){k.focus()}let k,M=jt(Math.floor(new Date().getTime()/1e3));const w=L=>{t(12,d=Kn(L.target.value))};function y(){o=this.value,t(0,o)}function b(L){Ce[L?"unshift":"push"](()=>{k=L,t(7,k)})}function $(){f=this.value,t(1,f)}function z(){c=this.checked,t(2,c)}function N(){u=this.checked,t(3,u)}return s.$$set=L=>{"store"in L&&r(t(4,a=L.store)),"sendername"in L&&t(0,o=L.sendername),"recipientname"in L&&t(1,f=L.recipientname),"unread"in L&&t(2,c=L.unread),"withfilesonly"in L&&t(3,u=L.withfilesonly),"maxtime"in L&&t(12,d=L.maxtime),"submit"in L&&t(5,g=L.submit),"submitEnabled"in L&&t(6,h=L.submitEnabled)},s.$$.update=()=>{s.$$.dirty&4096&&t(8,l=jt(d))},[o,f,c,u,a,g,h,k,l,n,M,w,d,p,y,b,$,z,N]}class xr extends me{constructor(e){super(),de(this,e,Zr,Qr,ce,{store:4,sendername:0,recipientname:1,unread:2,withfilesonly:3,maxtime:12,submit:5,submitEnabled:6,focus:13})}get focus(){return this.$$.ctx[13]}}const{Boolean:ea}=Ze;function ps(s,e,t){const l=s.slice();return l[14]=e[t],l[16]=t,l}function bs(s){let e,t,l,n=fe(s[4]),i=[];for(let c=0;c<n.length;c+=1)i[c]=hs(ps(s,n,c));const r=c=>j(i[c],1,1,()=>{i[c]=null});function a(c,u){if(c[5])return sa;if(!c[4].length)return la}let o=a(s),f=o&&o(s);return{c(){e=v("div");for(let c=0;c<i.length;c+=1)i[c].c();t=T(),f&&f.c(),m(e,"class","dropdown-menu dropdown-menu-left overflow-hidden show p-0 w-100"),ue(e,"min-width","18rem")},m(c,u){C(c,e,u);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(e,null);_(e,t),f&&f.m(e,null),l=!0},p(c,u){if(u&401){n=fe(c[4]);let d;for(d=0;d<n.length;d+=1){const g=ps(c,n,d);i[d]?(i[d].p(g,u),S(i[d],1)):(i[d]=hs(g),i[d].c(),S(i[d],1),i[d].m(e,t))}for(re(),d=n.length;d<i.length;d+=1)r(d);ae()}o===(o=a(c))&&f?f.p(c,u):(f&&f.d(1),f=o&&o(c),f&&(f.c(),f.m(e,null)))},i(c){if(!l){for(let u=0;u<n.length;u+=1)S(i[u]);l=!0}},o(c){i=i.filter(ea);for(let u=0;u<i.length;u+=1)j(i[u]);l=!1},d(c){c&&D(e),Ie(i,c),f&&f.d()}}}function ta(s){let e;return{c(){e=v("div"),m(e,"class","dropdown-divider my-0")},m(t,l){C(t,e,l)},d(t){t&&D(e)}}}function hs(s){let e,t,l,n,i,r,a,o,f=s[14].shorttime+"",c,u,d,g,h,p,k=s[16]>0&&ta();return l=new ut({props:{store:s[0],message:s[14]}}),r=new ft({props:{store:s[0],message:s[14]}}),{c(){k&&k.c(),e=T(),t=v("a"),W(l.$$.fragment),n=T(),i=v("div"),W(r.$$.fragment),a=T(),o=v("div"),c=B(f),m(o,"title",u=s[14].fulltime),m(o,"class","ml-auto"),m(i,"class","local-mail-incremental-search-muted d-flex svelte-sdeam0"),m(t,"class","dropdown-item local-mail-incremental-search-item"),m(t,"href",d=Fe(s[7](s[14],s[16]))),G(t,"font-weight-bold",s[14].unread)},m(M,w){k&&k.m(M,w),C(M,e,w),C(M,t,w),X(l,t,null),_(t,n),_(t,i),X(r,i,null),_(i,a),_(i,o),_(o,c),g=!0,h||(p=O(t,"click",function(){Me(s[8](s[14],s[16]))&&s[8](s[14],s[16]).apply(this,arguments)}),h=!0)},p(M,w){s=M;const y={};w&1&&(y.store=s[0]),w&16&&(y.message=s[14]),l.$set(y);const b={};w&1&&(b.store=s[0]),w&16&&(b.message=s[14]),r.$set(b),(!g||w&16)&&f!==(f=s[14].shorttime+"")&&F(c,f),(!g||w&16&&u!==(u=s[14].fulltime))&&m(o,"title",u),(!g||w&144&&d!==(d=Fe(s[7](s[14],s[16]))))&&m(t,"href",d),(!g||w&16)&&G(t,"font-weight-bold",s[14].unread)},i(M){g||(S(l.$$.fragment,M),S(r.$$.fragment,M),g=!0)},o(M){j(l.$$.fragment,M),j(r.$$.fragment,M),g=!1},d(M){M&&(D(e),D(t)),k&&k.d(M),Q(l),Q(r),h=!1,p()}}}function la(s){let e,t=s[3].strings.nomessagesfound+"",l;return{c(){e=v("div"),l=B(t),m(e,"class","px-4 py-2 text-danger")},m(n,i){C(n,e,i),_(e,l)},p(n,i){i&8&&t!==(t=n[3].strings.nomessagesfound+"")&&F(l,t)},d(n){n&&D(e)}}}function sa(s){let e,t,l,n=s[3].strings.searchallmessages+"",i,r,a,o;return{c(){e=v("div"),t=T(),l=v("a"),i=B(n),m(e,"class","dropdown-divider my-0"),m(l,"class","dropdown-item py-2"),m(l,"href",r=Fe(s[6]))},m(f,c){C(f,e,c),C(f,t,c),C(f,l,c),_(l,i),a||(o=O(l,"click",Se(s[12])),a=!0)},p(f,c){c&8&&n!==(n=f[3].strings.searchallmessages+"")&&F(i,n),c&64&&r!==(r=Fe(f[6]))&&m(l,"href",r)},d(f){f&&(D(e),D(t),D(l)),a=!1,o()}}}function na(s){let e,t,l=s[1]&&s[4]!=null&&bs(s);return{c(){l&&l.c(),e=be()},m(n,i){l&&l.m(n,i),C(n,e,i),t=!0},p(n,[i]){n[1]&&n[4]!=null?l?(l.p(n,i),i&18&&S(l,1)):(l=bs(n),l.c(),S(l,1),l.m(e.parentNode,e)):l&&(re(),j(l,1,1,()=>{l=null}),ae())},i(n){t||(S(l),t=!0)},o(n){j(l),t=!1},d(n){n&&D(e),l&&l.d(n)}}}const nt=10,ia=500;function ra(s,e,t){let l,n,i,r=U,a=()=>(r(),r=_e(o,y=>t(3,i=y)),o);s.$$.on_destroy.push(()=>r());let{store:o}=e;a();let{enabled:f}=e,{content:c}=e,{loading:u=!1}=e,{onClick:d}=e,g,h,p=!1;const k=async y=>{t(9,u=!0),window.clearTimeout(g),t(11,g=window.setTimeout(async()=>{const b=i.params,z={methodname:"search_messages",query:{courseid:b.courseid,labelid:b.tray=="label"?b.labelid:void 0,draft:b.tray=="drafts"?!0:b.tray=="sent"?!1:void 0,roles:b.tray=="inbox"?Object.values(ze):b.tray=="sent"?["from"]:void 0,starred:b.tray=="starred"?!0:void 0,deleted:b.tray=="trash",content:y.trim(),stopid:i.incrementalSearchStopId},limit:nt+1};let N;try{N=await Je([z])}catch(L){o.setError(L),t(9,u=!1),t(4,h=void 0);return}t(9,u=!1),t(4,h=N[0]),t(5,p=h.length>nt||!!i.incrementalSearchStopId),t(4,h=h.slice(0,nt))},ia))},M=(y,b)=>$=>{y.draft||($.preventDefault(),d(l(y,b)))};rt(()=>{window.clearTimeout(g)});const w=()=>d(n);return s.$$set=y=>{"store"in y&&a(t(0,o=y.store)),"enabled"in y&&t(1,f=y.enabled),"content"in y&&t(10,c=y.content),"loading"in y&&t(9,u=y.loading),"onClick"in y&&t(2,d=y.onClick)},s.$$.update=()=>{s.$$.dirty&3074&&(f?k(c):(t(4,h=void 0),t(9,u=!1),window.clearTimeout(g))),s.$$.dirty&1032&&t(7,l=(y,b)=>({...i.params,messageid:y.id,offset:b,search:{content:c.trim()}})),s.$$.dirty&1032&&t(6,n={...i.params,messageid:void 0,offset:0,search:{content:c.trim()}})},[o,f,d,i,h,p,n,l,M,u,c,g,w]}class aa extends me{constructor(e){super(),de(this,e,ra,na,ce,{store:0,enabled:1,content:10,loading:9,onClick:2})}}function vs(s,e,t){const l=s.slice();return l[35]=e[t].label,l[36]=e[t].value,l[38]=t,l}function oa(s){let e,t,l,n=fe(s[15]),i=[];for(let r=0;r<n.length;r+=1)i[r]=ws(vs(s,n,r));return{c(){e=v("button");for(let r=0;r<i.length;r+=1)i[r].c();m(e,"type","button"),m(e,"class","alert-primary form-control text-left text-truncate"),ue(e,"padding-left","2.5rem"),ue(e,"padding-right","5rem")},m(r,a){C(r,e,a);for(let o=0;o<i.length;o+=1)i[o]&&i[o].m(e,null);t||(l=O(e,"click",s[16]),t=!0)},p(r,a){if(a[0]&32768){n=fe(r[15]);let o;for(o=0;o<n.length;o+=1){const f=vs(r,n,o);i[o]?i[o].p(f,a):(i[o]=ws(f),i[o].c(),i[o].m(e,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=n.length}},d(r){r&&D(e),Ie(i,r),t=!1,l()}}}function fa(s){let e,t,l,n,i;return{c(){e=v("input"),m(e,"type","text"),m(e,"class","form-control"),ue(e,"padding-left","2.5rem"),ue(e,"padding-right","5rem"),m(e,"placeholder",t=s[7].strings.search),m(e,"aria-label",l=s[7].strings.search),m(e,"autocomplete","off")},m(r,a){C(r,e,a),we(e,s[1]),s[26](e),n||(i=[O(e,"input",s[25]),O(e,"keypress",s[21])],n=!0)},p(r,a){a[0]&128&&t!==(t=r[7].strings.search)&&m(e,"placeholder",t),a[0]&128&&l!==(l=r[7].strings.search)&&m(e,"aria-label",l),a[0]&2&&e.value!==r[1]&&we(e,r[1])},d(r){r&&D(e),s[26](null),n=!1,ve(i)}}}function ua(s){let e;return{c(){e=v("span"),e.textContent=", ",m(e,"class","dimmed_text")},m(t,l){C(t,e,l)},d(t){t&&D(e)}}}function ca(s){let e,t=s[36]+"",l,n=s[35]&&ks(s);return{c(){n&&n.c(),e=T(),l=B(t)},m(i,r){n&&n.m(i,r),C(i,e,r),C(i,l,r)},p(i,r){i[35]?n?n.p(i,r):(n=ks(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),r[0]&32768&&t!==(t=i[36]+"")&&F(l,t)},d(i){i&&(D(e),D(l)),n&&n.d(i)}}}function ma(s){let e,t=s[35]+"",l;return{c(){e=v("span"),l=B(t),m(e,"class","dimmed_text")},m(n,i){C(n,e,i),_(e,l)},p(n,i){i[0]&32768&&t!==(t=n[35]+"")&&F(l,t)},d(n){n&&D(e)}}}function ks(s){let e,t=s[35]+"",l,n;return{c(){e=v("span"),l=B(t),n=B(":"),m(e,"class","dimmed_text")},m(i,r){C(i,e,r),_(e,l),_(e,n)},p(i,r){r[0]&32768&&t!==(t=i[35]+"")&&F(l,t)},d(i){i&&D(e)}}}function ws(s){let e,t,l=s[38]>0&&ua();function n(a,o){return a[36]===!0?ma:ca}let i=n(s),r=i(s);return{c(){l&&l.c(),e=T(),r.c(),t=be()},m(a,o){l&&l.m(a,o),C(a,e,o),r.m(a,o),C(a,t,o)},p(a,o){i===(i=n(a))&&r?r.p(a,o):(r.d(1),r=i(a),r&&(r.c(),r.m(t.parentNode,t)))},d(a){a&&(D(e),D(t)),l&&l.d(a),r.d(a)}}}function ys(s){let e,t,l,n,i;return{c(){e=v("button"),t=v("i"),m(t,"class","fa fa-fw fa-times"),m(t,"aria-hidden","true"),m(e,"type","button"),m(e,"class","btn px-0"),m(e,"title",l=s[7].strings.cancel),ue(e,"width","2.5rem")},m(r,a){C(r,e,a),_(e,t),n||(i=O(e,"click",Se(s[19])),n=!0)},p(r,a){a[0]&128&&l!==(l=r[7].strings.cancel)&&m(e,"title",l)},d(r){r&&D(e),n=!1,i()}}}function Ms(s){let e,t,l,n,i,r,a;function o(h){s[28](h)}function f(h){s[29](h)}function c(h){s[30](h)}function u(h){s[31](h)}function d(h){s[32](h)}let g={store:s[0],submit:s[20],submitEnabled:s[13]};return s[2]!==void 0&&(g.sendername=s[2]),s[3]!==void 0&&(g.recipientname=s[3]),s[4]!==void 0&&(g.unread=s[4]),s[5]!==void 0&&(g.withfilesonly=s[5]),s[6]!==void 0&&(g.maxtime=s[6]),e=new xr({props:g}),s[27](e),Ce.push(()=>Ve(e,"sendername",o)),Ce.push(()=>Ve(e,"recipientname",f)),Ce.push(()=>Ve(e,"unread",c)),Ce.push(()=>Ve(e,"withfilesonly",u)),Ce.push(()=>Ve(e,"maxtime",d)),{c(){W(e.$$.fragment)},m(h,p){X(e,h,p),a=!0},p(h,p){const k={};p[0]&1&&(k.store=h[0]),p[0]&8192&&(k.submitEnabled=h[13]),!t&&p[0]&4&&(t=!0,k.sendername=h[2],Ke(()=>t=!1)),!l&&p[0]&8&&(l=!0,k.recipientname=h[3],Ke(()=>l=!1)),!n&&p[0]&16&&(n=!0,k.unread=h[4],Ke(()=>n=!1)),!i&&p[0]&32&&(i=!0,k.withfilesonly=h[5],Ke(()=>i=!1)),!r&&p[0]&64&&(r=!0,k.maxtime=h[6],Ke(()=>r=!1)),e.$set(k)},i(h){a||(S(e.$$.fragment,h),a=!0)},o(h){j(e.$$.fragment,h),a=!1},d(h){s[27](null),Q(e,h)}}}function $s(s){let e,t,l;function n(r){s[33](r)}let i={store:s[0],enabled:s[8]&&!s[9]&&!!s[1].trim(),content:s[1],onClick:s[22]};return s[12]!==void 0&&(i.loading=s[12]),e=new aa({props:i}),Ce.push(()=>Ve(e,"loading",n)),{c(){W(e.$$.fragment)},m(r,a){X(e,r,a),l=!0},p(r,a){const o={};a[0]&1&&(o.store=r[0]),a[0]&770&&(o.enabled=r[8]&&!r[9]&&!!r[1].trim()),a[0]&2&&(o.content=r[1]),!t&&a[0]&4096&&(t=!0,o.loading=r[12],Ke(()=>t=!1)),e.$set(o)},i(r){l||(S(e.$$.fragment,r),l=!0)},o(r){j(e.$$.fragment,r),l=!1},d(r){Q(e,r)}}}function da(s){let e,t,l,n,i,r,a,o,f,c,u,d,g,h,p,k,M;function w(L,q){return L[8]?fa:oa}let y=w(s),b=y(s),$=(s[14]||s[13])&&ys(s),z=s[9]&&Ms(s),N=s[7].settings.incrementalsearch&&$s(s);return{c(){e=v("form"),t=v("div"),l=v("i"),i=T(),b.c(),r=T(),a=v("div"),$&&$.c(),o=T(),f=v("button"),c=v("i"),g=T(),z&&z.c(),h=T(),N&&N.c(),m(l,"class",n="fa fa-fw "+(s[12]?"fa-spinner fa-pulse":"fa-search")),m(l,"aria-hidden","true"),m(t,"class","position-absolute h-100 d-flex justify-content-center align-items-center px-0"),ue(t,"top","0"),ue(t,"left","0"),ue(t,"width","2.5rem"),m(c,"class",u="fa fa-fw "+(s[9]?"fa-caret-up":"fa-sliders")),m(c,"aria-hidden","true"),m(f,"type","button"),m(f,"aria-expanded",s[9]),m(f,"class","btn px-0"),ue(f,"width","2.5rem"),m(f,"title",d=s[7].strings.advsearch),m(a,"class","position-absolute h-100 d-flex align-items-center"),ue(a,"top","0"),ue(a,"right","0"),m(e,"class","local-mail-search-input position-relative svelte-5mr94p")},m(L,q){C(L,e,q),_(e,t),_(t,l),_(e,i),b.m(e,null),_(e,r),_(e,a),$&&$.m(a,null),_(a,o),_(a,f),_(f,c),_(e,g),z&&z.m(e,null),_(e,h),N&&N.m(e,null),p=!0,k||(M=[O(f,"click",Se(s[18])),$e(Pe.call(null,e,s[17]))],k=!0)},p(L,q){(!p||q[0]&4096&&n!==(n="fa fa-fw "+(L[12]?"fa-spinner fa-pulse":"fa-search")))&&m(l,"class",n),y===(y=w(L))&&b?b.p(L,q):(b.d(1),b=y(L),b&&(b.c(),b.m(e,r))),L[14]||L[13]?$?$.p(L,q):($=ys(L),$.c(),$.m(a,o)):$&&($.d(1),$=null),(!p||q[0]&512&&u!==(u="fa fa-fw "+(L[9]?"fa-caret-up":"fa-sliders")))&&m(c,"class",u),(!p||q[0]&512)&&m(f,"aria-expanded",L[9]),(!p||q[0]&128&&d!==(d=L[7].strings.advsearch))&&m(f,"title",d),L[9]?z?(z.p(L,q),q[0]&512&&S(z,1)):(z=Ms(L),z.c(),S(z,1),z.m(e,h)):z&&(re(),j(z,1,1,()=>{z=null}),ae()),L[7].settings.incrementalsearch?N?(N.p(L,q),q[0]&128&&S(N,1)):(N=$s(L),N.c(),S(N,1),N.m(e,null)):N&&(re(),j(N,1,1,()=>{N=null}),ae())},i(L){p||(S(z),S(N),p=!0)},o(L){j(z),j(N),p=!1},d(L){L&&D(e),b.d(),$&&$.d(),z&&z.d(),N&&N.d(),k=!1,ve(M)}}}function _a(s,e,t){let l,n,i,r,a,o,f=U,c=()=>(f(),f=_e(u,R=>t(7,o=R)),u);s.$$.on_destroy.push(()=>f());let{store:u}=e;c();let d=!o.params.search,g=!1,h,p,k="",M="",w="",y=!1,b=!1,$=0,z=!1;const N=R=>{t(1,k=(R==null?void 0:R.content)||""),t(2,M=(R==null?void 0:R.sendername)||""),t(3,w=(R==null?void 0:R.recipientname)||""),t(4,y=(R==null?void 0:R.unread)||!1),t(5,b=(R==null?void 0:R.withfilesonly)||!1),t(6,$=(R==null?void 0:R.maxtime)||0)},L=async()=>{t(8,d=!0),n&&t(9,g=!0),await Ye(),h.focus()},q=async()=>{t(8,d=!i),t(9,g=!1),N(l)},H=async()=>{g?(t(9,g=!1),await Ye(),h.focus()):(t(9,g=!0),L(),await Ye(),p.focus())},Y=async()=>{t(8,d=!0),t(9,g=!1),N(),await u.navigate({...o.params,offset:void 0,search:void 0}),await Ye(),h.focus()},V=async()=>{await u.navigate({...o.params,messageid:void 0,offset:void 0,search:g?{content:k.trim(),sendername:M.trim(),recipientname:w.trim(),unread:y,withfilesonly:b,maxtime:$}:{content:k.trim()}}),t(9,g=!1),t(8,d=!1)},ee=R=>{R.key=="Enter"&&(R.preventDefault(),r?V():Y())},I=async R=>{await u.navigate(R),t(9,g=!1),t(8,d=!1)};function K(){k=this.value,t(1,k)}function te(R){Ce[R?"unshift":"push"](()=>{h=R,t(10,h)})}function oe(R){Ce[R?"unshift":"push"](()=>{p=R,t(11,p)})}function E(R){M=R,t(2,M)}function J(R){w=R,t(3,w)}function le(R){y=R,t(4,y)}function A(R){b=R,t(5,b)}function P(R){$=R,t(6,$)}function ie(R){z=R,t(12,z)}return s.$$set=R=>{"store"in R&&c(t(0,u=R.store))},s.$$.update=()=>{s.$$.dirty[0]&128&&t(23,l=o.params.search),s.$$.dirty[0]&8388608&&N(l),s.$$.dirty[0]&8388608&&t(24,n=!!(l!=null&&l.sendername||l!=null&&l.recipientname||l!=null&&l.unread||l!=null&&l.withfilesonly||l!=null&&l.maxtime)),s.$$.dirty[0]&25165824&&t(14,i=(l==null?void 0:l.content)||n),s.$$.dirty[0]&126&&t(13,r=!!(k.trim()||M.trim()||w.trim()||y||b||$)),s.$$.dirty[0]&254&&t(15,a=[{label:"",value:k},{label:o.strings.from,value:M},{label:o.strings.to,value:w},{label:o.strings.filterbydate,value:$>0?new Date($*1e3).toLocaleDateString():""},{label:o.strings.searchbyunread,value:y},{label:o.strings.searchbyattach,value:b}].filter(({value:R})=>!!R))},[u,k,M,w,y,b,$,o,d,g,h,p,z,r,i,a,L,q,H,Y,V,ee,I,l,n,K,te,oe,E,J,le,A,P,ie]}class ga extends me{constructor(e){super(),de(this,e,_a,da,ce,{store:0},null,[-1,-1])}}function Cs(s,e,t){const l=s.slice();return l[4]=e[t],l}function Ds(s){let e,t=s[1].strings.undo+"",l,n,i;function r(){return s[2](s[4])}return{c(){e=v("button"),l=B(t),m(e,"type","button"),m(e,"class","local-mail-toast-undo btn font-weight-bold px-2 py-0 ml-3 svelte-kxpqnp")},m(a,o){C(a,e,o),_(e,l),n||(i=O(e,"click",r),n=!0)},p(a,o){s=a,o&2&&t!==(t=s[1].strings.undo+"")&&F(l,t)},d(a){a&&D(e),n=!1,i()}}}function Ss(s,e){let t,l,n,i=e[4].text+"",r,a,o,f,c,u,d,g,h,p,k=U,M,w,y,b=e[4].undo&&Ds(e);function $(){return e[3](e[4])}return{key:s,first:null,c(){t=v("div"),l=v("div"),n=v("div"),r=B(i),a=T(),b&&b.c(),o=T(),f=v("button"),c=v("i"),d=T(),m(n,"class","px-1 mr-auto"),m(c,"class","fa fa-times"),m(f,"type","button"),m(f,"class","btn px-2 py-0 ml-2 text-white-50"),m(f,"title",u=e[1].strings.close),m(l,"class","toast-body d-flex align-items-center p-2"),m(t,"class","toast mt-2 mb-0"),m(t,"role","alert"),m(t,"aria-live","assertive"),m(t,"aria-atomic","true"),m(t,"data-autohide","false"),this.first=t},m(z,N){C(z,t,N),_(t,l),_(l,n),_(n,r),_(l,a),b&&b.m(l,null),_(l,o),_(l,f),_(f,c),_(t,d),M=!0,w||(y=O(f,"click",$),w=!0)},p(z,N){e=z,(!M||N&2)&&i!==(i=e[4].text+"")&&F(r,i),e[4].undo?b?b.p(e,N):(b=Ds(e),b.c(),b.m(l,o)):b&&(b.d(1),b=null),(!M||N&2&&u!==(u=e[1].strings.close))&&m(f,"title",u)},r(){p=t.getBoundingClientRect()},f(){Xs(t),k(),ot(t,p)},a(){k(),k=Ws(t,p,rn,{})},i(z){M||(Le(()=>{M&&(h&&h.end(1),g=at(t,tt,{y:50,delay:200}),g.start())}),M=!0)},o(z){g&&g.invalidate(),h=Vs(t,tt,{y:50,duration:400}),M=!1},d(z){z&&D(t),b&&b.d(),z&&h&&h.end(),w=!1,y()}}}function pa(s){let e,t=[],l=new Map,n,i=fe(s[1].toasts);const r=a=>a[4];for(let a=0;a<i.length;a+=1){let o=Cs(s,i,a),f=r(o);l.set(f,t[a]=Ss(f,o))}return{c(){e=v("div");for(let a=0;a<t.length;a+=1)t[a].c();m(e,"aria-live","polite"),m(e,"aria-atomic","true"),m(e,"class","local-mail-toasts position-fixed d-flex flex-column-reverse p-3 svelte-kxpqnp")},m(a,o){C(a,e,o);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(a,[o]){if(o&3){i=fe(a[1].toasts),re();for(let f=0;f<t.length;f+=1)t[f].r();t=De(t,o,r,1,a,i,l,e,Gs,Ss,null,Cs);for(let f=0;f<t.length;f+=1)t[f].a();ae()}},i(a){if(!n){for(let o=0;o<i.length;o+=1)S(t[o]);n=!0}},o(a){for(let o=0;o<t.length;o+=1)j(t[o]);n=!1},d(a){a&&D(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function ba(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,f=>t(1,l=f)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=f=>r.undo(f),o=f=>r.hideToast(f);return s.$$set=f=>{"store"in f&&i(t(0,r=f.store))},[r,l,a,o]}class ha extends me{constructor(e){super(),de(this,e,ba,pa,ce,{store:0})}}function va(s){let e,t,l,n,i;return{c(){e=v("button"),t=v("i"),m(t,"class","fa fa fa-fw fa-arrow-left"),m(e,"type","button"),m(e,"class","local-mail-back-button btn btn-secondary svelte-h5ths1"),m(e,"title",l=s[1].strings.messagelist)},m(r,a){C(r,e,a),_(e,t),n||(i=O(e,"click",s[2]),n=!0)},p(r,[a]){a&2&&l!==(l=r[1].strings.messagelist)&&m(e,"title",l)},i:U,o:U,d(r){r&&D(e),n=!1,i()}}}function ka(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,o=>t(1,l=o)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=()=>r.navigateToList();return s.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,l,a]}class wa extends me{constructor(e){super(),de(this,e,ka,va,ce,{store:0})}}function Ts(s){let e,t,l=s[1].strings.all+"",n,i,r,a=s[1].strings.none+"",o,f,c,u=s[1].strings.read+"",d,g,h,p=s[1].strings.unread+"",k,M,w,y=s[1].strings.starred+"",b,$,z,N=s[1].strings.unstarred+"",L,q,H;return{c(){e=v("div"),t=v("button"),n=B(l),i=T(),r=v("button"),o=B(a),f=T(),c=v("button"),d=B(u),g=T(),h=v("button"),k=B(p),M=T(),w=v("button"),b=B(y),$=T(),z=v("button"),L=B(N),m(t,"type","button"),m(t,"class","dropdown-item"),m(r,"type","button"),m(r,"class","dropdown-item"),m(c,"type","button"),m(c,"class","dropdown-item"),m(h,"type","button"),m(h,"class","dropdown-item"),m(w,"type","button"),m(w,"class","dropdown-item"),m(z,"type","button"),m(z,"class","dropdown-item"),m(e,"class","dropdown-menu show")},m(Y,V){C(Y,e,V),_(e,t),_(t,n),_(e,i),_(e,r),_(r,o),_(e,f),_(e,c),_(c,d),_(e,g),_(e,h),_(h,k),_(e,M),_(e,w),_(w,b),_(e,$),_(e,z),_(z,L),q||(H=[O(t,"click",s[7]),O(r,"click",s[8]),O(c,"click",s[9]),O(h,"click",s[10]),O(w,"click",s[11]),O(z,"click",s[12])],q=!0)},p(Y,V){V&2&&l!==(l=Y[1].strings.all+"")&&F(n,l),V&2&&a!==(a=Y[1].strings.none+"")&&F(o,a),V&2&&u!==(u=Y[1].strings.read+"")&&F(d,u),V&2&&p!==(p=Y[1].strings.unread+"")&&F(k,p),V&2&&y!==(y=Y[1].strings.starred+"")&&F(b,y),V&2&&N!==(N=Y[1].strings.unstarred+"")&&F(L,N)},d(Y){Y&&D(e),q=!1,ve(H)}}}function ya(s){let e,t,l,n,i,r,a,o,f=s[2]&&Ts(s);return{c(){e=v("div"),t=v("button"),l=v("i"),r=T(),f&&f.c(),m(l,"class",n="fa fa-fw "+s[3]),m(t,"class","btn btn-secondary dropdown-toggle"),m(t,"aria-expanded",s[2]),m(t,"title",i=s[1].strings.select),m(e,"class","btn-group"),m(e,"role","group")},m(c,u){C(c,e,u),_(e,t),_(t,l),_(e,r),f&&f.m(e,null),a||(o=[O(t,"click",s[5]),$e(Pe.call(null,e,s[4]))],a=!0)},p(c,[u]){u&8&&n!==(n="fa fa-fw "+c[3])&&m(l,"class",n),u&4&&m(t,"aria-expanded",c[2]),u&2&&i!==(i=c[1].strings.select)&&m(t,"title",i),c[2]?f?f.p(c,u):(f=Ts(c),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i:U,o:U,d(c){c&&D(e),f&&f.d(),a=!1,ve(o)}}}function Ma(s,e,t){let l,n,i=U,r=()=>(i(),i=_e(a,w=>t(1,n=w)),a);s.$$.on_destroy.push(()=>i());let{store:a}=e;r();let o=!1;const f=()=>{t(2,o=!1)},c=()=>{t(2,o=!o)},u=w=>{f(),a.selectAll(w)},d=()=>u("all"),g=()=>u("none"),h=()=>u("read"),p=()=>u("unread"),k=()=>u("starred"),M=()=>u("unstarred");return s.$$set=w=>{"store"in w&&r(t(0,a=w.store))},s.$$.update=()=>{s.$$.dirty&2&&t(3,l=n.selectedMessages.size==0?"fa-square-o":n.selectedMessages.size<n.listMessages.length?"fa-minus-square-o":"fa-check-square-o")},[a,n,o,l,f,c,u,d,g,h,p,k,M]}class $a extends me{constructor(e){super(),de(this,e,Ma,ya,ce,{store:0})}}function Ca(s){let e,t;return e=new $a({props:{store:s[0]}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&1&&(i.store=l[0]),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function Da(s){let e,t;return e=new wa({props:{store:s[0]}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&1&&(i.store=l[0]),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function Ls(s){let e,t,l,n,i,r;const a=[Ta,Sa],o=[];function f(c,u){return c[1].params.tray=="trash"?0:1}return t=f(s),l=o[t]=a[t](s),i=new ln({props:{store:s[0]}}),{c(){e=v("div"),l.c(),n=T(),W(i.$$.fragment),m(e,"class","btn-group"),m(e,"role","group")},m(c,u){C(c,e,u),o[t].m(e,null),_(e,n),X(i,e,null),r=!0},p(c,u){let d=t;t=f(c),t===d?o[t].p(c,u):(re(),j(o[d],1,1,()=>{o[d]=null}),ae(),l=o[t],l?l.p(c,u):(l=o[t]=a[t](c),l.c()),S(l,1),l.m(e,n));const g={};u&1&&(g.store=c[0]),i.$set(g)},i(c){r||(S(l),S(i.$$.fragment,c),r=!0)},o(c){j(l),j(i.$$.fragment,c),r=!1},d(c){c&&D(e),o[t].d(),Q(i)}}}function Sa(s){let e,t,l,n;return e=new tn({props:{store:s[0]}}),l=new Zs({props:{store:s[0]}}),{c(){W(e.$$.fragment),t=T(),W(l.$$.fragment)},m(i,r){X(e,i,r),C(i,t,r),X(l,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),l.$set(o)},i(i){n||(S(e.$$.fragment,i),S(l.$$.fragment,i),n=!0)},o(i){j(e.$$.fragment,i),j(l.$$.fragment,i),n=!1},d(i){i&&D(t),Q(e,i),Q(l,i)}}}function Ta(s){let e,t,l,n;return e=new nn({props:{store:s[0]}}),l=new xs({props:{store:s[0]}}),{c(){W(e.$$.fragment),t=T(),W(l.$$.fragment)},m(i,r){X(e,i,r),C(i,t,r),X(l,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),l.$set(o)},i(i){n||(S(e.$$.fragment,i),S(l.$$.fragment,i),n=!0)},o(i){j(e.$$.fragment,i),j(l.$$.fragment,i),n=!1},d(i){i&&D(t),Q(e,i),Q(l,i)}}}function zs(s){let e,t,l;return t=new _n({props:{store:s[0],label:s[1].strings.filterbycourse,selected:s[1].params.courseid,readonly:s[1].params.tray=="course",onChange:s[2],primary:!0,align:s[1].viewportSize>=ge.MD?"left":"right"}}),{c(){e=v("div"),W(t.$$.fragment),m(e,"class","d-flex flex-grow-1 ml-auto mr-0 ml-md-0 mr-md-auto"),ue(e,"max-width","20rem"),ue(e,"min-width","0")},m(n,i){C(n,e,i),X(t,e,null),l=!0},p(n,i){const r={};i&1&&(r.store=n[0]),i&2&&(r.label=n[1].strings.filterbycourse),i&2&&(r.selected=n[1].params.courseid),i&2&&(r.readonly=n[1].params.tray=="course"),i&1&&(r.onChange=n[2]),i&2&&(r.align=n[1].viewportSize>=ge.MD?"left":"right"),t.$set(r)},i(n){l||(S(t.$$.fragment,n),l=!0)},o(n){j(t.$$.fragment,n),l=!1},d(n){n&&D(e),Q(t)}}}function La(s){let e,t;return e=new gn({props:{store:s[0]}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&1&&(i.store=l[0]),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function za(s){let e,t;return e=new sn({props:{store:s[0]}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&1&&(i.store=l[0]),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function ja(s){var y;let e,t,l,n,i,r=!((y=s[1].message)!=null&&y.draft)&&["shortname","fullname"].includes(s[1].settings.filterbycourse),a,o,f,c;const u=[Da,Ca],d=[];function g(b,$){return b[1].message?0:1}t=g(s),l=d[t]=u[t](s);let h=s[1].viewportSize>=ge.MD&&Ls(s),p=r&&zs(s);const k=[za,La],M=[];function w(b,$){var z;return b[1].viewportSize>=ge.MD?0:(z=b[1].message)!=null&&z.draft?1:-1}return~(o=w(s))&&(f=M[o]=k[o](s)),{c(){e=v("div"),l.c(),n=T(),h&&h.c(),i=T(),p&&p.c(),a=T(),f&&f.c(),m(e,"role","toolbar"),m(e,"class","local-mail-toolbar d-flex w-100 svelte-kqp7rd")},m(b,$){C(b,e,$),d[t].m(e,null),_(e,n),h&&h.m(e,null),_(e,i),p&&p.m(e,null),_(e,a),~o&&M[o].m(e,null),c=!0},p(b,[$]){var L;let z=t;t=g(b),t===z?d[t].p(b,$):(re(),j(d[z],1,1,()=>{d[z]=null}),ae(),l=d[t],l?l.p(b,$):(l=d[t]=u[t](b),l.c()),S(l,1),l.m(e,n)),b[1].viewportSize>=ge.MD?h?(h.p(b,$),$&2&&S(h,1)):(h=Ls(b),h.c(),S(h,1),h.m(e,i)):h&&(re(),j(h,1,1,()=>{h=null}),ae()),$&2&&(r=!((L=b[1].message)!=null&&L.draft)&&["shortname","fullname"].includes(b[1].settings.filterbycourse)),r?p?(p.p(b,$),$&2&&S(p,1)):(p=zs(b),p.c(),S(p,1),p.m(e,a)):p&&(re(),j(p,1,1,()=>{p=null}),ae());let N=o;o=w(b),o===N?~o&&M[o].p(b,$):(f&&(re(),j(M[N],1,1,()=>{M[N]=null}),ae()),~o?(f=M[o],f?f.p(b,$):(f=M[o]=k[o](b),f.c()),S(f,1),f.m(e,null)):f=null)},i(b){c||(S(l),S(h),S(p),S(f),c=!0)},o(b){j(l),j(h),j(p),j(f),c=!1},d(b){b&&D(e),d[t].d(),h&&h.d(),p&&p.d(),~o&&M[o].d()}}}function Na(s,e,t){let l,n=U,i=()=>(n(),n=_e(r,o=>t(1,l=o)),r);s.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=o=>r.selectCourse(o);return s.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,l,a]}class Aa extends me{constructor(e){super(),de(this,e,Na,ja,ce,{store:0})}}const{window:xe}=Ze;function Ba(s){let e,t=s[3].strings.pluginname+"",l,n,i=s[3].viewportSize<ge.LG&&js(s);return{c(){e=v("h1"),l=B(t),n=T(),i&&i.c(),m(e,"class","h2 local-mail-view-side-column text-truncate mb-4 svelte-wfy5os")},m(r,a){C(r,e,a),_(e,l),_(e,n),i&&i.m(e,null)},p(r,a){a&8&&t!==(t=r[3].strings.pluginname+"")&&F(l,t),r[3].viewportSize<ge.LG?i?i.p(r,a):(i=js(r),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(r){r&&D(e),i&&i.d()}}}function qa(s){let e;return{c(){e=v("div"),m(e,"class","local-mail-view-side-column svelte-wfy5os")},m(t,l){C(t,e,l)},p:U,d(t){t&&D(e)}}}function js(s){let e,t,l;return{c(){e=v("i"),t=T(),l=B(s[2]),m(e,"class","fa fa-angle-right mx-1"),m(e,"aria-hidden","true")},m(n,i){C(n,e,i),C(n,t,i),C(n,l,i)},p(n,i){i&4&&F(l,n[2])},d(n){n&&(D(e),D(t),D(l))}}}function Ns(s){let e,t,l;return t=new ga({props:{store:s[0]}}),{c(){e=v("div"),W(t.$$.fragment),m(e,"class","local-mail-view-search svelte-wfy5os")},m(n,i){C(n,e,i),X(t,e,null),l=!0},p(n,i){const r={};i&1&&(r.store=n[0]),t.$set(r)},i(n){l||(S(t.$$.fragment,n),l=!0)},o(n){j(t.$$.fragment,n),l=!1},d(n){n&&D(e),Q(t)}}}function As(s){let e,t,l,n,i;t=new Ys({props:{strings:s[3].strings,iconOnly:s[1]&&s[3].viewportSize<ge.SM,onClick:s[12]}});let r=!s[1]&&Bs(s);return{c(){e=v("div"),W(t.$$.fragment),l=T(),r&&r.c(),n=be(),m(e,"class","text-truncate d-flex")},m(a,o){C(a,e,o),X(t,e,null),C(a,l,o),r&&r.m(a,o),C(a,n,o),i=!0},p(a,o){const f={};o&8&&(f.strings=a[3].strings),o&10&&(f.iconOnly=a[1]&&a[3].viewportSize<ge.SM),o&1&&(f.onClick=a[12]),t.$set(f),a[1]?r&&(re(),j(r,1,1,()=>{r=null}),ae()):r?(r.p(a,o),o&2&&S(r,1)):(r=Bs(a),r.c(),S(r,1),r.m(n.parentNode,n))},i(a){i||(S(t.$$.fragment,a),S(r),i=!0)},o(a){j(t.$$.fragment,a),j(r),i=!1},d(a){a&&(D(e),D(l),D(n)),Q(t),r&&r.d(a)}}}function Bs(s){let e,t,l;return t=new zn({props:{strings:s[3].strings,onClick:s[13]}}),{c(){e=v("div"),W(t.$$.fragment),m(e,"class","ml-auto")},m(n,i){C(n,e,i),X(t,e,null),l=!0},p(n,i){const r={};i&8&&(r.strings=n[3].strings),i&1&&(r.onClick=n[13]),t.$set(r)},i(n){l||(S(t.$$.fragment,n),l=!0)},o(n){j(t.$$.fragment,n),l=!1},d(n){n&&D(e),Q(t)}}}function qs(s){let e,t,l,n=s[3].viewportSize>=ge.LG&&Is(s),i=s[1]&&Es(s);return{c(){e=v("div"),n&&n.c(),t=T(),i&&i.c(),m(e,"class","row mb-3")},m(r,a){C(r,e,a),n&&n.m(e,null),_(e,t),i&&i.m(e,null),l=!0},p(r,a){r[3].viewportSize>=ge.LG?n?(n.p(r,a),a&8&&S(n,1)):(n=Is(r),n.c(),S(n,1),n.m(e,t)):n&&(re(),j(n,1,1,()=>{n=null}),ae()),r[1]?i?(i.p(r,a),a&2&&S(i,1)):(i=Es(r),i.c(),S(i,1),i.m(e,null)):i&&(re(),j(i,1,1,()=>{i=null}),ae())},i(r){l||(S(n),S(i),l=!0)},o(r){j(n),j(i),l=!1},d(r){r&&D(e),n&&n.d(),i&&i.d()}}}function Is(s){let e,t,l;return t=new Ys({props:{strings:s[3].strings,onClick:s[14]}}),{c(){e=v("div"),W(t.$$.fragment),m(e,"class","local-mail-view-side-column svelte-wfy5os")},m(n,i){C(n,e,i),X(t,e,null),l=!0},p(n,i){const r={};i&8&&(r.strings=n[3].strings),i&1&&(r.onClick=n[14]),t.$set(r)},i(n){l||(S(t.$$.fragment,n),l=!0)},o(n){j(t.$$.fragment,n),l=!1},d(n){n&&D(e),Q(t)}}}function Es(s){let e,t,l;return t=new Aa({props:{store:s[0]}}),{c(){e=v("div"),W(t.$$.fragment),m(e,"class","local-mail-view-main-column d-flex svelte-wfy5os")},m(n,i){C(n,e,i),X(t,e,null),l=!0},p(n,i){const r={};i&1&&(r.store=n[0]),t.$set(r)},i(n){l||(S(t.$$.fragment,n),l=!0)},o(n){j(t.$$.fragment,n),l=!1},d(n){n&&D(e),Q(t)}}}function Rs(s){let e,t,l;return t=new jn({props:{settings:s[3].settings,strings:s[3].strings,unread:s[3].unread,drafts:s[3].drafts,courses:s[3].courses,labels:s[3].labels,params:s[3].params,onClick:s[15]}}),{c(){e=v("div"),W(t.$$.fragment),m(e,"class","local-mail-view-side-column svelte-wfy5os")},m(n,i){C(n,e,i),X(t,e,null),l=!0},p(n,i){const r={};i&8&&(r.settings=n[3].settings),i&8&&(r.strings=n[3].strings),i&8&&(r.unread=n[3].unread),i&8&&(r.drafts=n[3].drafts),i&8&&(r.courses=n[3].courses),i&8&&(r.labels=n[3].labels),i&8&&(r.params=n[3].params),i&1&&(r.onClick=n[15]),t.$set(r)},i(n){l||(S(t.$$.fragment,n),l=!0)},o(n){j(t.$$.fragment,n),l=!1},d(n){n&&D(e),Q(t)}}}function Fs(s){let e,t,l,n;const i=[Ra,Ea,Ia],r=[];function a(o,f){var c;return(c=o[3].message)!=null&&c.draft&&o[3].draftForm?0:o[3].message?1:2}return t=a(s),l=r[t]=i[t](s),{c(){e=v("div"),l.c(),m(e,"class","local-mail-view-main-column svelte-wfy5os")},m(o,f){C(o,e,f),r[t].m(e,null),n=!0},p(o,f){let c=t;t=a(o),t===c?r[t].p(o,f):(re(),j(r[c],1,1,()=>{r[c]=null}),ae(),l=r[t],l?l.p(o,f):(l=r[t]=i[t](o),l.c()),S(l,1),l.m(e,null))},i(o){n||(S(l),n=!0)},o(o){j(l),n=!1},d(o){o&&D(e),r[t].d()}}}function Ia(s){let e,t,l,n;return e=new Ji({props:{store:s[0]}}),l=new Kr({props:{store:s[0]}}),{c(){W(e.$$.fragment),t=T(),W(l.$$.fragment)},m(i,r){X(e,i,r),C(i,t,r),X(l,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),l.$set(o)},i(i){n||(S(e.$$.fragment,i),S(l.$$.fragment,i),n=!0)},o(i){j(e.$$.fragment,i),j(l.$$.fragment,i),n=!1},d(i){i&&D(t),Q(e,i),Q(l,i)}}}function Ea(s){let e,t;return e=new dr({props:{store:s[0],message:s[3].message}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&1&&(i.store=l[0]),n&8&&(i.message=l[3].message),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function Ra(s){let e,t;return e=new Ur({props:{store:s[0],message:s[3].message,form:s[3].draftForm}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&1&&(i.store=l[0]),n&8&&(i.message=l[3].message),n&8&&(i.form=l[3].draftForm),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function Ps(s){let e,t;return e=new yi({props:{store:s[0]}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&1&&(i.store=l[0]),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function Os(s){let e,t;return e=new Xr({props:{store:s[0],onCancel:s[16]}}),{c(){W(e.$$.fragment)},m(l,n){X(e,l,n),t=!0},p(l,n){const i={};n&1&&(i.store=l[0]),n&1&&(i.onCancel=l[16]),e.$set(i)},i(l){t||(S(e.$$.fragment,l),t=!0)},o(l){j(e.$$.fragment,l),t=!1},d(l){Q(e,l)}}}function Fa(s){let e,t,l,n,i,r,a,o,f,c,u,d,g,h,p,k,M,w,y,b,$;document.title=t=s[5]+" - "+s[3].strings.pluginname;function z(te,oe){return te[3].mobile&&te[3].viewportSize<ge.LG?qa:Ba}let N=z(s),L=N(s),q=s[1]&&Ns(s),H=s[3].viewportSize<ge.LG&&As(s),Y=(s[1]||s[3].viewportSize>=ge.LG)&&qs(s),V=(!s[1]||s[3].viewportSize>=ge.LG)&&Rs(s),ee=s[1]&&Fs(s),I=s[1]&&s[3].viewportSize<ge.MD&&Ps(s),K=s[3].params.dialog=="preferences"&&Os(s);return k=new ha({props:{store:s[0]}}),w=new Pn({props:{store:s[0]}}),{c(){e=T(),l=T(),n=v("div"),i=v("div"),L.c(),r=T(),a=v("div"),q&&q.c(),o=T(),H&&H.c(),f=T(),Y&&Y.c(),c=T(),u=v("div"),V&&V.c(),d=T(),ee&&ee.c(),g=T(),I&&I.c(),h=T(),K&&K.c(),p=T(),W(k.$$.fragment),M=T(),W(w.$$.fragment),m(a,"class","local-mail-view-main-column d-flex mb-4 svelte-wfy5os"),m(i,"class","row align-items-center"),m(u,"class","row mb-3"),m(n,"class","local-mail-view container-fluid pt-2 svelte-wfy5os"),G(n,"p-4",!s[3].mobile),G(n,"local-mail-loading",s[3].loading)},m(te,oe){C(te,e,oe),C(te,l,oe),C(te,n,oe),_(n,i),L.m(i,null),_(i,r),_(i,a),q&&q.m(a,null),_(a,o),H&&H.m(a,null),_(n,f),Y&&Y.m(n,null),_(n,c),_(n,u),V&&V.m(u,null),_(u,d),ee&&ee.m(u,null),_(n,g),I&&I.m(n,null),_(n,h),K&&K.m(n,null),_(n,p),X(k,n,null),_(n,M),X(w,n,null),s[17](n),y=!0,b||($=[O(xe,"resize",s[10]),O(xe,"popstate",s[11]),O(xe,"beforeunload",s[6]),O(xe,"message",s[7]),O(document,"click",function(){Me(s[3].mobile?s[8]:void 0)&&(s[3].mobile?s[8]:void 0).apply(this,arguments)})],b=!0)},p(te,[oe]){s=te,(!y||oe&40)&&t!==(t=s[5]+" - "+s[3].strings.pluginname)&&(document.title=t),N===(N=z(s))&&L?L.p(s,oe):(L.d(1),L=N(s),L&&(L.c(),L.m(i,r))),s[1]?q?(q.p(s,oe),oe&2&&S(q,1)):(q=Ns(s),q.c(),S(q,1),q.m(a,o)):q&&(re(),j(q,1,1,()=>{q=null}),ae()),s[3].viewportSize<ge.LG?H?(H.p(s,oe),oe&8&&S(H,1)):(H=As(s),H.c(),S(H,1),H.m(a,null)):H&&(re(),j(H,1,1,()=>{H=null}),ae()),s[1]||s[3].viewportSize>=ge.LG?Y?(Y.p(s,oe),oe&10&&S(Y,1)):(Y=qs(s),Y.c(),S(Y,1),Y.m(n,c)):Y&&(re(),j(Y,1,1,()=>{Y=null}),ae()),!s[1]||s[3].viewportSize>=ge.LG?V?(V.p(s,oe),oe&10&&S(V,1)):(V=Rs(s),V.c(),S(V,1),V.m(u,d)):V&&(re(),j(V,1,1,()=>{V=null}),ae()),s[1]?ee?(ee.p(s,oe),oe&2&&S(ee,1)):(ee=Fs(s),ee.c(),S(ee,1),ee.m(u,null)):ee&&(re(),j(ee,1,1,()=>{ee=null}),ae()),s[1]&&s[3].viewportSize<ge.MD?I?(I.p(s,oe),oe&10&&S(I,1)):(I=Ps(s),I.c(),S(I,1),I.m(n,h)):I&&(re(),j(I,1,1,()=>{I=null}),ae()),s[3].params.dialog=="preferences"?K?(K.p(s,oe),oe&8&&S(K,1)):(K=Os(s),K.c(),S(K,1),K.m(n,p)):K&&(re(),j(K,1,1,()=>{K=null}),ae());const E={};oe&1&&(E.store=s[0]),k.$set(E);const J={};oe&1&&(J.store=s[0]),w.$set(J),(!y||oe&8)&&G(n,"p-4",!s[3].mobile),(!y||oe&8)&&G(n,"local-mail-loading",s[3].loading)},i(te){y||(S(q),S(H),S(Y),S(V),S(ee),S(I),S(K),S(k.$$.fragment,te),S(w.$$.fragment,te),y=!0)},o(te){j(q),j(H),j(Y),j(V),j(ee),j(I),j(K),j(k.$$.fragment,te),j(w.$$.fragment,te),y=!1},d(te){te&&(D(e),D(l),D(n)),L.d(),q&&q.d(),H&&H.d(),Y&&Y.d(),V&&V.d(),ee&&ee.d(),I&&I.d(),K&&K.d(),Q(k),Q(w),s[17](null),b=!1,ve($)}}}function Pa(s,e,t){let l,n,i,r,a,o=U,f=()=>(o(),o=_e(c,L=>t(3,a=L)),c);s.$$.on_destroy.push(()=>o());let{store:c}=e;f();let u,d=0;Qe(()=>{c.setViewportSize(window.innerWidth)}),Ln(()=>{d!=a.navigationId&&(d=a.navigationId,u.scrollIntoView())});const g=L=>{if(a.draftData)return L.preventDefault(),c.updateDraft(a.draftData,!0),""},h=L=>{a.mobile&&L.data.addon=="local_mail"&&L.data.backClicked&&c.navigateToMenu()},p=L=>{var q;if(a.mobile&&!L.defaultPrevented&&L.target instanceof HTMLElement){const H=L.target.closest("a");H&&((q=window.parent)==null||q.postMessage({addon:"local_mail",openUrl:H.href},"*")),L.defaultPrevented||L.preventDefault()}},k=()=>c.setViewportSize(window.innerWidth),M=()=>c.navigate(Js()),w=()=>c.createMessage(),y=()=>c.showDialog("preferences"),b=()=>c.createMessage(),$=L=>c.navigate(L),z=()=>c.hideDialog();function N(L){Ce[L?"unshift":"push"](()=>{u=L,t(4,u)})}return s.$$set=L=>{"store"in L&&f(t(0,c=L.store))},s.$$.update=()=>{var L,q,H;s.$$.dirty&8&&t(1,l=a.params.tray),s.$$.dirty&10&&t(2,n=l=="inbox"?a.strings.inbox:l=="starred"?a.strings.starredmail:l=="sent"?a.strings.sentmail:l=="drafts"?a.strings.drafts:l=="trash"?a.strings.trash:l=="label"?((L=a.labels.find(Y=>Y.id==a.params.labelid))==null?void 0:L.name)||"":l=="course"&&((q=a.courses.find(Y=>Y.id==a.params.courseid))==null?void 0:q.fullname)||""),s.$$.dirty&12&&t(5,i=a.message?a.message.subject.trim()||a.strings.nosubject:n),s.$$.dirty&12&&t(9,r=a.viewportSize<ge.LG?n||a.strings.pluginname:""),s.$$.dirty&514&&((H=window.parent)==null||H.postMessage({addon:"local_mail",setTitle:r,captureBack:l!=null},"*"))},[c,l,n,a,u,i,g,h,p,r,k,M,w,y,b,$,z,N]}class Oa extends me{constructor(e){super(),de(this,e,Pa,Fa,ce,{store:0})}}const Ge=[];function Ha(s,e=U){let t;const l=new Set;function n(a){if(Nn(s,a)&&(s=a,t)){const o=!Ge.length;for(const f of l)f[1](),Ge.push(f,s);if(o){for(let f=0;f<Ge.length;f+=2)Ge[f][0](Ge[f+1]);Ge.length=0}}}function i(a){n(a(s))}function r(a,o=U){const f=[a,o];return l.add(f),l.size===1&&(t=e(n,i)||U),a(s),()=>{l.delete(f),l.size===0&&t&&(t(),t=null)}}return{set:n,update:i,subscribe:r}}async function Ua(s){let e=0,t=0,l={userid:s.userid,settings:s.settings,preferences:s.preferences,strings:s.strings,mobile:s.mobile,params:{},unread:0,drafts:0,courses:[],labels:[],totalCount:0,listMessages:[],loading:!0,selectedMessages:new Map,toasts:[],navigationId:0,viewportSize:0};const{subscribe:n,set:i}=Ha(l),r=A=>i({...l,...A});n(A=>{l=A});const a=async(A,P,ie=!1)=>{var bt,ht,vt,kt,wt;const R=++e,se=(bt=l.message)==null?void 0:bt.id,pe=l.draftData,x=P||l.params,Z=l.preferences.perpage;if(r({loading:!0,error:void 0}),st(x,ie),se&&pe&&(clearTimeout(t),A.unshift({methodname:"update_message",messageid:se,data:pe})),A.push({methodname:"count_messages",query:{roles:Object.values(ze),unread:!0}}),A.push({methodname:"count_messages",query:{draft:!0}}),A.push({methodname:"get_courses"}),A.push({methodname:"get_labels"}),x.tray){const ye={courseid:x.courseid,labelid:x.tray=="label"?x.labelid:void 0,draft:x.tray=="drafts"?!0:x.tray=="sent"?!1:void 0,roles:x.tray=="inbox"?["to","cc","bcc"]:x.tray=="sent"?["from"]:void 0,starred:x.tray=="starred"?!0:void 0,deleted:x.tray=="trash"};A.push({methodname:"count_messages",query:ye}),x.messageid?(A.push({methodname:"get_message",messageid:x.messageid}),A.push({methodname:"search_messages",query:{...ye,...x.search,startid:x.messageid,reverse:!1},limit:1}),A.push({methodname:"search_messages",query:{...ye,...x.search,startid:x.messageid,reverse:!0},limit:1}),x.search||A.push({methodname:"count_messages",query:{...ye,startid:x.messageid,reverse:!0}})):A.push({methodname:"search_messages",query:{...ye,...x.search},offset:x.search?void 0:x.offset,limit:x.search?Z+1:Z})}let ne;try{ne=await Je(A)}catch(ye){return q(ye),[]}let he,ke,Ae,Ee,Te=[],dt=0;x.tray&&(x.messageid?(x.search||(ke=ne.pop()),Ee=(ht=ne.pop()[0])==null?void 0:ht.id,Ae=(vt=ne.pop()[0])==null?void 0:vt.id,he=ne.pop()):(Te=ne.pop(),x.search&&(x.search.reverse?(Ee=(kt=Te[Z])==null?void 0:kt.id,Ae=x.search.startid,Te=Te.slice(0,Z).reverse()):(Ee=x.search.startid,Ae=(wt=Te[Z])==null?void 0:wt.id,Te=Te.slice(0,Z)))),dt=ne.pop());const _t=ne.pop(),gt=ne.pop(),pn=ne.pop(),bn=ne.pop();if(se&&pe&&ne.shift(),x.tray=="course"&&!gt.find(ye=>ye.id==x.courseid)||x.tray=="label"&&!_t.find(ye=>ye.id==x.labelid))return await k({tray:"inbox"},!0),ne;let pt;if(he!=null&&he.draft&&(he==null?void 0:he.id)!=se){const ye=[{methodname:"get_message_form",messageid:he.id}];let yt;try{yt=await Je(ye)}catch(hn){return q(hn),ne}pt=yt.pop()}return R!=e||(r({params:x,unread:bn,drafts:pn,courses:gt,labels:_t,messageOffset:ke,totalCount:dt,listMessages:Te,message:he,nextMessageId:Ae,prevMessageId:Ee,draftForm:(he==null?void 0:he.id)!=se?pt:l.draftForm,draftData:void 0,draftSaved:(he==null?void 0:he.id)==se?pe==null:!1,selectedMessages:new Map(he?[[he.id,he]]:l.message?[]:Te.filter(ye=>l.selectedMessages.has(ye.id)).map(ye=>[ye.id,ye])),loading:!1,navigationId:ie||x.tray!=l.params.tray||x.courseid!=l.params.courseid||x.labelid!=l.params.labelid||x.messageid!=l.params.messageid||x.offset!=l.params.offset?l.navigationId+1:l.navigationId}),se&&pe&&se!=(he==null?void 0:he.id)&&K({text:l.strings.draftsaved})),ne},o=async(A,P)=>(await a([{methodname:"create_label",name:A,color:P}])).pop(),f=async A=>{A=A||l.params.courseid||l.courses[0].id;const P={methodname:"create_message",courseid:A};let ie;try{ie=await Je([P])}catch(R){q(R);return}await k({tray:"drafts",messageid:ie.pop(),courseid:A})},c=async A=>{await a([{methodname:"delete_label",labelid:A}],{tray:"inbox"})},u=async()=>{await a([{methodname:"empty_trash"}])},d=async A=>{const P=l.params,ie={methodname:"forward_message",messageid:A.id},R=await a([ie]);await k({tray:"drafts",messageid:R.pop(),courseid:P.courseid?A.course.id:void 0})},g=()=>{const A={...l.params,dialog:void 0};r({params:A}),st(A,!0)},h=A=>{r({toasts:l.toasts.filter(P=>P!=A)})},p=async()=>{var R;const A=Js(),P=[];l.settings.incrementalsearch&&P.push({methodname:"search_messages",query:{deleted:!1},offset:l.settings.incrementalsearchlimit,limit:1});const ie=await a(P,A,!0);if(l.settings.incrementalsearch){const se=ie.pop();r({incrementalSearchStopId:(R=se==null?void 0:se[0])==null?void 0:R.id})}},k=async(A,P=!1)=>{const ie=[];A!=null&&A.messageid&&ie.push({methodname:"set_unread",messageid:A.messageid,unread:!1}),await a(ie,A,P)},M=async(A=!1)=>{const P={...l.params,messageid:void 0,offset:l.params.search?Math.floor((l.messageOffset||0)/l.preferences.perpage)*l.preferences.perpage:void 0};await a([],P,A)},w=async()=>{await a([],{})},y=async(A,P)=>{const ie=l.params,R={methodname:"reply_message",messageid:A.id,all:P},se=await a([R]);await k({tray:"drafts",messageid:se.pop(),courseid:ie.courseid?A.course.id:void 0})},b=async A=>{r({preferences:{...l.preferences,...A}});let P=l.params;A.perpage&&(P={...P,offset:l.params.offset?Math.trunc(l.params.offset/A.perpage)*A.perpage:void 0}),await a([{methodname:"set_preferences",preferences:A}],P,!0)},$=A=>{r({selectedMessages:new Map(l.listMessages.filter(P=>A=="all"||A=="read"&&!P.unread||A=="unread"&&P.unread||A=="starred"&&P.starred||A=="unstarred"&&!P.starred).map(P=>[P.id,P]))})},z=async A=>{await k({...l.params,courseid:A,offset:0,messageid:void 0,search:l.params.search?{...l.params.search,startid:void 0,reverse:void 0}:void 0})},N=async()=>{var ie;if(!((ie=l.message)!=null&&ie.draft))return;const A={methodname:"send_message",messageid:l.message.id},P={tray:"inbox",courseid:l.params.courseid?l.message.course.id:void 0};await a([A],P),K({text:l.strings.messagesent})},L=async(A,P,ie)=>{const R=A.map(pe=>({methodname:"set_deleted",messageid:pe,deleted:P})),se={...l.params,messageid:void 0};if(await a(R,se,!0),P!=Oe.DeletedForever){const pe=P?A.length>1?"undodeletemany":"undodeleteone":A.length>1?"undorestoremany":"undorestoreone",x=je(l.strings[pe],A.length);K({text:x,undo:ie?()=>{L(A,P?Oe.NotDeleted:Oe.Deleted,!1)}:void 0})}},q=async A=>{r({loading:l.loading&&!A,error:A})},H=async(A,P)=>{le(R=>l.selectedMessages.has(R.id)?{...R,labels:l.labels.filter(se=>A.includes(se.id)?!0:P.includes(se.id)?!1:R.labels.findIndex(pe=>pe.id==se.id)>=0)}:R);const ie=[];l.selectedMessages.forEach(R=>{ie.push({methodname:"set_labels",messageid:R.id,labelids:R.labels.map(se=>se.id)})}),await a(ie)},Y=async(A,P)=>{le(R=>A.includes(R.id)?{...R,starred:P}:R);const ie=A.map(R=>({methodname:"set_starred",messageid:R,starred:P}));await a(ie)},V=async(A,P)=>{le(se=>A.includes(se.id)?{...se,unread:P}:se);const ie=A.map(se=>({methodname:"set_unread",messageid:se,unread:P})),R={...l.params,messageid:void 0};await a(ie,R)},ee=A=>{r({viewportSize:A,navigationId:l.navigationId+1}),!l.params.tray&&A>=ge.LG&&!l.error&&k({tray:"inbox"},!0)},I=async A=>{const P={...l.params,dialog:A};st(P,l.params.dialog!=null),r({params:P})},K=async A=>{r({toasts:[A]}),A&&setTimeout(()=>h(A),1e4)},te=A=>{r({selectedMessages:new Map(l.listMessages.filter(P=>P.id==A?!l.selectedMessages.has(P.id):l.selectedMessages.has(P.id)).map(P=>[P.id,P]))})},oe=async A=>{A.undo&&(h(A),A.undo())},E=(A,P)=>{if(!l.message)return;const ie=++e,R=l.message,se=l.draftData;r({draftData:A,draftSaved:!1});let pe=3e3;P?pe=0:se&&(pe=Math.max(0,R.time*1e3+pe-Date.now())),clearTimeout(t),t=setTimeout(async()=>{const x=[{methodname:"update_message",messageid:R.id,data:A},{methodname:"get_message",messageid:R.id}];let Z;try{Z=await Je(x)}catch(he){q(he);return}const ne=Z.pop();ie==e&&r({message:ne,draftData:void 0,draftSaved:!0})},pe)},J=async(A,P,ie)=>{await a([{methodname:"update_label",labelid:A,name:P,color:ie}])},le=A=>{r({listMessages:l.listMessages.map(P=>A(P)),message:l.message?A(l.message):void 0,selectedMessages:new Map(Array.from(l.selectedMessages.entries()).map(([P,ie])=>[P,A(ie)]))})};return await p(),{createLabel:o,createMessage:f,deleteLabel:c,emptyTrash:u,forward:d,get:()=>l,hideDialog:g,hideToast:h,navigate:k,navigateToList:M,navigateToMenu:w,reply:y,savePreferences:b,selectAll:$,selectCourse:z,sendMessage:N,setDeleted:L,setError:q,setLabels:H,setStarred:Y,setUnread:V,setViewportSize:ee,showDialog:I,subscribe:n,toggleSelected:te,undo:oe,updateDraft:E,updateLabel:J}}async function Ga(){const s=document.getElementById("local-mail-view"),e=document.getElementById("local-mail-navbar"),t=window.local_mail_view_data;if(!t)return;const l=await Ua({userid:t.userid,settings:t.settings,preferences:t.preferences,strings:t.strings,mobile:!!t.mobile});if(s&&new Oa({target:s,props:{store:l}}),e){e.innerHTML="";const n=new An({target:e,props:{settings:l.get().settings,strings:l.get().strings,unread:l.get().unread,drafts:l.get().drafts,courses:l.get().courses,labels:l.get().labels,onClick:l.navigate,onComposeClick:l.createMessage}});l.subscribe(i=>{n.$set({settings:i.settings,strings:i.strings,unread:i.unread,drafts:i.drafts,courses:i.courses,labels:i.labels,params:i.params})})}}Ga();
//# sourceMappingURL=view-8c49a41e.js.map
